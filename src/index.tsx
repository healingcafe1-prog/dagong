import { Hono } from 'hono'
import { cors } from 'hono/cors'
import { serveStatic } from 'hono/cloudflare-workers'
import { renderer } from './renderer'

type Bindings = {
  DB: D1Database
  GOOGLE_CLIENT_ID?: string
  GOOGLE_CLIENT_SECRET?: string
  NAVER_CLIENT_ID?: string
  NAVER_CLIENT_SECRET?: string
  KAKAO_CLIENT_ID?: string
  KAKAO_CLIENT_SECRET?: string
  SESSION_SECRET?: string
  TOSS_PAYMENTS_CLIENT_KEY?: string
  TOSS_PAYMENTS_SECRET_KEY?: string
}

const app = new Hono<{ Bindings: Bindings }>()

// ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
async function authMiddleware(c: any, next: any) {
  const cookies = c.req.header('Cookie') || ''
  const sessionMatch = cookies.match(/session=([^;]+)/)
  
  if (!sessionMatch) {
    return c.json({ error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' }, 401)
  }
  
  const sessionToken = sessionMatch[1]
  
  // ì„¸ì…˜ í™•ì¸
  const { results: sessions } = await c.env.DB.prepare(`
    SELECT us.*, u.id as user_id, u.email, u.name, u.profile_image, u.role, u.provider
    FROM user_sessions us
    JOIN users u ON us.user_id = u.id
    WHERE us.session_token = ? AND us.expires_at > datetime('now')
  `).bind(sessionToken).all()
  
  if (sessions.length === 0) {
    return c.json({ error: 'ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤' }, 401)
  }
  
  // ì‚¬ìš©ì ì •ë³´ë¥¼ contextì— ì €ì¥
  c.set('user', sessions[0])
  await next()
}

// CORS ì„¤ì •
app.use('/api/*', cors())

// ì •ì  íŒŒì¼ ì„œë¹™
app.use('/static/*', serveStatic())

// SQL API ì—”ë“œí¬ì¸íŠ¸ - ì™„ì „í•œ SQL ë°˜í™˜
app.get('/api/sql-content', (c) => {
  const sqlContent = `DELETE FROM education_curriculum;
DELETE FROM education_categories;
DELETE FROM experiences;
DELETE FROM products;
DELETE FROM events;
DELETE FROM producers;
DELETE FROM categories;
DELETE FROM regions;

INSERT INTO regions (id, name, type, description, featured_image, created_at) VALUES 
(1, 'ì œì£¼ë„', 'tea', 'ì œì£¼ì˜ ì²­ì • ìì—°ì—ì„œ ìë€ ë…¹ì°¨', '/images/regions/jeju.jpg', '2026-02-18 12:18:03'),
(2, 'í•˜ë™', 'tea', 'ì§€ë¦¬ì‚° ìë½ì˜ ì „í†µ ì°¨ë°­', '/images/regions/hadong.jpg', '2026-02-18 12:18:03'),
(3, 'ê¹€í•´', 'tea', 'í•œêµ­ ì°¨ë¬¸í™”ì˜ ë°œìƒì§€', '/images/regions/gimhae.jpg', '2026-02-18 12:18:03'),
(4, 'ê´‘ì–‘', 'tea', 'ë°±ìš´ì‚° ìë½ì˜ ì²­ì • ì°¨ë°­', '/images/regions/gwangyang.jpg', '2026-02-18 12:18:03'),
(5, 'ë³´ì„±', 'tea', 'ëŒ€í•œë¯¼êµ­ ë…¹ì°¨ì˜ ìˆ˜ë„', '/images/regions/boseong.jpg', '2026-02-18 12:18:03'),
(6, 'ì´ì²œ', 'craft', 'ì „í†µ ë„ìê¸°ì˜ ë³¸ê³ ì¥', '/images/regions/icheon.jpg', '2026-02-18 12:18:03'),
(7, 'ê´‘ì£¼', 'craft', 'ì¡°ì„ ë°±ìì˜ ì¤‘ì‹¬ì§€', '/images/regions/gwangju.jpg', '2026-02-18 12:18:03'),
(8, 'ë‹´ì–‘', 'craft', 'ëŒ€ë‚˜ë¬´ ê³µì˜ˆì˜ ë©”ì¹´', '/images/regions/damyang.jpg', '2026-02-18 12:18:03'),
(9, 'ì•ˆë™', 'craft', 'í•œêµ­ ì •ì‹ ë¬¸í™”ì˜ ìˆ˜ë„', '/images/regions/andong.jpg', '2026-02-18 12:18:03'),
(10, 'ì „ì£¼', 'craft', 'í•œì§€ì™€ ì „í†µê³µì˜ˆ', '/images/regions/jeonju.jpg', '2026-02-18 12:18:03'),
(11, 'ê°•ì§„', 'craft', 'ê³ ë ¤ì²­ìì˜ ê³ í–¥', '/images/regions/gangjin.jpg', '2026-02-18 12:18:03'),
(12, 'ë‚¨ì›', 'craft', 'ì „í†µ ëª©ê³µì˜ˆì˜ ì¤‘ì‹¬', '/images/regions/namwon.jpg', '2026-02-18 12:18:03'),
(13, 'ê³µì£¼', 'craft', 'ë°±ì œ ë¬¸í™”ì˜ ë³´ê³ ', '/images/regions/gongju.jpg', '2026-02-18 12:18:03'),
(14, 'ê²½ì£¼', 'craft', 'ì‹ ë¼ ì²œë…„ì˜ ê³µì˜ˆ', '/images/regions/gyeongju.jpg', '2026-02-18 12:18:03'),
(15, 'ìš¸ì‚°', 'craft', 'ë™í•´ì•ˆ íŠ¹ì‚°í’ˆ', '/images/regions/ulsan.jpg', '2026-02-18 12:18:03'),
(16, 'ë¶€ì‚°', 'craft', 'í•´ì–‘ ë„ì‹œ íŠ¹ì‚°í’ˆ', '/images/regions/busan.jpg', '2026-02-18 12:18:03'),
(17, 'ì„œìš¸', 'craft', 'ìˆ˜ë„ê¶Œ íŠ¹ì‚°í’ˆ', '/images/regions/seoul.jpg', '2026-02-18 12:18:03');

INSERT INTO categories (id, name, type, description, display_order, created_at) VALUES 
(1, 'ë…¹ì°¨', 'tea', 'í•œêµ­ ì „í†µ ë…¹ì°¨', 1, '2026-02-18 12:18:13'),
(2, 'í™©ì°¨', 'tea', 'íŠ¹ë³„í•œ í™©ì°¨', 4, '2026-02-18 12:18:13'),
(3, 'í™ì°¨', 'tea', 'ì™„ì „ ë°œíš¨ í™ì°¨', 5, '2026-02-18 12:18:13'),
(4, 'ë°œíš¨ì°¨', 'tea', 'ì „í†µ ë°œíš¨ì°¨', 6, '2026-02-18 12:18:13'),
(6, 'ë¸”ë Œë”©ì°¨', 'tea', 'ë‹¤ì–‘í•œ ë¸”ë Œë”© ì°¨', 7, '2026-02-18 12:18:13'),
(8, 'ì°»ì”', 'craft', 'ë‹¤ì–‘í•œ ì°»ì”', 2, '2026-02-18 12:18:13'),
(9, 'ë‹¤ê´€', 'craft', 'ì „í†µ ë‹¤ê´€', 1, '2026-02-18 12:18:13'),
(11, 'ì¥ì‹í’ˆ', 'craft', 'ì¸í…Œë¦¬ì–´ ì¥ì‹í’ˆ', 9, '2026-02-18 12:18:13'),
(12, 'ëª…ì ˆ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ëª…ì ˆ íŠ¹ë³„ ì„ ë¬¼', 1, '2026-02-18 12:18:13'),
(13, 'ê¸°ë…ì¼ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ê¸°ë…ì¼ìš© ì„ ë¬¼', 2, '2026-02-18 12:18:13'),
(14, 'ê¸°ì—… ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ê¸°ì—…ìš© ì„ ë¬¼', 3, '2026-02-18 12:18:13'),
(15, 'ë§ì¶¤ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ë§ì¶¤í˜• ì„ ë¬¼', 4, '2026-02-18 12:18:13'),
(17, 'ë†ì‚°ë¬¼', 'local', 'ì§€ì—­ ë†ì‚°ë¬¼', 1, '2026-02-18 12:18:13'),
(18, 'ê°€ê³µì‹í’ˆ', 'local', 'ì§€ì—­ ê°€ê³µì‹í’ˆ', 5, '2026-02-18 12:18:13'),
(19, 'ìˆ˜ì‚°ë¬¼', 'local', 'ì§€ì—­ ìˆ˜ì‚°ë¬¼', 2, '2026-02-18 12:18:13'),
(20, 'ì¶•ì‚°ë¬¼', 'local', 'ì§€ì—­ ì¶•ì‚°ë¬¼', 3, '2026-02-18 12:18:13'),
(21, 'ê³µì˜ˆí’ˆ', 'local', 'ì§€ì—­ ê³µì˜ˆí’ˆ', 4, '2026-02-18 12:18:13'),
(22, 'ì „í†µì£¼', 'local', 'ì „í†µì£¼/ìŒë£Œ', 6, '2026-02-18 12:18:13'),
(23, 'ê±´ê°•ì‹í’ˆ', 'local', 'ê±´ê°• ì‹í’ˆ', 7, '2026-02-18 12:18:13'),
(24, 'ì¡°ë¯¸ë£Œ', 'local', 'ì²œì—° ì¡°ë¯¸ë£Œ', 8, '2026-02-18 12:18:13'),
(25, 'ê°„í¸ì‹', 'local', 'ê°„í¸ ë¨¹ê±°ë¦¬', 9, '2026-02-18 12:18:13'),
(26, 'ë””ì €íŠ¸', 'local', 'ì „í†µ ë””ì €íŠ¸', 10, '2026-02-18 12:18:13'),
(27, 'ìƒí™œìš©í’ˆ', 'local', 'ì¹œí™˜ê²½ ìƒí™œìš©í’ˆ', 11, '2026-02-18 12:18:13'),
(28, 'í™”ì¥í’ˆ', 'local', 'ì²œì—° í™”ì¥í’ˆ', 12, '2026-02-18 12:18:13'),
(29, 'ì˜ë¥˜/ì¡í™”', 'local', 'ì „í†µ ì˜ë¥˜/ì¡í™”', 13, '2026-02-18 12:18:13'),
(30, 'ì¸í…Œë¦¬ì–´', 'local', 'ì¸í…Œë¦¬ì–´ ì†Œí’ˆ', 14, '2026-02-18 12:18:13'),
(31, 'ë¬¸í™”ìƒí’ˆ', 'local', 'ë¬¸í™”/ì˜ˆìˆ  ìƒí’ˆ', 15, '2026-02-18 12:18:13');

INSERT INTO producers (id, name, region, description, contact, created_at) VALUES 
(1, 'ë°•ìˆ˜ê³µ', 'ì œì£¼ë„', 'ì œì£¼ í•œë¼ì‚° ìœ ê¸°ë† ì°¨ ë†ì›', '064-123-4567', '2026-02-18 12:18:13'),
(2, 'ì œì£¼ í•œë¼ì‚° ì°¨ë†ì›', 'ì œì£¼ë„', '3ëŒ€ì§¸ ì´ì–´ì˜¨ ì „í†µ ì°¨ ë†ì›', '064-456-7890', '2026-02-18 12:18:13');

INSERT INTO products (id, name, category_id, producer_id, description, consumer_price, direct_price, shipping_fee, stock_quantity, main_image, product_type, weight, origin, is_featured, is_available, view_count, created_at) VALUES 
(1, 'ì œì£¼ í•œë¼ì‚° ìœ ê¸°ë† ë…¹ì°¨', 1, 1, 'ì²­ì • ì œì£¼ì—ì„œ ìë€ í”„ë¦¬ë¯¸ì—„ ìœ ê¸°ë† ë…¹ì°¨', 35000.00, 28000.00, 3000.00, 100, '/images/products/tea1.jpg', 'tea', 100.00, 'ì œì£¼ë„', 1, 1, 150, '2026-02-18 12:18:13'),
(2, 'í•˜ë™ ì „í†µ ë°œíš¨ì°¨', 4, 2, 'ì§€ë¦¬ì‚° ìë½ì˜ ì „í†µ ë°©ì‹ ë°œíš¨ì°¨', 45000.00, 36000.00, 3000.00, 50, '/images/products/tea2.jpg', 'tea', 100.00, 'ê²½ë‚¨ í•˜ë™', 1, 1, 120, '2026-02-18 12:18:13'),
(3, 'ë³´ì„± ì²­íƒœì „', 4, 1, 'ë³´ì„±ì˜ ì „í†µ ë–¡ì°¨', 38000.00, 30400.00, 3000.00, 80, '/images/products/tea3.jpg', 'tea', 150.00, 'ì „ë‚¨ ë³´ì„±', 1, 1, 200, '2026-02-18 12:18:13'),
(4, 'ê¹€í•´ í™©ì°¨', 2, 2, 'ê¹€í•´ì˜ íŠ¹ë³„í•œ í™©ì°¨', 42000.00, 33600.00, 3000.00, 60, '/images/products/tea4.jpg', 'tea', 100.00, 'ê²½ë‚¨ ê¹€í•´', 0, 1, 80, '2026-02-18 12:18:13'),
(5, 'ê´‘ì–‘ ë§¤í™”ì°¨', 6, 1, 'ê´‘ì–‘ ë°±ìš´ì‚° ë§¤í™”ë¡œ ë§Œë“  ë¸”ë Œë”©ì°¨', 32000.00, 25600.00, 3000.00, 90, '/images/products/tea5.jpg', 'tea', 80.00, 'ì „ë‚¨ ê´‘ì–‘', 1, 1, 180, '2026-02-18 12:18:13'),
(6, 'ì´ì²œ ë„ìê¸° ì°»ì” ì„¸íŠ¸', 8, 1, 'ì´ì²œ ì „í†µ ë„ìê¸° ì¥ì¸ì˜ ìˆ˜ì œ ì°»ì”', 85000.00, 68000.00, 3000.00, 30, '/images/products/craft1.jpg', 'craft', 800.00, 'ê²½ê¸° ì´ì²œ', 1, 1, 95, '2026-02-18 12:18:13'),
(7, 'ê´‘ì£¼ ë¶„ì²­ì‚¬ê¸° ë‹¤ê´€', 9, 2, 'ì¡°ì„ ì‹œëŒ€ ê¸°ë²•ìœ¼ë¡œ ë§Œë“  ë¶„ì²­ ë‹¤ê´€', 150000.00, 120000.00, 3000.00, 15, '/images/products/craft2.jpg', 'craft', 1200.00, 'ê²½ê¸° ê´‘ì£¼', 1, 1, 70, '2026-02-18 12:18:13'),
(8, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ì°»ìƒ', 11, 1, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ë¡œ ë§Œë“  ì „í†µ ì°»ìƒ', 95000.00, 76000.00, 5000.00, 25, '/images/products/craft3.jpg', 'craft', 2500.00, 'ì „ë‚¨ ë‹´ì–‘', 0, 1, 60, '2026-02-18 12:18:13'),
(9, 'ì•ˆë™ í•œì§€ ì°»ì” ë°›ì¹¨', 11, 2, 'ì•ˆë™ ì „í†µ í•œì§€ ê³µì˜ˆí’ˆ', 28000.00, 22400.00, 2500.00, 50, '/images/products/craft4.jpg', 'craft', 100.00, 'ê²½ë¶ ì•ˆë™', 0, 1, 45, '2026-02-18 12:18:13'),
(10, 'ì „ì£¼ ë‚˜ì „ì¹ ê¸° ë‹¤ê¸°', 9, 1, 'ì „ì£¼ ì „í†µ ë‚˜ì „ì¹ ê¸° ê¸°ë²•ì˜ ë‹¤ê¸°', 280000.00, 224000.00, 3000.00, 10, '/images/products/craft5.jpg', 'craft', 1500.00, 'ì „ë¶ ì „ì£¼', 1, 1, 85, '2026-02-18 12:18:13'),
(11, 'ê°•ì§„ ì²­ì ì°»ì”', 8, 2, 'ê³ ë ¤ì²­ìì˜ ì „í†µì„ ì´ì€ í˜„ëŒ€ ì²­ì', 120000.00, 96000.00, 3000.00, 20, '/images/products/craft6.jpg', 'craft', 600.00, 'ì „ë‚¨ ê°•ì§„', 1, 1, 110, '2026-02-18 12:18:13'),
(12, 'ë‚¨ì› ëª©ê¸° ì°»ì”ë°›ì¹¨', 11, 1, 'ë‚¨ì› ì „í†µ ëª©ê³µì˜ˆ ì°»ì”ë°›ì¹¨', 35000.00, 28000.00, 2500.00, 40, '/images/products/craft7.jpg', 'craft', 300.00, 'ì „ë¶ ë‚¨ì›', 0, 1, 55, '2026-02-18 12:18:13'),
(13, 'ì œì£¼ í•œë¼ë´‰ì°¨', 6, 1, 'ì œì£¼ í•œë¼ë´‰ìœ¼ë¡œ ë§Œë“  ë¸”ë Œë”©ì°¨', 28000.00, 22400.00, 3000.00, 100, '/images/products/tea6.jpg', 'tea', 80.00, 'ì œì£¼ë„', 1, 1, 140, '2026-02-18 12:18:13'),
(14, 'í•˜ë™ ì•¼ìƒì°¨', 1, 2, 'ì§€ë¦¬ì‚° ì•¼ìƒì°¨ë‚˜ë¬´ì—ì„œ ì±„ì·¨í•œ ì°¨', 65000.00, 52000.00, 3000.00, 30, '/images/products/tea7.jpg', 'tea', 100.00, 'ê²½ë‚¨ í•˜ë™', 1, 1, 90, '2026-02-18 12:18:13'),
(15, 'ëª…ì ˆ í”„ë¦¬ë¯¸ì—„ ì„¸íŠ¸', 12, 1, 'ì°¨ì™€ ë‹¤ê¸°ê°€ í•¨ê»˜í•˜ëŠ” ëª…ì ˆ ì„ ë¬¼', 150000.00, 120000.00, 0.00, 50, '/images/products/gift1.jpg', 'gift', 2000.00, 'ì „êµ­', 1, 1, 200, '2026-02-18 12:18:13'),
(16, 'ê¸°ë…ì¼ ì°¨ ì„ ë¬¼ì„¸íŠ¸', 13, 2, 'íŠ¹ë³„í•œ ë‚ ì„ ìœ„í•œ í”„ë¦¬ë¯¸ì—„ ì°¨ ì„¸íŠ¸', 95000.00, 76000.00, 0.00, 60, '/images/products/gift2.jpg', 'gift', 1200.00, 'ì „êµ­', 1, 1, 175, '2026-02-18 12:18:13'),
(17, 'ê¸°ì—… ì„ ë¬¼ìš© ë‹¤ê¸°ì„¸íŠ¸', 14, 1, 'í’ˆê²©ìˆëŠ” ê¸°ì—… ì„ ë¬¼ìš© ì„¸íŠ¸', 180000.00, 144000.00, 0.00, 40, '/images/products/gift3.jpg', 'gift', 2500.00, 'ì „êµ­', 1, 1, 130, '2026-02-18 12:18:13'),
(18, 'ë§ì¶¤ ì„ ë¬¼ êµ¬ì„±', 15, 2, 'ì›í•˜ëŠ” ëŒ€ë¡œ êµ¬ì„±í•˜ëŠ” ì„ ë¬¼ì„¸íŠ¸', 120000.00, 96000.00, 0.00, 70, '/images/products/gift4.jpg', 'gift', 1500.00, 'ì „êµ­', 0, 1, 95, '2026-02-18 12:18:13'),
(19, 'ìš¸ì‚° ë¯¸ì—­', 19, 1, 'ë™í•´ì•ˆ ì²­ì • í•´ì—­ ë¯¸ì—­', 25000.00, 20000.00, 3000.00, 80, '/images/products/local1.jpg', 'local', 300.00, 'ìš¸ì‚°', 0, 1, 85, '2026-02-18 12:18:13'),
(20, 'ë¶€ì‚° ë©¸ì¹˜', 19, 2, 'ë¶€ì‚° ì•ë°”ë‹¤ íŠ¹ì‚° ë©¸ì¹˜', 32000.00, 25600.00, 3000.00, 90, '/images/products/local2.jpg', 'local', 500.00, 'ë¶€ì‚°', 1, 1, 110, '2026-02-18 12:18:13'),
(21, 'ì œì£¼ í‘ë¼ì§€ ìœ¡í¬', 20, 1, 'ì œì£¼ í‘ë¼ì§€ë¡œ ë§Œë“  í”„ë¦¬ë¯¸ì—„ ìœ¡í¬', 28000.00, 22400.00, 3000.00, 70, '/images/products/local3.jpg', 'local', 200.00, 'ì œì£¼ë„', 1, 1, 95, '2026-02-18 12:18:13'),
(22, 'ë³´ì„± ë…¹ì°¨ ìŒ€', 17, 2, 'ë…¹ì°¨ë¥¼ ë¨¹ì—¬ í‚¤ìš´ íŠ¹ë³„í•œ ìŒ€', 35000.00, 28000.00, 3000.00, 100, '/images/products/local4.jpg', 'local', 5000.00, 'ì „ë‚¨ ë³´ì„±', 0, 1, 75, '2026-02-18 12:18:13'),
(23, 'í•˜ë™ ì•¼ìƒí™” ê¿€', 23, 1, 'ì§€ë¦¬ì‚° ì•¼ìƒí™” ê¿€', 42000.00, 33600.00, 3000.00, 50, '/images/products/local5.jpg', 'local', 600.00, 'ê²½ë‚¨ í•˜ë™', 1, 1, 120, '2026-02-18 12:18:13'),
(24, 'ì•ˆë™ ê°„ê³ ë“±ì–´', 19, 2, 'ì•ˆë™ ì „í†µ ê°„ê³ ë“±ì–´', 38000.00, 30400.00, 3000.00, 60, '/images/products/local6.jpg', 'local', 800.00, 'ê²½ë¶ ì•ˆë™', 0, 1, 65, '2026-02-18 12:18:13'),
(25, 'ì „ì£¼ í•œê³¼', 26, 1, 'ì „í†µ ë°©ì‹ìœ¼ë¡œ ë§Œë“  ì „ì£¼ í•œê³¼', 32000.00, 25600.00, 2500.00, 80, '/images/products/local7.jpg', 'local', 400.00, 'ì „ë¶ ì „ì£¼', 1, 1, 140, '2026-02-18 12:18:13'),
(26, 'ê°•ë¦‰ ì»¤í”¼', 18, 2, 'ê°•ë¦‰ ë¡œìŠ¤í„°ë¦¬ ì›ë‘', 22000.00, 17600.00, 3000.00, 90, '/images/products/local8.jpg', 'local', 200.00, 'ê°•ì› ê°•ë¦‰', 0, 1, 105, '2026-02-18 12:18:13'),
(27, 'ê²½ì£¼ ë¹µ', 26, 1, 'ê²½ì£¼ íŠ¹ì‚° ë¹µ', 18000.00, 14400.00, 3000.00, 100, '/images/products/local9.jpg', 'local', 500.00, 'ê²½ë¶ ê²½ì£¼', 0, 1, 88, '2026-02-18 12:18:13'),
(28, 'ë‚¨ì› ì¶”ì–´íƒ•', 18, 2, 'ë‚¨ì› ì „í†µ ì¶”ì–´íƒ•', 15000.00, 12000.00, 3500.00, 70, '/images/products/local10.jpg', 'local', 1000.00, 'ì „ë¶ ë‚¨ì›', 0, 1, 72, '2026-02-18 12:18:13'),
(29, 'ì œì£¼ ê°ê·¤', 17, 1, 'ì œì£¼ ì²­ì • ê°ê·¤', 28000.00, 22400.00, 3500.00, 150, '/images/products/local11.jpg', 'local', 3000.00, 'ì œì£¼ë„', 1, 1, 180, '2026-02-18 12:18:13'),
(30, 'ì„œìš¸ ì „í†µì£¼', 22, 2, 'ì„œìš¸ ì „í†µ ë§‰ê±¸ë¦¬', 18000.00, 14400.00, 3000.00, 80, '/images/products/local12.jpg', 'local', 750.00, 'ì„œìš¸', 0, 1, 92, '2026-02-18 12:18:13'),
(31, 'ì´ì²œ ìŒ€', 17, 1, 'ì„ê¸ˆë‹˜í‘œ ì´ì²œìŒ€', 45000.00, 36000.00, 3500.00, 100, '/images/products/local13.jpg', 'local', 10000.00, 'ê²½ê¸° ì´ì²œ', 1, 1, 160, '2026-02-18 12:18:13'),
(32, 'ë‹´ì–‘ ì£½ìˆœ', 17, 2, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ì£½ìˆœ', 32000.00, 25600.00, 3000.00, 60, '/images/products/local14.jpg', 'local', 1000.00, 'ì „ë‚¨ ë‹´ì–‘', 0, 1, 78, '2026-02-18 12:18:13'),
(33, 'ê³µì£¼ ë°¤', 17, 1, 'ê³µì£¼ ì•Œë°¤', 28000.00, 22400.00, 3000.00, 90, '/images/products/local15.jpg', 'local', 2000.00, 'ì¶©ë‚¨ ê³µì£¼', 0, 1, 85, '2026-02-18 12:18:13'),
(34, 'ë³´ë ¹ êµ´ë¹„', 19, 2, 'ë³´ë ¹ ëª…í’ˆ êµ´ë¹„', 55000.00, 44000.00, 3500.00, 50, '/images/products/local16.jpg', 'local', 1200.00, 'ì¶©ë‚¨ ë³´ë ¹', 1, 1, 125, '2026-02-18 12:18:13'),
(35, 'ì˜ê´‘ ëª¨ì‹œ', 29, 1, 'ì˜ê´‘ ëª¨ì‹œ ì˜ë¥˜', 85000.00, 68000.00, 3000.00, 40, '/images/products/local17.jpg', 'local', 500.00, 'ì „ë‚¨ ì˜ê´‘', 0, 1, 68, '2026-02-18 12:18:13'),
(36, 'ë‚˜ì£¼ ë°°', 17, 2, 'ë‚˜ì£¼ ì‹ ê³ ë°°', 38000.00, 30400.00, 3500.00, 80, '/images/products/local18.jpg', 'local', 5000.00, 'ì „ë‚¨ ë‚˜ì£¼', 1, 1, 145, '2026-02-18 12:18:13'),
(37, 'ì˜ì–‘ ê³ ì¶”', 24, 1, 'ì˜ì–‘ ì²­ì • ê³ ì¶”', 42000.00, 33600.00, 3000.00, 70, '/images/products/local19.jpg', 'local', 500.00, 'ê²½ë¶ ì˜ì–‘', 0, 1, 95, '2026-02-18 12:18:13'),
(38, 'ì˜ì„± ë§ˆëŠ˜', 24, 2, 'ì˜ì„± ìœ¡ìª½ë§ˆëŠ˜', 35000.00, 28000.00, 3000.00, 90, '/images/products/local20.jpg', 'local', 1000.00, 'ê²½ë¶ ì˜ì„±', 1, 1, 132, '2026-02-18 12:18:13'),
(39, 'ì²­ì†¡ ì‚¬ê³¼', 17, 1, 'ì²­ì†¡ ì£¼ì™•ì‚° ì‚¬ê³¼', 45000.00, 36000.00, 3500.00, 100, '/images/products/local21.jpg', 'local', 5000.00, 'ê²½ë¶ ì²­ì†¡', 1, 1, 170, '2026-02-18 12:18:13'),
(40, 'ì˜ë• ëŒ€ê²Œ', 19, 2, 'ì˜ë• íŠ¹ì‚° ëŒ€ê²Œ', 95000.00, 76000.00, 5000.00, 30, '/images/products/local22.jpg', 'local', 1500.00, 'ê²½ë¶ ì˜ë•', 1, 1, 155, '2026-02-18 12:18:13'),
(41, 'ìš¸ë¦‰ë„ ì˜¤ì§•ì–´', 19, 1, 'ìš¸ë¦‰ë„ ê±´ì˜¤ì§•ì–´', 48000.00, 38400.00, 3500.00, 50, '/images/products/local23.jpg', 'local', 500.00, 'ê²½ë¶ ìš¸ë¦‰', 0, 1, 88, '2026-02-18 12:18:13'),
(42, 'ì‚¼ì²™ ê±´ì–´ë¬¼', 19, 2, 'ì‚¼ì²™ íŠ¹ì‚° ê±´ì–´ë¬¼', 32000.00, 25600.00, 3000.00, 60, '/images/products/local24.jpg', 'local', 800.00, 'ê°•ì› ì‚¼ì²™', 0, 1, 75, '2026-02-18 12:18:13'),
(43, 'ì†ì´ˆ ì˜¤ì§•ì–´ìˆœëŒ€', 18, 1, 'ì†ì´ˆ ëª…ë¬¼ ì˜¤ì§•ì–´ìˆœëŒ€', 25000.00, 20000.00, 3500.00, 70, '/images/products/local25.jpg', 'local', 600.00, 'ê°•ì› ì†ì´ˆ', 0, 1, 98, '2026-02-18 12:18:13'),
(44, 'íš¡ì„± í•œìš°', 20, 2, 'íš¡ì„± 1++ë“±ê¸‰ í•œìš°', 120000.00, 96000.00, 5000.00, 40, '/images/products/local26.jpg', 'local', 2000.00, 'ê°•ì› íš¡ì„±', 1, 1, 185, '2026-02-18 12:18:13'),
(45, 'í‰ì°½ ì†¡ì´ë²„ì„¯', 17, 1, 'í‰ì°½ ìì—°ì‚° ì†¡ì´', 150000.00, 120000.00, 5000.00, 20, '/images/products/local27.jpg', 'local', 500.00, 'ê°•ì› í‰ì°½', 1, 1, 210, '2026-02-18 12:18:13'),
(46, 'ì •ì„  ê³¤ë“œë ˆ', 17, 2, 'ì •ì„  ì‚°ë‚˜ë¬¼ ê³¤ë“œë ˆ', 28000.00, 22400.00, 3000.00, 80, '/images/products/local28.jpg', 'local', 300.00, 'ê°•ì› ì •ì„ ', 0, 1, 82, '2026-02-18 12:18:13'),
(47, 'ì–‘êµ¬ ì‹œë˜ê¸°', 17, 1, 'ì–‘êµ¬ ì²­ì • ì‹œë˜ê¸°', 22000.00, 17600.00, 3000.00, 90, '/images/products/local29.jpg', 'local', 500.00, 'ê°•ì› ì–‘êµ¬', 0, 1, 76, '2026-02-18 12:18:13'),
(48, 'ì¸ì œ ì‚°ë‚˜ë¬¼', 17, 2, 'ì¸ì œ ìì—°ì‚° ì‚°ë‚˜ë¬¼', 35000.00, 28000.00, 3000.00, 70, '/images/products/local30.jpg', 'local', 400.00, 'ê°•ì› ì¸ì œ', 0, 1, 88, '2026-02-18 12:18:13'),
(49, 'í™”ì²œ í† ë§ˆí† ', 17, 1, 'í™”ì²œ ë°©ìš¸í† ë§ˆí† ', 28000.00, 22400.00, 3500.00, 100, '/images/products/local31.jpg', 'local', 2000.00, 'ê°•ì› í™”ì²œ', 0, 1, 95, '2026-02-18 12:18:13'),
(50, 'ì² ì› ì˜¤ëŒ€ìŒ€', 17, 2, 'ì² ì› DMZ ì˜¤ëŒ€ìŒ€', 42000.00, 33600.00, 3500.00, 80, '/images/products/local32.jpg', 'local', 10000.00, 'ê°•ì› ì² ì›', 1, 1, 165, '2026-02-18 12:18:13');

INSERT INTO events (id, title, category, description, location, start_date, end_date, max_participants, current_participants, price, image_url, is_featured, status, created_at) VALUES 
(1, 'ì œì£¼ ì°¨ë°­ íˆ¬ì–´', 'tea', 'ì œì£¼ í•œë¼ì‚° ì°¨ë°­ ê²¬í•™ê³¼ ì°¨ ë§Œë“¤ê¸° ì²´í—˜', 'ì œì£¼ë„', '2026-03-15', '2026-03-15', 30, 12, 45000, '/images/events/event1.jpg', 1, 'open', '2026-02-18 12:18:13'),
(2, 'í•˜ë™ ì•¼ìƒì°¨ ì²´í—˜', 'tea', 'ì§€ë¦¬ì‚° ì•¼ìƒì°¨ ì±„ì·¨ ì²´í—˜', 'ê²½ë‚¨ í•˜ë™', '2026-03-20', '2026-03-20', 20, 8, 55000, '/images/events/event2.jpg', 1, 'open', '2026-02-18 12:18:13'),
(3, 'ë³´ì„± ë…¹ì°¨ë°­ ì¶•ì œ', 'tea', 'ë³´ì„± ë…¹ì°¨ë°­ ì¶•ì œ ë° ì°¨ ì‹œìŒíšŒ', 'ì „ë‚¨ ë³´ì„±', '2026-04-05', '2026-04-07', 100, 45, 35000, '/images/events/event3.jpg', 1, 'open', '2026-02-18 12:18:13'),
(4, 'ì´ì²œ ë„ìê¸° ë§Œë“¤ê¸°', 'craft', 'ì´ì²œ ë„ìê¸° ê³µë°© ì²´í—˜', 'ê²½ê¸° ì´ì²œ', '2026-03-22', '2026-03-22', 15, 10, 75000, '/images/events/event4.jpg', 1, 'open', '2026-02-18 12:18:13'),
(5, 'ê´‘ì£¼ ë¶„ì²­ì‚¬ê¸° ì²´í—˜', 'craft', 'ì „í†µ ë¶„ì²­ì‚¬ê¸° ì œì‘ ì²´í—˜', 'ê²½ê¸° ê´‘ì£¼', '2026-03-25', '2026-03-25', 12, 6, 85000, '/images/events/event5.jpg', 0, 'open', '2026-02-18 12:18:13'),
(6, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ê³µì˜ˆ', 'craft', 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ê³µì˜ˆ ë§Œë“¤ê¸°', 'ì „ë‚¨ ë‹´ì–‘', '2026-04-01', '2026-04-01', 20, 15, 45000, '/images/events/event6.jpg', 1, 'open', '2026-02-18 12:18:13'),
(7, 'ì•ˆë™ í•œì§€ ê³µì˜ˆ', 'craft', 'ì•ˆë™ ì „í†µ í•œì§€ ê³µì˜ˆ ì²´í—˜', 'ê²½ë¶ ì•ˆë™', '2026-04-08', '2026-04-08', 18, 9, 38000, '/images/events/event7.jpg', 0, 'open', '2026-02-18 12:18:13'),
(8, 'ì „ì£¼ ë‚˜ì „ì¹ ê¸° ì²´í—˜', 'craft', 'ì „ì£¼ ì „í†µ ë‚˜ì „ì¹ ê¸° ë§Œë“¤ê¸°', 'ì „ë¶ ì „ì£¼', '2026-04-12', '2026-04-12', 10, 7, 95000, '/images/events/event8.jpg', 1, 'open', '2026-02-18 12:18:13'),
(9, 'ê°•ì§„ ì²­ì ì²´í—˜', 'craft', 'ê³ ë ¤ì²­ì ë„ìê¸° ë§Œë“¤ê¸°', 'ì „ë‚¨ ê°•ì§„', '2026-04-15', '2026-04-15', 15, 5, 68000, '/images/events/event9.jpg', 0, 'open', '2026-02-18 12:18:13'),
(10, 'ë‚¨ì› ëª©ê³µì˜ˆ ì²´í—˜', 'craft', 'ì „í†µ ëª©ê³µì˜ˆ ë§Œë“¤ê¸°', 'ì „ë¶ ë‚¨ì›', '2026-04-18', '2026-04-18', 12, 8, 52000, '/images/events/event10.jpg', 0, 'open', '2026-02-18 12:18:13'),
(11, 'ë´„ ì°¨ ëª…ìƒ íë§', 'meditation', 'ë´„ ì°¨ ëª…ìƒê³¼ íë§ í”„ë¡œê·¸ë¨', 'ì œì£¼ë„', '2026-03-28', '2026-03-29', 25, 18, 120000, '/images/events/event11.jpg', 1, 'open', '2026-02-18 12:18:13'),
(12, 'ë‹¤ë„ ì…ë¬¸ êµì‹¤', 'education', 'ì „í†µ ë‹¤ë„ ê¸°ì´ˆ êµìœ¡', 'ì„œìš¸', '2026-04-02', '2026-04-02', 15, 12, 50000, '/images/events/event12.jpg', 1, 'open', '2026-02-18 12:18:13'),
(13, 'ì°¨ì™€ ìŒì‹ í˜ì–´ë§', 'tea', 'ì°¨ì™€ ìŒì‹ì˜ ì¡°í™” ì²´í—˜', 'ì„œìš¸', '2026-04-10', '2026-04-10', 20, 14, 65000, '/images/events/event13.jpg', 0, 'open', '2026-02-18 12:18:13'),
(14, 'ì—¬ë¦„ ì°¨ë°­ ìº í•‘', 'tea', 'ë³´ì„± ì°¨ë°­ì—ì„œì˜ 1ë°• 2ì¼ ìº í•‘', 'ì „ë‚¨ ë³´ì„±', '2026-06-15', '2026-06-16', 30, 8, 95000, '/images/events/event14.jpg', 1, 'open', '2026-02-18 12:18:13'),
(15, 'ì œì£¼ ì°¨ ë§Œë“¤ê¸° ì›Œí¬ìƒµ', 'tea', 'ì°¨ ì œì¡° ê³¼ì • ì „ì²´ ì²´í—˜', 'ì œì£¼ë„', '2026-05-08', '2026-05-09', 15, 6, 150000, '/images/events/event15.jpg', 1, 'open', '2026-02-18 12:18:13'),
(16, 'ì „í†µ ê³µì˜ˆ ë°•ëŒíšŒ', 'craft', 'ì „êµ­ ì „í†µ ê³µì˜ˆ ì‘ê°€ ì‘í’ˆì „', 'ì„œìš¸', '2026-05-20', '2026-05-25', 500, 120, 15000, '/images/events/event16.jpg', 1, 'open', '2026-02-18 12:18:13'),
(17, 'ì°¨ ì†Œë¯ˆë¦¬ì— ì…ë¬¸', 'education', 'ì°¨ ì†Œë¯ˆë¦¬ì— ê¸°ì´ˆ ê³¼ì •', 'ì„œìš¸', '2026-05-15', '2026-05-16', 20, 16, 180000, '/images/events/event17.jpg', 1, 'open', '2026-02-18 12:18:13'),
(18, 'ê°€ì„ ì°¨ ì¶•ì œ', 'tea', 'ì „êµ­ ì°¨ ìƒì‚°ì§€ ì—°í•© ì¶•ì œ', 'ì „ë‚¨ ë³´ì„±', '2026-09-15', '2026-09-17', 200, 85, 25000, '/images/events/event18.jpg', 1, 'open', '2026-02-18 12:18:13'),
(19, 'ëª…ìƒê³¼ ì°¨ ëª…ìƒ', 'meditation', 'ë§ˆìŒì±™ê¹€ ëª…ìƒê³¼ ì°¨ ëª…ìƒ', 'ê²½ê¸° ì–‘í‰', '2026-07-20', '2026-07-21', 18, 12, 110000, '/images/events/event19.jpg', 0, 'open', '2026-02-18 12:18:13'),
(20, 'ë„ìê¸° ê³ ê¸‰ ê³¼ì •', 'craft', 'ë„ìê¸° ì œì‘ ì‹¬í™” ê³¼ì •', 'ê²½ê¸° ì´ì²œ', '2026-06-10', '2026-06-11', 10, 8, 220000, '/images/events/event20.jpg', 0, 'open', '2026-02-18 12:18:13'),
(21, 'ê²¨ìš¸ ì°¨ ëª…ìƒ íë§', 'meditation', 'ê²¨ìš¸ ì°¨ ëª…ìƒ 1ë°• 2ì¼', 'ê°•ì› í‰ì°½', '2026-12-15', '2026-12-16', 20, 5, 135000, '/images/events/event21.jpg', 1, 'open', '2026-02-18 12:18:13'),
(22, 'ì„¤ ëª…ì ˆ ì„ ë¬¼ íŠ¹ë³„ì „', 'gift', 'ì„¤ ëª…ì ˆ ì°¨ ì„ ë¬¼ íŠ¹ë³„ì „', 'ì„œìš¸', '2027-01-20', '2027-01-28', 300, 95, 0, '/images/events/event22.jpg', 1, 'open', '2026-02-18 12:18:13'),
(23, 'ì¶”ì„ ì„ ë¬¼ íŠ¹ë³„ì „', 'gift', 'ì¶”ì„ ëª…ì ˆ ì°¨ ì„ ë¬¼ íŠ¹ë³„ì „', 'ì„œìš¸', '2026-08-25', '2026-09-05', 300, 145, 0, '/images/events/event23.jpg', 1, 'open', '2026-02-18 12:18:13'),
(24, 'ì–´ë¦°ì´ ë‹¤ë„ êµì‹¤', 'education', 'ì–´ë¦°ì´ë¥¼ ìœ„í•œ ë‹¤ë„ ì²´í—˜', 'ì„œìš¸', '2026-07-28', '2026-07-30', 25, 20, 45000, '/images/events/event24.jpg', 0, 'open', '2026-02-18 12:18:13'),
(25, 'ê¸°ì—… ì„ì§ì› íë§ í”„ë¡œê·¸ë¨', 'meditation', 'ê¸°ì—… ì„ì§ì› ì°¨ ëª…ìƒ íë§', 'ê²½ê¸° ê°€í‰', '2026-08-14', '2026-08-15', 40, 30, 95000, '/images/events/event25.jpg', 0, 'open', '2026-02-18 12:18:13'),
(26, 'ì „í†µ ì°¨ ì œì¡° ë¹„ë²•', 'tea', 'ì „í†µ ì°¨ ì œì¡° ì¥ì¸ì˜ ë¹„ë²• ì „ìˆ˜', 'ê²½ë‚¨ í•˜ë™', '2026-10-10', '2026-10-12', 12, 10, 280000, '/images/events/event26.jpg', 1, 'open', '2026-02-18 12:18:13'),
(27, 'ì—°ë§ ê°ì‚¬ ê³ ê° í–‰ì‚¬', 'gift', 'ì—°ë§ ê³ ê° ê°ì‚¬ íŠ¹ë³„ í–‰ì‚¬', 'ì„œìš¸', '2026-12-20', '2026-12-22', 100, 68, 0, '/images/events/event27.jpg', 0, 'open', '2026-02-18 12:18:13');

INSERT INTO experiences (id, title, category, description, location, duration, price, max_participants, difficulty, image_url, is_featured, status, included_items, created_at) VALUES 
(1, 'ì œì£¼ ì°¨ë°­ íŠ¸ë ˆí‚¹', 'tea', 'ì œì£¼ í•œë¼ì‚° ì°¨ë°­ íŠ¸ë ˆí‚¹ê³¼ ì°¨ ì‹œìŒ', 'ì œì£¼ë„', '3ì‹œê°„', 45000, 20, 'easy', '/images/exp/exp1.jpg', 1, 'available', 'ê°€ì´ë“œ, ì°¨ ì‹œìŒ, ë‹¤ê³¼', '2026-02-18 12:18:13'),
(2, 'í•˜ë™ ì°¨ ë§Œë“¤ê¸° ì²´í—˜', 'tea', 'ì „í†µ ë°©ì‹ìœ¼ë¡œ ì°¨ ë§Œë“¤ê¸°', 'ê²½ë‚¨ í•˜ë™', '4ì‹œê°„', 65000, 15, 'medium', '/images/exp/exp2.jpg', 1, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ í¬ì¥', '2026-02-18 12:18:13'),
(3, 'ì´ì²œ ë„ìê¸° ì›ë°ì´ í´ë˜ìŠ¤', 'craft', 'ë¬¼ë ˆë¥¼ ì´ìš©í•œ ë„ìê¸° ë§Œë“¤ê¸°', 'ê²½ê¸° ì´ì²œ', '5ì‹œê°„', 95000, 10, 'medium', '/images/exp/exp3.jpg', 1, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ ë°°ì†¡', '2026-02-18 12:18:13'),
(4, 'ë‹´ì–‘ ì£½ì œí’ˆ ë§Œë“¤ê¸°', 'craft', 'ëŒ€ë‚˜ë¬´ë¥¼ ì´ìš©í•œ ìƒí™œìš©í’ˆ ì œì‘', 'ì „ë‚¨ ë‹´ì–‘', '3ì‹œê°„', 48000, 12, 'easy', '/images/exp/exp4.jpg', 0, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ', '2026-02-18 12:18:13'),
(5, 'ì „ì£¼ í•œì§€ ê³µì˜ˆ ì²´í—˜', 'craft', 'ì „í†µ í•œì§€ë¥¼ ì´ìš©í•œ ê³µì˜ˆí’ˆ ë§Œë“¤ê¸°', 'ì „ë¶ ì „ì£¼', '3ì‹œê°„', 42000, 15, 'easy', '/images/exp/exp5.jpg', 0, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ', '2026-02-18 12:18:13'),
(6, 'ì°¨ ëª…ìƒ íë§ í”„ë¡œê·¸ë¨', 'meditation', 'ì°¨ë¥¼ ë§ˆì‹œë©° í•˜ëŠ” ëª…ìƒ í”„ë¡œê·¸ë¨', 'ì œì£¼ë„', '2ì‹œê°„', 55000, 12, 'easy', '/images/exp/exp6.jpg', 1, 'available', 'ê°€ì´ë“œ, ì°¨, ë‹¤ê³¼', '2026-02-18 12:18:13'),
(7, 'ë‹¤ë„ ì˜ˆì ˆ êµìœ¡', 'education', 'ì „í†µ ë‹¤ë„ ì˜ˆì ˆ ë°°ìš°ê¸°', 'ì„œìš¸', '2ì‹œê°„', 40000, 15, 'easy', '/images/exp/exp7.jpg', 1, 'available', 'ê°€ì´ë“œ, êµì¬, ì°¨', '2026-02-18 12:18:13'),
(8, 'ì°¨ì™€ ìŒì‹ í˜ì–´ë§ í´ë˜ìŠ¤', 'tea', 'ì°¨ì™€ ì–´ìš¸ë¦¬ëŠ” ìŒì‹ ì¡°í•© ë°°ìš°ê¸°', 'ì„œìš¸', '3ì‹œê°„', 75000, 12, 'medium', '/images/exp/exp8.jpg', 0, 'available', 'ê°€ì´ë“œ, ì°¨, ìŒì‹ ì¬ë£Œ', '2026-02-18 12:18:13'),
(9, 'ì²­ì ë„ìê¸° ì²´í—˜', 'craft', 'ê³ ë ¤ì²­ì ë§Œë“¤ê¸°', 'ì „ë‚¨ ê°•ì§„', '4ì‹œê°„', 72000, 10, 'medium', '/images/exp/exp9.jpg', 1, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ ë°°ì†¡', '2026-02-18 12:18:13'),
(10, 'ë‚˜ì „ì¹ ê¸° ì²´í—˜', 'craft', 'ì „í†µ ë‚˜ì „ì¹ ê¸° ì†Œí’ˆ ë§Œë“¤ê¸°', 'ì „ë¶ ì „ì£¼', '6ì‹œê°„', 120000, 8, 'hard', '/images/exp/exp10.jpg', 0, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ', '2026-02-18 12:18:13'),
(11, 'ì°¨ë°­ ìš”ê°€ ëª…ìƒ', 'meditation', 'ì°¨ë°­ì—ì„œ í•˜ëŠ” ìš”ê°€ì™€ ëª…ìƒ', 'ì „ë‚¨ ë³´ì„±', '2ì‹œê°„', 48000, 15, 'easy', '/images/exp/exp11.jpg', 1, 'available', 'ê°€ì´ë“œ, ìš”ê°€ë§¤íŠ¸, ì°¨', '2026-02-18 12:18:13'),
(12, 'ì°¨ ì†Œë¯ˆë¦¬ì— ì²´í—˜', 'education', 'ë‹¤ì–‘í•œ ì°¨ ê°ë³„ ë° ì‹œìŒ', 'ì„œìš¸', '3ì‹œê°„', 85000, 10, 'medium', '/images/exp/exp12.jpg', 0, 'available', 'ê°€ì´ë“œ, êµì¬, ì°¨ ìƒ˜í”Œ', '2026-02-18 12:18:13');

INSERT INTO education_categories (id, parent_id, name, description, display_order, icon, created_at) VALUES 
(1, NULL, 'ë‹¤ë„êµìœ¡', 'ì°¨ë¬¸í™”ì™€ ëª…ìƒì„ í†µí•œ ë§ˆìŒì˜ í‰ì•ˆ', 1, 'fa-spa', '2026-02-18 12:18:04'),
(2, 1, 'ì°¨ê³µë¶€', 'ì°¨ì˜ ì—­ì‚¬ì™€ ë¬¸í™”, ì¢…ë¥˜ì™€ ìš°ë¦¬ëŠ” ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤', 1, 'fa-mug-hot', '2026-02-18 12:18:04'),
(3, 1, 'ê³µì˜ˆê³µë¶€', 'í•œêµ­ ì „í†µ ê³µì˜ˆì˜ ì—­ì‚¬ì™€ ì œì‘ ê¸°ë²•ì„ ë°°ì›ë‹ˆë‹¤', 2, 'fa-palette', '2026-02-18 12:18:04'),
(4, 1, 'ë‹¤ë„êµìœ¡', 'ë‹¤ë„ì˜ ì˜ë¯¸ì™€ ì—­ì‚¬, ëª…ìƒê³¼ ì¸ì„±êµìœ¡ì„ ë°°ì›ë‹ˆë‹¤', 3, 'fa-spa', '2026-02-18 12:18:06'),
(5, 1, 'ëª…ìƒêµìœ¡', 'ëª…ìƒì˜ ì—­ì‚¬ì™€ ì¢…ë¥˜, ì‹¤ì²œ ë°©ë²•ì„ ë°°ìš°ê³  ë§ˆìŒì˜ í‰ì•ˆì„ ì°¾ìŠµë‹ˆë‹¤', 4, 'fa-om', '2026-02-18 13:59:11');

INSERT INTO education_curriculum (id, category_id, title, description, content, duration, difficulty, display_order, thumbnail_image, created_at) VALUES 
(1, 2, 'ì°¨ì˜ ì—­ì‚¬', 'ì°¨ì˜ ê¸°ì›ë¶€í„° í˜„ëŒ€ê¹Œì§€ì˜ ì—­ì‚¬ë¥¼ ë°°ì›ë‹ˆë‹¤', 'ì°¨ì˜ ë°œê²¬ê³¼ ì „íŒŒ, í•œêµ­ ì°¨ë¬¸í™”ì˜ ë°œì „ ê³¼ì •ì„ í•™ìŠµí•©ë‹ˆë‹¤', '90ë¶„', 'beginner', 1, '/images/curriculum/tea_history.jpg', '2026-02-18 12:18:04'),
(2, 2, 'í•œêµ­ì°¨ì˜ ì—­ì‚¬', 'í•œêµ­ ì „í†µì°¨ì˜ ì—­ì‚¬ì™€ ë¬¸í™”ì  ë°°ê²½', 'ì‚¼êµ­ì‹œëŒ€ë¶€í„° ì¡°ì„ ì‹œëŒ€ê¹Œì§€ í•œêµ­ ì°¨ë¬¸í™”ì˜ ë°œì „ì‚¬', '120ë¶„', 'intermediate', 2, '/images/curriculum/korean_tea_history.jpg', '2026-02-18 12:18:04'),
(3, 2, '6ëŒ€ ì°¨ë¥˜', 'ì°¨ì˜ 6ê°€ì§€ ë¶„ë¥˜ì™€ ê°ê°ì˜ íŠ¹ì§•', 'ë…¹ì°¨, ë°±ì°¨, í™©ì°¨, ì²­ì°¨, í™ì°¨, í‘ì°¨ì˜ ë¶„ë¥˜ì™€ íŠ¹ì„±', '150ë¶„', 'intermediate', 3, '/images/curriculum/six_types.jpg', '2026-02-18 12:18:04'),
(4, 2, 'í•œêµ­ì°¨ì˜ ì¢…ë¥˜', 'í•œêµ­ ì „í†µì°¨ì˜ ë‹¤ì–‘í•œ ì¢…ë¥˜', 'ë…¹ì°¨, ë°œíš¨ì°¨, ê°€í–¥ì°¨ ë“± í•œêµ­ ì°¨ì˜ ë¶„ë¥˜ì™€ íŠ¹ì§•', '120ë¶„', 'intermediate', 4, '/images/curriculum/korean_tea_types.jpg', '2026-02-18 12:18:04'),
(5, 2, 'ì°¨ì˜ ì´ë¡œìš´ ì ', 'ì°¨ì˜ ê±´ê°•ìƒ ì´ì ê³¼ íš¨ëŠ¥', 'ì°¨ì˜ ì„±ë¶„ê³¼ ê±´ê°• íš¨ëŠ¥, ì˜¬ë°”ë¥¸ ì„­ì·¨ ë°©ë²•', '90ë¶„', 'beginner', 5, '/images/curriculum/tea_benefits.jpg', '2026-02-18 12:18:04'),
(6, 2, '6ëŒ€ ì°¨ë¥˜ ìš°ë¦¬ëŠ” ë°©ë²•', 'ì°¨ ì¢…ë¥˜ë³„ ì˜¬ë°”ë¥¸ ìš°ë¦¬ëŠ” ë°©ë²•', 'ê° ì°¨ë¥˜ë³„ ìµœì ì˜ ì˜¨ë„, ì‹œê°„, ë¬¼ì˜ ì–‘', '180ë¶„', 'advanced', 6, '/images/curriculum/brewing_methods.jpg', '2026-02-18 12:18:04'),
(7, 3, 'ê³µì˜ˆì˜ ì—­ì‚¬', 'í•œêµ­ ì „í†µ ê³µì˜ˆì˜ ì—­ì‚¬', 'ì‚¼êµ­ì‹œëŒ€ë¶€í„° í˜„ëŒ€ê¹Œì§€ í•œêµ­ ê³µì˜ˆì˜ ë°œì „ì‚¬', '90ë¶„', 'beginner', 1, '/images/curriculum/craft_history.jpg', '2026-02-18 12:18:04'),
(8, 3, 'í•œêµ­ê³µì˜ˆì˜ ì‹œëŒ€ë³„ ë³€ì²œì‚¬', 'ì‹œëŒ€ë³„ í•œêµ­ ê³µì˜ˆì˜ íŠ¹ì§•ê³¼ ë³€í™”', 'ì‹œëŒ€ë³„ ê³µì˜ˆ ê¸°ë²•ê³¼ ì–‘ì‹ì˜ ë³€ì²œ', '150ë¶„', 'intermediate', 2, '/images/curriculum/craft_evolution.jpg', '2026-02-18 12:18:04'),
(9, 3, 'ë„ìê¸°ì˜ ì œì‘ ê¸°ë²•', 'ì „í†µ ë„ìê¸° ì œì‘ ê¸°ë²•', 'ë¬¼ë ˆ ì„±í˜•, ìœ ì•½, ì†Œì„± ë“± ë„ìê¸° ì œì‘ ê³¼ì •', '180ë¶„', 'advanced', 3, '/images/curriculum/pottery_technique.jpg', '2026-02-18 12:18:04'),
(10, 3, 'ë„ìê¸°ì˜ í™œìš©ë²•', 'ë„ìê¸°ì˜ ë‹¤ì–‘í•œ í™œìš©', 'ë‹¤ê¸°, ìƒí™œìš©ê¸°, ì¥ì‹í’ˆ ë“± ë„ìê¸° í™œìš©', '90ë¶„', 'beginner', 4, '/images/curriculum/pottery_usage.jpg', '2026-02-18 12:18:04'),
(11, 3, 'ë„ìê¸°ì˜ ì´ë¡œìš´ ì ', 'ë„ìê¸° ì‚¬ìš©ì˜ ì¥ì ', 'ê±´ê°•ìƒ ì´ì ê³¼ ì¹œí™˜ê²½ì  ê°€ì¹˜', '90ë¶„', 'beginner', 5, '/images/curriculum/pottery_benefits.jpg', '2026-02-18 12:18:04'),
(12, 3, 'ì„œì˜ˆì˜ ì—­ì‚¬ì™€ ë°œì „', 'í•œêµ­ ì„œì˜ˆì˜ ì—­ì‚¬', 'í•œê¸€ê³¼ í•œë¬¸ ì„œì˜ˆì˜ ë°œì „ ê³¼ì •', '120ë¶„', 'intermediate', 6, '/images/curriculum/calligraphy_history.jpg', '2026-02-18 12:18:04'),
(13, 3, 'í•œêµ­ ì „í†µë¯¸ìˆ ê³¼ ë¯¼í™”', 'ë¯¼í™”ì˜ ì—­ì‚¬ì™€ íŠ¹ì§•', 'ë¯¼í™”ì˜ ì¢…ë¥˜ì™€ ì˜ë¯¸, í˜„ëŒ€ì  í•´ì„', '90ë¶„', 'intermediate', 7, '/images/curriculum/minhwa.jpg', '2026-02-18 12:18:04'),
(14, 3, 'í•œë³µì˜ ì—­ì‚¬ì™€ ì•„ë¦„ë‹¤ì›€', 'í•œë³µì˜ ì—­ì‚¬ì™€ ë¯¸í•™', 'í•œë³µì˜ êµ¬ì¡°, ìƒ‰ìƒ, ë¬¸ì–‘ì˜ ì˜ë¯¸', '90ë¶„', 'beginner', 8, '/images/curriculum/hanbok.jpg', '2026-02-18 12:18:04'),
(15, 3, 'í•œì§€ì˜ ì—­ì‚¬ì™€ ì œì¡°ë²•', 'ì „í†µ í•œì§€ì˜ ì—­ì‚¬ì™€ ì œì‘', 'í•œì§€ì˜ ì œì¡° ê³¼ì •ê³¼ íŠ¹ì„±, í˜„ëŒ€ì  í™œìš©', '120ë¶„', 'intermediate', 9, '/images/curriculum/hanji.jpg', '2026-02-18 12:18:04'),
(16, 4, 'ë‹¤ë„ì˜ ì˜ë¯¸', 'ë‹¤ë„ì˜ ì •ì‹ ê³¼ ì² í•™', 'ì°¨ë¥¼ í†µí•œ ìˆ˜ì–‘ê³¼ ì˜ˆì ˆì˜ ì˜ë¯¸', '120ë¶„', 'beginner', 1, '/images/curriculum/dado_meaning.jpg', '2026-02-18 12:18:06'),
(17, 4, 'ë‹¤ë„ì˜ ì—­ì‚¬ì™€ ì‹œëŒ€ì  ë³€ì²œì‚¬', 'í•œêµ­ ë‹¤ë„ì˜ ì—­ì‚¬ì  ë°œì „', 'ì‹œëŒ€ë³„ ë‹¤ë„ ë¬¸í™”ì˜ ë³€í™”ì™€ íŠ¹ì§•', '150ë¶„', 'intermediate', 2, '/images/curriculum/dado_history.jpg', '2026-02-18 12:18:06'),
(18, 4, 'ë‹¤ë„ì˜ ì¢…ë¥˜', 'ë‹¤ì–‘í•œ ë‹¤ë„ì˜ ìœ í˜•', 'í•œêµ­, ì¤‘êµ­, ì¼ë³¸ ë‹¤ë„ì˜ íŠ¹ì§• ë¹„êµ', '120ë¶„', 'intermediate', 3, '/images/curriculum/dado_types.jpg', '2026-02-18 12:18:06'),
(19, 4, 'ë‹¤ë„ì™€ ëª…ìƒì˜ íš¨ê³¼', 'ë‹¤ë„ë¥¼ í†µí•œ ëª…ìƒ íš¨ê³¼', 'ë§ˆìŒì˜ í‰ì•ˆê³¼ ì§‘ì¤‘ë ¥ í–¥ìƒ', '90ë¶„', 'beginner', 4, '/images/curriculum/dado_meditation.jpg', '2026-02-18 12:18:06'),
(20, 4, 'ì¸ì„±êµìœ¡ìœ¼ë¡œ ë‹¤ë„ ëª…ìƒì„ í•´ì•¼í•˜ëŠ” ì´ìœ ', 'ë‹¤ë„ë¥¼ í†µí•œ ì¸ì„± í•¨ì–‘', 'ì˜ˆì ˆ, ë°°ë ¤, ì§‘ì¤‘ë ¥ ë“± ì¸ì„± êµìœ¡', '150ë¶„', 'intermediate', 5, '/images/curriculum/dado_character.jpg', '2026-02-18 12:18:06'),
(21, 4, 'ë‹¤ë„ì˜ ì—­ì‚¬ì™€ ì •ì‹ ', 'ë‹¤ë„ì˜ ì² í•™ì  ë°°ê²½', 'ì„ ç¦ªê³¼ ì°¨ì˜ ì •ì‹ ì  ì—°ê²°', '120ë¶„', 'intermediate', 7, '/images/curriculum/dado_spirit.jpg', '2026-02-18 12:18:06'),
(22, 4, 'ë‹¤ë„êµìœ¡ì˜ ì´ë¡ ê³¼ ì‹¤ì œ', 'ë‹¤ë„ êµìœ¡ ë°©ë²•ë¡ ', 'ì´ë¡  í•™ìŠµê³¼ ì‹¤ìŠµì„ í†µí•œ ë‹¤ë„ êµìœ¡', '150ë¶„', 'advanced', 8, '/images/curriculum/dado_practice.jpg', '2026-02-18 12:18:06'),
(23, 5, 'í˜¸í¡ ëª…ìƒ', 'í˜¸í¡ì„ í†µí•œ ëª…ìƒ', 'ì˜¬ë°”ë¥¸ í˜¸í¡ë²•ê³¼ ëª…ìƒ ì‹¤ìŠµ', '45ë¶„', 'beginner', 0, '/images/curriculum/breathing.jpg', '2026-02-18 13:59:11'),
(24, 5, 'ë§ˆìŒì±™ê¹€ ëª…ìƒ', 'ë§ˆìŒì±™ê¹€ ëª…ìƒì˜ ì´ë¡ ê³¼ ì‹¤ìŠµ', 'í˜„ì¬ ìˆœê°„ì— ì§‘ì¤‘í•˜ëŠ” ëª…ìƒ', '60ë¶„', 'intermediate', 0, '/images/curriculum/mindfulness.jpg', '2026-02-18 13:59:11'),
(25, 5, 'ì°¨ ëª…ìƒ', 'ì°¨ë¥¼ ë§ˆì‹œë©° í•˜ëŠ” ëª…ìƒ', 'ì°¨ë¥¼ í†µí•œ ì˜¤ê° ëª…ìƒ', '90ë¶„', 'intermediate', 0, '/images/curriculum/tea_meditation.jpg', '2026-02-18 13:59:11'),
(26, 5, 'ìš”ê°€ì™€ ëª…ìƒ', 'ìš”ê°€ ë™ì‘ê³¼ ëª…ìƒì˜ ê²°í•©', 'ëª¸ê³¼ ë§ˆìŒì„ í•¨ê»˜ ë‹¤ìŠ¤ë¦¬ëŠ” ëª…ìƒ', '75ë¶„', 'intermediate', 0, '/images/curriculum/yoga_meditation.jpg', '2026-02-18 13:59:11'),
(27, 5, 'ëª…ìƒì˜ ì—­ì‚¬', 'ëª…ìƒì˜ ê¸°ì›ê³¼ ë°œì „', 'ë™ì„œì–‘ ëª…ìƒì˜ ì—­ì‚¬ì™€ ì² í•™', '90ë¶„', 'beginner', 1, '/images/curriculum/meditation_history.jpg', '2026-02-18 13:59:11'),
(28, 5, 'ëª…ìƒì˜ ì¢…ë¥˜ì™€ ì‹¤ì²œ', 'ë‹¤ì–‘í•œ ëª…ìƒë²•', 'í˜¸í¡ëª…ìƒ, ì„ ëª…ìƒ, ìœ„ë¹ ì‚¬ë‚˜ ë“±', '150ë¶„', 'intermediate', 2, '/images/curriculum/meditation_types.jpg', '2026-02-18 13:59:11'),
(29, 5, 'ëª…ìƒì˜ ì •ì˜ì™€ ì›ë¦¬', 'ëª…ìƒì˜ ë³¸ì§ˆê³¼ ì‘ìš© ì›ë¦¬', 'ëª…ìƒì´ ë‡Œì™€ ì‹ ì²´ì— ë¯¸ì¹˜ëŠ” ì˜í–¥', '60ë¶„', 'beginner', 2, '/images/curriculum/meditation_principle.jpg', '2026-02-18 13:59:11'),
(30, 5, 'ì¼ìƒ ì† ëª…ìƒ ì‹¤ì²œ', 'ë°”ìœ ì¼ìƒ ì† ëª…ìƒ ì ìš©', 'ì§§ì€ ì‹œê°„ìœ¼ë¡œ í•˜ëŠ” ì‹¤ìš©ì  ëª…ìƒë²•', '45ë¶„', 'beginner', 3, '/images/curriculum/daily_meditation.jpg', '2026-02-18 13:59:11');`;

  return c.text(sqlContent, 200, {
    'Content-Type': 'text/plain; charset=utf-8'
  });
})

// SQL ë³µì‚¬ í˜ì´ì§€ - ê°„ë‹¨ ë²„ì „
app.get('/copy', (c) => {
  return c.html(`<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL ë³µì‚¬ í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸ“‹ SQL ë³µì‚¬ í˜ì´ì§€</h1>
            <p class="text-gray-600 text-lg mb-8">ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì „ì²´ SQL (194ì¤„)ì´ ë³µì‚¬ë©ë‹ˆë‹¤</p>

            <button id="copyBtn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-5 px-8 rounded-xl shadow-lg text-xl mb-4">
                ğŸ“‹ SQL ì „ì²´ ë³µì‚¬í•˜ê¸° (194ì¤„)
            </button>
            
            <div id="msg" class="hidden bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg mb-6">
                <strong>ë³µì‚¬ ì™„ë£Œ!</strong> ì´ì œ Cloudflare D1 ì½˜ì†”ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg mb-6">
                <h3 class="text-xl font-bold text-blue-900 mb-3">ğŸ“Œ ì‚¬ìš© ë°©ë²•</h3>
                <ol class="list-decimal list-inside space-y-2 text-blue-800">
                    <li>"SQL ì „ì²´ ë³µì‚¬í•˜ê¸°" ë²„íŠ¼ í´ë¦­</li>
                    <li>Cloudflare Dashboard â†’ Workers & Pages â†’ D1 ì´ë™</li>
                    <li>webapp-production ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ</li>
                    <li>Console íƒ­ í´ë¦­</li>
                    <li>ì½˜ì†” ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ê¸° (Ctrl+V / Cmd+V)</li>
                    <li>Execute ë²„íŠ¼ í´ë¦­</li>
                    <li>1~2ë¶„ ëŒ€ê¸°</li>
                </ol>
            </div>

            <div class="grid grid-cols-4 gap-4">
                <div class="bg-green-100 p-4 rounded-xl text-center">
                    <div class="text-3xl font-bold text-green-700">17</div>
                    <div class="text-sm text-green-600">ì§€ì—­</div>
                </div>
                <div class="bg-blue-100 p-4 rounded-xl text-center">
                    <div class="text-3xl font-bold text-blue-700">31</div>
                    <div class="text-sm text-blue-600">ì¹´í…Œê³ ë¦¬</div>
                </div>
                <div class="bg-purple-100 p-4 rounded-xl text-center">
                    <div class="text-3xl font-bold text-purple-700">50</div>
                    <div class="text-sm text-purple-600">ì œí’ˆ</div>
                </div>
                <div class="bg-orange-100 p-4 rounded-xl text-center">
                    <div class="text-3xl font-bold text-orange-700">27</div>
                    <div class="text-sm text-orange-600">ì´ë²¤íŠ¸</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let sql = '';
        
        // í˜ì´ì§€ ë¡œë“œì‹œ SQL ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        fetch('/api/sql-content')
            .then(res => res.text())
            .then(data => {
                sql = data;
                console.log('SQL ë¡œë“œ ì™„ë£Œ:', sql.split('\\n').length, 'ì¤„');
            })
            .catch(err => {
                console.error('SQL ë¡œë“œ ì‹¤íŒ¨:', err);
                alert('SQLì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
            });

        document.getElementById('copyBtn').addEventListener('click', async () => {
            if (!sql) {
                alert('SQL ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(sql);
                document.getElementById('msg').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('msg').classList.add('hidden');
                }, 3000);
            } catch (error) {
                alert('ë³µì‚¬ ì‹¤íŒ¨: ' + error);
            }
        });
    </script>
                alert('ë³µì‚¬ ì‹¤íŒ¨: ' + error);
            }
        });
    </script>
</body>
</html>`)
})

// SQL ë³µì‚¬ í˜ì´ì§€ (ì§ì ‘ HTML ë°˜í™˜)
app.get('/copy-sql', (c) => {
  return c.html(`<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudflare D1 ì—…ë°ì´íŠ¸ SQL - ë³µì‚¬ìš©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; padding: 20px 30px; background: #f8f9fa; border-bottom: 2px solid #e9ecef; }
        .stat-item { text-align: center; padding: 10px; }
        .stat-number { font-size: 24px; font-weight: bold; color: #667eea; display: block; }
        .stat-label { font-size: 12px; color: #6c757d; margin-top: 5px; }
        .instructions { padding: 20px 30px; background: #fff3cd; border-left: 4px solid #ffc107; margin: 20px 30px; border-radius: 4px; }
        .instructions h3 { color: #856404; margin-bottom: 10px; font-size: 16px; }
        .instructions ol { margin-left: 20px; color: #856404; }
        .instructions li { margin: 5px 0; font-size: 14px; }
        .button-container { padding: 20px 30px; text-align: center; }
        .copy-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s ease; }
        .copy-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }
        .copy-btn:active { transform: translateY(0); }
        .copy-btn.copied { background: #28a745; }
        .sql-container { margin: 20px 30px; border: 2px solid #e9ecef; border-radius: 8px; overflow: hidden; }
        .sql-header { background: #343a40; color: white; padding: 12px 20px; font-family: 'Courier New', monospace; font-size: 13px; display: flex; justify-content: space-between; align-items: center; }
        .sql-content { background: #f8f9fa; padding: 20px; max-height: 500px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6; white-space: pre; color: #212529; }
        .footer { padding: 20px 30px; background: #f8f9fa; text-align: center; color: #6c757d; font-size: 13px; border-top: 2px solid #e9ecef; }
        .success-message { display: none; background: #d4edda; color: #155724; padding: 15px; margin: 20px 30px; border-radius: 8px; border: 1px solid #c3e6cb; text-align: center; font-weight: bold; }
        .success-message.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ ë‹¤ê³µ(èŒ¶å·¥) ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ SQL</h1>
            <p>Cloudflare D1 Consoleìš© - ì „ì²´ ë³µì‚¬ í›„ ë¶™ì—¬ë„£ê¸°</p>
        </div>
        <div class="stats">
            <div class="stat-item"><span class="stat-number">194</span><span class="stat-label">ì´ ë¼ì¸ ìˆ˜</span></div>
            <div class="stat-item"><span class="stat-number">17</span><span class="stat-label">ì§€ì—­</span></div>
            <div class="stat-item"><span class="stat-number">31</span><span class="stat-label">ì¹´í…Œê³ ë¦¬</span></div>
            <div class="stat-item"><span class="stat-number">50</span><span class="stat-label">ì œí’ˆ</span></div>
            <div class="stat-item"><span class="stat-number">27</span><span class="stat-label">ì´ë²¤íŠ¸</span></div>
            <div class="stat-item"><span class="stat-number">12</span><span class="stat-label">ì²´í—˜ í”„ë¡œê·¸ë¨</span></div>
            <div class="stat-item"><span class="stat-number">5</span><span class="stat-label">êµìœ¡ ì¹´í…Œê³ ë¦¬</span></div>
            <div class="stat-item"><span class="stat-number">30</span><span class="stat-label">êµìœ¡ ì»¤ë¦¬í˜ëŸ¼</span></div>
        </div>
        <div class="instructions">
            <h3>ğŸ“‹ ì‚¬ìš© ë°©ë²•</h3>
            <ol>
                <li><strong>"ì „ì²´ ë³µì‚¬" ë²„íŠ¼</strong>ì„ í´ë¦­í•˜ì„¸ìš”</li>
                <li><strong>Cloudflare ëŒ€ì‹œë³´ë“œ</strong>ë¡œ ì´ë™: <a href="https://dash.cloudflare.com/" target="_blank">https://dash.cloudflare.com/</a></li>
                <li><strong>Workers & Pages â†’ D1 â†’ webapp-production â†’ Console</strong> íƒ­ ì„ íƒ</li>
                <li>í° ì…ë ¥ì°½ì— <strong>ë¶™ì—¬ë„£ê¸°</strong> (Ctrl+V / Cmd+V)</li>
                <li><strong>Execute</strong> ë²„íŠ¼ í´ë¦­ í›„ 1-2ë¶„ ëŒ€ê¸°</li>
            </ol>
        </div>
        <div class="button-container">
            <button class="copy-btn" onclick="copySQL()">ğŸ“‹ ì „ì²´ ë³µì‚¬ (194ì¤„)</button>
        </div>
        <div class="success-message" id="successMessage">
            âœ… SQLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! Cloudflare ì½˜ì†”ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
        </div>
        <div class="sql-container">
            <div class="sql-header"><span>COPY_THIS.sql</span><span>194 lines</span></div>
            <div class="sql-content" id="sqlContent">DELETE FROM education_curriculum;
DELETE FROM education_categories;
DELETE FROM experiences;
DELETE FROM products;
DELETE FROM events;
DELETE FROM producers;
DELETE FROM categories;
DELETE FROM regions;

INSERT INTO regions (id, name, type, description, featured_image, created_at) VALUES 
(1, 'ì œì£¼ë„', 'tea', 'ì œì£¼ì˜ ì²­ì • ìì—°ì—ì„œ ìë€ ë…¹ì°¨', '/images/regions/jeju.jpg', '2026-02-18 12:18:03'),
(2, 'í•˜ë™', 'tea', 'ì§€ë¦¬ì‚° ìë½ì˜ ì „í†µ ì°¨ë°­', '/images/regions/hadong.jpg', '2026-02-18 12:18:03'),
(3, 'ê¹€í•´', 'tea', 'í•œêµ­ ì°¨ë¬¸í™”ì˜ ë°œìƒì§€', '/images/regions/gimhae.jpg', '2026-02-18 12:18:03'),
(4, 'ê´‘ì–‘', 'tea', 'ë°±ìš´ì‚° ìë½ì˜ ì²­ì • ì°¨ë°­', '/images/regions/gwangyang.jpg', '2026-02-18 12:18:03'),
(5, 'ë³´ì„±', 'tea', 'ëŒ€í•œë¯¼êµ­ ë…¹ì°¨ì˜ ìˆ˜ë„', '/images/regions/boseong.jpg', '2026-02-18 12:18:03'),
(6, 'ì´ì²œ', 'craft', 'ì „í†µ ë„ìê¸°ì˜ ë³¸ê³ ì¥', '/images/regions/icheon.jpg', '2026-02-18 12:18:03'),
(7, 'ê´‘ì£¼', 'craft', 'ì¡°ì„ ë°±ìì˜ ì¤‘ì‹¬ì§€', '/images/regions/gwangju.jpg', '2026-02-18 12:18:03'),
(8, 'ë‹´ì–‘', 'craft', 'ëŒ€ë‚˜ë¬´ ê³µì˜ˆì˜ ë©”ì¹´', '/images/regions/damyang.jpg', '2026-02-18 12:18:03'),
(9, 'ì•ˆë™', 'craft', 'í•œêµ­ ì •ì‹ ë¬¸í™”ì˜ ìˆ˜ë„', '/images/regions/andong.jpg', '2026-02-18 12:18:03'),
(10, 'ì „ì£¼', 'craft', 'í•œì§€ì™€ ì „í†µê³µì˜ˆ', '/images/regions/jeonju.jpg', '2026-02-18 12:18:03'),
(11, 'ê°•ì§„', 'craft', 'ê³ ë ¤ì²­ìì˜ ê³ í–¥', '/images/regions/gangjin.jpg', '2026-02-18 12:18:03'),
(12, 'ë‚¨ì›', 'craft', 'ì „í†µ ëª©ê³µì˜ˆì˜ ì¤‘ì‹¬', '/images/regions/namwon.jpg', '2026-02-18 12:18:03'),
(13, 'ê³µì£¼', 'craft', 'ë°±ì œ ë¬¸í™”ì˜ ë³´ê³ ', '/images/regions/gongju.jpg', '2026-02-18 12:18:03'),
(14, 'ê²½ì£¼', 'craft', 'ì‹ ë¼ ì²œë…„ì˜ ê³µì˜ˆ', '/images/regions/gyeongju.jpg', '2026-02-18 12:18:03'),
(15, 'ìš¸ì‚°', 'craft', 'ë™í•´ì•ˆ íŠ¹ì‚°í’ˆ', '/images/regions/ulsan.jpg', '2026-02-18 12:18:03'),
(16, 'ë¶€ì‚°', 'craft', 'í•´ì–‘ ë„ì‹œ íŠ¹ì‚°í’ˆ', '/images/regions/busan.jpg', '2026-02-18 12:18:03'),
(17, 'ì„œìš¸', 'craft', 'ìˆ˜ë„ê¶Œ íŠ¹ì‚°í’ˆ', '/images/regions/seoul.jpg', '2026-02-18 12:18:03');

INSERT INTO categories (id, name, type, description, display_order, created_at) VALUES 
(1, 'ë…¹ì°¨', 'tea', 'í•œêµ­ ì „í†µ ë…¹ì°¨', 1, '2026-02-18 12:18:13'),
(2, 'í™©ì°¨', 'tea', 'íŠ¹ë³„í•œ í™©ì°¨', 4, '2026-02-18 12:18:13'),
(3, 'í™ì°¨', 'tea', 'ì™„ì „ ë°œíš¨ í™ì°¨', 5, '2026-02-18 12:18:13'),
(4, 'ë°œíš¨ì°¨', 'tea', 'ì „í†µ ë°œíš¨ì°¨', 6, '2026-02-18 12:18:13'),
(6, 'ë¸”ë Œë”©ì°¨', 'tea', 'ë‹¤ì–‘í•œ ë¸”ë Œë”© ì°¨', 7, '2026-02-18 12:18:13'),
(8, 'ì°»ì”', 'craft', 'ë‹¤ì–‘í•œ ì°»ì”', 2, '2026-02-18 12:18:13'),
(9, 'ë‹¤ê´€', 'craft', 'ì „í†µ ë‹¤ê´€', 1, '2026-02-18 12:18:13'),
(11, 'ì¥ì‹í’ˆ', 'craft', 'ì¸í…Œë¦¬ì–´ ì¥ì‹í’ˆ', 9, '2026-02-18 12:18:13'),
(12, 'ëª…ì ˆ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ëª…ì ˆ íŠ¹ë³„ ì„ ë¬¼', 1, '2026-02-18 12:18:13'),
(13, 'ê¸°ë…ì¼ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ê¸°ë…ì¼ìš© ì„ ë¬¼', 2, '2026-02-18 12:18:13'),
(14, 'ê¸°ì—… ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ê¸°ì—…ìš© ì„ ë¬¼', 3, '2026-02-18 12:18:13'),
(15, 'ë§ì¶¤ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ë§ì¶¤í˜• ì„ ë¬¼', 4, '2026-02-18 12:18:13'),
(17, 'ë†ì‚°ë¬¼', 'local', 'ì§€ì—­ ë†ì‚°ë¬¼', 1, '2026-02-18 12:18:13'),
(18, 'ê°€ê³µì‹í’ˆ', 'local', 'ì§€ì—­ ê°€ê³µì‹í’ˆ', 5, '2026-02-18 12:18:13'),
(19, 'ìˆ˜ì‚°ë¬¼', 'local', 'ì§€ì—­ ìˆ˜ì‚°ë¬¼', 2, '2026-02-18 12:18:13'),
(20, 'ì¶•ì‚°ë¬¼', 'local', 'ì§€ì—­ ì¶•ì‚°ë¬¼', 3, '2026-02-18 12:18:13'),
(21, 'ê³µì˜ˆí’ˆ', 'local', 'ì§€ì—­ ê³µì˜ˆí’ˆ', 4, '2026-02-18 12:18:13'),
(22, 'ì „í†µì£¼', 'local', 'ì „í†µì£¼/ìŒë£Œ', 6, '2026-02-18 12:18:13'),
(23, 'ê±´ê°•ì‹í’ˆ', 'local', 'ê±´ê°• ì‹í’ˆ', 7, '2026-02-18 12:18:13'),
(24, 'ì¡°ë¯¸ë£Œ', 'local', 'ì²œì—° ì¡°ë¯¸ë£Œ', 8, '2026-02-18 12:18:13'),
(25, 'ê°„í¸ì‹', 'local', 'ê°„í¸ ë¨¹ê±°ë¦¬', 9, '2026-02-18 12:18:13'),
(26, 'ë””ì €íŠ¸', 'local', 'ì „í†µ ë””ì €íŠ¸', 10, '2026-02-18 12:18:13'),
(27, 'ìƒí™œìš©í’ˆ', 'local', 'ì¹œí™˜ê²½ ìƒí™œìš©í’ˆ', 11, '2026-02-18 12:18:13'),
(28, 'í™”ì¥í’ˆ', 'local', 'ì²œì—° í™”ì¥í’ˆ', 12, '2026-02-18 12:18:13'),
(29, 'ì˜ë¥˜/ì¡í™”', 'local', 'ì „í†µ ì˜ë¥˜/ì¡í™”', 13, '2026-02-18 12:18:13'),
(30, 'ì¸í…Œë¦¬ì–´', 'local', 'ì¸í…Œë¦¬ì–´ ì†Œí’ˆ', 14, '2026-02-18 12:18:13'),
(31, 'ë¬¸í™”ìƒí’ˆ', 'local', 'ë¬¸í™”/ì˜ˆìˆ  ìƒí’ˆ', 15, '2026-02-18 12:18:13');

INSERT INTO producers (id, name, region, description, contact, created_at) VALUES 
(1, 'ë°•ìˆ˜ê³µ', 'ì œì£¼ë„', 'ì œì£¼ í•œë¼ì‚° ìœ ê¸°ë† ì°¨ ë†ì›', '064-123-4567', '2026-02-18 12:18:13'),
(2, 'ì œì£¼ í•œë¼ì‚° ì°¨ë†ì›', 'ì œì£¼ë„', '3ëŒ€ì§¸ ì´ì–´ì˜¨ ì „í†µ ì°¨ ë†ì›', '064-456-7890', '2026-02-18 12:18:13');

INSERT INTO products (id, name, category_id, producer_id, description, consumer_price, direct_price, shipping_fee, stock_quantity, main_image, product_type, weight, origin, is_featured, is_available, view_count, created_at) VALUES 
(1, 'ì œì£¼ í•œë¼ì‚° ìœ ê¸°ë† ë…¹ì°¨', 1, 1, 'ì²­ì • ì œì£¼ì—ì„œ ìë€ í”„ë¦¬ë¯¸ì—„ ìœ ê¸°ë† ë…¹ì°¨', 35000.00, 28000.00, 3000.00, 100, '/images/products/tea1.jpg', 'tea', 100.00, 'ì œì£¼ë„', 1, 1, 150, '2026-02-18 12:18:13'),
(2, 'í•˜ë™ ì „í†µ ë°œíš¨ì°¨', 4, 2, 'ì§€ë¦¬ì‚° ìë½ì˜ ì „í†µ ë°©ì‹ ë°œíš¨ì°¨', 45000.00, 36000.00, 3000.00, 50, '/images/products/tea2.jpg', 'tea', 100.00, 'ê²½ë‚¨ í•˜ë™', 1, 1, 120, '2026-02-18 12:18:13'),
(3, 'ë³´ì„± ì²­íƒœì „', 4, 1, 'ë³´ì„±ì˜ ì „í†µ ë–¡ì°¨', 38000.00, 30400.00, 3000.00, 80, '/images/products/tea3.jpg', 'tea', 150.00, 'ì „ë‚¨ ë³´ì„±', 1, 1, 200, '2026-02-18 12:18:13'),
(4, 'ê¹€í•´ í™©ì°¨', 2, 2, 'ê¹€í•´ì˜ íŠ¹ë³„í•œ í™©ì°¨', 42000.00, 33600.00, 3000.00, 60, '/images/products/tea4.jpg', 'tea', 100.00, 'ê²½ë‚¨ ê¹€í•´', 0, 1, 80, '2026-02-18 12:18:13'),
(5, 'ê´‘ì–‘ ë§¤í™”ì°¨', 6, 1, 'ê´‘ì–‘ ë°±ìš´ì‚° ë§¤í™”ë¡œ ë§Œë“  ë¸”ë Œë”©ì°¨', 32000.00, 25600.00, 3000.00, 90, '/images/products/tea5.jpg', 'tea', 80.00, 'ì „ë‚¨ ê´‘ì–‘', 1, 1, 180, '2026-02-18 12:18:13');</div>
        </div>
        <div class="footer">
            <p>ğŸ’¡ ì´ SQLì„ Cloudflare D1 Consoleì—ì„œ ì‹¤í–‰í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
            <p style="margin-top: 5px; font-size: 11px;">ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì „ì²´ 194ì¤„ì´ ë³µì‚¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>
    </div>
    <script>
        function copySQL() {
            const sqlContent = document.getElementById('sqlContent').textContent;
            const btn = document.querySelector('.copy-btn');
            const successMsg = document.getElementById('successMessage');
            navigator.clipboard.writeText(sqlContent).then(() => {
                btn.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                btn.classList.add('copied');
                successMsg.classList.add('show');
                setTimeout(() => { btn.textContent = 'ğŸ“‹ ì „ì²´ ë³µì‚¬ (194ì¤„)'; btn.classList.remove('copied'); }, 3000);
                setTimeout(() => { successMsg.classList.remove('show'); }, 5000);
            }).catch(err => { alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err); });
        }
    </script>
</body>
</html>`)
})



// SQL í…ìŠ¤íŠ¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ê¸°ì¡´ ë²„ì „)
app.get('/sql.txt', (c) => {
  const sql = `DELETE FROM education_curriculum;
DELETE FROM education_categories;
DELETE FROM experiences;
DELETE FROM products;
DELETE FROM events;
DELETE FROM producers;
DELETE FROM categories;
DELETE FROM regions;

INSERT INTO regions (id, name, type, description, featured_image, created_at) VALUES 
(1, 'ì œì£¼ë„', 'tea', 'ì œì£¼ì˜ ì²­ì • ìì—°ì—ì„œ ìë€ ë…¹ì°¨', '/images/regions/jeju.jpg', '2026-02-18 12:18:03'),
(2, 'í•˜ë™', 'tea', 'ì§€ë¦¬ì‚° ìë½ì˜ ì „í†µ ì°¨ë°­', '/images/regions/hadong.jpg', '2026-02-18 12:18:03'),
(3, 'ê¹€í•´', 'tea', 'í•œêµ­ ì°¨ë¬¸í™”ì˜ ë°œìƒì§€', '/images/regions/gimhae.jpg', '2026-02-18 12:18:03'),
(4, 'ê´‘ì–‘', 'tea', 'ë°±ìš´ì‚° ìë½ì˜ ì²­ì • ì°¨ë°­', '/images/regions/gwangyang.jpg', '2026-02-18 12:18:03'),
(5, 'ë³´ì„±', 'tea', 'ëŒ€í•œë¯¼êµ­ ë…¹ì°¨ì˜ ìˆ˜ë„', '/images/regions/boseong.jpg', '2026-02-18 12:18:03'),
(6, 'ì´ì²œ', 'craft', 'ì „í†µ ë„ìê¸°ì˜ ë³¸ê³ ì¥', '/images/regions/icheon.jpg', '2026-02-18 12:18:03'),
(7, 'ê´‘ì£¼', 'craft', 'ì¡°ì„ ë°±ìì˜ ì¤‘ì‹¬ì§€', '/images/regions/gwangju.jpg', '2026-02-18 12:18:03'),
(8, 'ë‹´ì–‘', 'craft', 'ëŒ€ë‚˜ë¬´ ê³µì˜ˆì˜ ë©”ì¹´', '/images/regions/damyang.jpg', '2026-02-18 12:18:03'),
(9, 'ì•ˆë™', 'craft', 'í•œêµ­ ì •ì‹ ë¬¸í™”ì˜ ìˆ˜ë„', '/images/regions/andong.jpg', '2026-02-18 12:18:03'),
(10, 'ì „ì£¼', 'craft', 'í•œì§€ì™€ ì „í†µê³µì˜ˆ', '/images/regions/jeonju.jpg', '2026-02-18 12:18:03'),
(11, 'ê°•ì§„', 'craft', 'ê³ ë ¤ì²­ìì˜ ê³ í–¥', '/images/regions/gangjin.jpg', '2026-02-18 12:18:03'),
(12, 'ë‚¨ì›', 'craft', 'ì „í†µ ëª©ê³µì˜ˆì˜ ì¤‘ì‹¬', '/images/regions/namwon.jpg', '2026-02-18 12:18:03'),
(13, 'ê³µì£¼', 'craft', 'ë°±ì œ ë¬¸í™”ì˜ ë³´ê³ ', '/images/regions/gongju.jpg', '2026-02-18 12:18:03'),
(14, 'ê²½ì£¼', 'craft', 'ì‹ ë¼ ì²œë…„ì˜ ê³µì˜ˆ', '/images/regions/gyeongju.jpg', '2026-02-18 12:18:03'),
(15, 'ìš¸ì‚°', 'craft', 'ë™í•´ì•ˆ íŠ¹ì‚°í’ˆ', '/images/regions/ulsan.jpg', '2026-02-18 12:18:03'),
(16, 'ë¶€ì‚°', 'craft', 'í•´ì–‘ ë„ì‹œ íŠ¹ì‚°í’ˆ', '/images/regions/busan.jpg', '2026-02-18 12:18:03'),
(17, 'ì„œìš¸', 'craft', 'ìˆ˜ë„ê¶Œ íŠ¹ì‚°í’ˆ', '/images/regions/seoul.jpg', '2026-02-18 12:18:03');

INSERT INTO categories (id, name, type, description, display_order, created_at) VALUES 
(1, 'ë…¹ì°¨', 'tea', 'í•œêµ­ ì „í†µ ë…¹ì°¨', 1, '2026-02-18 12:18:13'),
(2, 'í™©ì°¨', 'tea', 'íŠ¹ë³„í•œ í™©ì°¨', 4, '2026-02-18 12:18:13'),
(3, 'í™ì°¨', 'tea', 'ì™„ì „ ë°œíš¨ í™ì°¨', 5, '2026-02-18 12:18:13'),
(4, 'ë°œíš¨ì°¨', 'tea', 'ì „í†µ ë°œíš¨ì°¨', 6, '2026-02-18 12:18:13'),
(6, 'ë¸”ë Œë”©ì°¨', 'tea', 'ë‹¤ì–‘í•œ ë¸”ë Œë”© ì°¨', 7, '2026-02-18 12:18:13'),
(8, 'ì°»ì”', 'craft', 'ë‹¤ì–‘í•œ ì°»ì”', 2, '2026-02-18 12:18:13'),
(9, 'ë‹¤ê´€', 'craft', 'ì „í†µ ë‹¤ê´€', 1, '2026-02-18 12:18:13'),
(11, 'ì¥ì‹í’ˆ', 'craft', 'ì¸í…Œë¦¬ì–´ ì¥ì‹í’ˆ', 9, '2026-02-18 12:18:13'),
(12, 'ëª…ì ˆ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ëª…ì ˆ íŠ¹ë³„ ì„ ë¬¼', 1, '2026-02-18 12:18:13'),
(13, 'ê¸°ë…ì¼ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ê¸°ë…ì¼ìš© ì„ ë¬¼', 2, '2026-02-18 12:18:13'),
(14, 'ê¸°ì—… ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ê¸°ì—…ìš© ì„ ë¬¼', 3, '2026-02-18 12:18:13'),
(15, 'ë§ì¶¤ ì„ ë¬¼ì„¸íŠ¸', 'gift', 'ë§ì¶¤í˜• ì„ ë¬¼', 4, '2026-02-18 12:18:13'),
(17, 'ë†ì‚°ë¬¼', 'local', 'ì§€ì—­ ë†ì‚°ë¬¼', 1, '2026-02-18 12:18:13'),
(18, 'ê°€ê³µì‹í’ˆ', 'local', 'ì§€ì—­ ê°€ê³µì‹í’ˆ', 5, '2026-02-18 12:18:13'),
(19, 'ìˆ˜ì‚°ë¬¼', 'local', 'ì§€ì—­ ìˆ˜ì‚°ë¬¼', 2, '2026-02-18 12:18:13'),
(20, 'ì¶•ì‚°ë¬¼', 'local', 'ì§€ì—­ ì¶•ì‚°ë¬¼', 3, '2026-02-18 12:18:13'),
(21, 'ê³µì˜ˆí’ˆ', 'local', 'ì§€ì—­ ê³µì˜ˆí’ˆ', 4, '2026-02-18 12:18:13'),
(22, 'ì „í†µì£¼', 'local', 'ì „í†µì£¼/ìŒë£Œ', 6, '2026-02-18 12:18:13'),
(23, 'ê±´ê°•ì‹í’ˆ', 'local', 'ê±´ê°• ì‹í’ˆ', 7, '2026-02-18 12:18:13'),
(24, 'ì¡°ë¯¸ë£Œ', 'local', 'ì²œì—° ì¡°ë¯¸ë£Œ', 8, '2026-02-18 12:18:13'),
(25, 'ê°„í¸ì‹', 'local', 'ê°„í¸ ë¨¹ê±°ë¦¬', 9, '2026-02-18 12:18:13'),
(26, 'ë””ì €íŠ¸', 'local', 'ì „í†µ ë””ì €íŠ¸', 10, '2026-02-18 12:18:13'),
(27, 'ìƒí™œìš©í’ˆ', 'local', 'ì¹œí™˜ê²½ ìƒí™œìš©í’ˆ', 11, '2026-02-18 12:18:13'),
(28, 'í™”ì¥í’ˆ', 'local', 'ì²œì—° í™”ì¥í’ˆ', 12, '2026-02-18 12:18:13'),
(29, 'ì˜ë¥˜/ì¡í™”', 'local', 'ì „í†µ ì˜ë¥˜/ì¡í™”', 13, '2026-02-18 12:18:13'),
(30, 'ì¸í…Œë¦¬ì–´', 'local', 'ì¸í…Œë¦¬ì–´ ì†Œí’ˆ', 14, '2026-02-18 12:18:13'),
(31, 'ë¬¸í™”ìƒí’ˆ', 'local', 'ë¬¸í™”/ì˜ˆìˆ  ìƒí’ˆ', 15, '2026-02-18 12:18:13');

INSERT INTO producers (id, name, region, description, contact, created_at) VALUES 
(1, 'ë°•ìˆ˜ê³µ', 'ì œì£¼ë„', 'ì œì£¼ í•œë¼ì‚° ìœ ê¸°ë† ì°¨ ë†ì›', '064-123-4567', '2026-02-18 12:18:13'),
(2, 'ì œì£¼ í•œë¼ì‚° ì°¨ë†ì›', 'ì œì£¼ë„', '3ëŒ€ì§¸ ì´ì–´ì˜¨ ì „í†µ ì°¨ ë†ì›', '064-456-7890', '2026-02-18 12:18:13');

INSERT INTO products (id, name, category_id, producer_id, description, consumer_price, direct_price, shipping_fee, stock_quantity, main_image, product_type, weight, origin, is_featured, is_available, view_count, created_at) VALUES 
(1, 'ì œì£¼ í•œë¼ì‚° ìœ ê¸°ë† ë…¹ì°¨', 1, 1, 'ì²­ì • ì œì£¼ì—ì„œ ìë€ í”„ë¦¬ë¯¸ì—„ ìœ ê¸°ë† ë…¹ì°¨', 35000.00, 28000.00, 3000.00, 100, '/images/products/tea1.jpg', 'tea', 100.00, 'ì œì£¼ë„', 1, 1, 150, '2026-02-18 12:18:13'),
(2, 'í•˜ë™ ì „í†µ ë°œíš¨ì°¨', 4, 2, 'ì§€ë¦¬ì‚° ìë½ì˜ ì „í†µ ë°©ì‹ ë°œíš¨ì°¨', 45000.00, 36000.00, 3000.00, 50, '/images/products/tea2.jpg', 'tea', 100.00, 'ê²½ë‚¨ í•˜ë™', 1, 1, 120, '2026-02-18 12:18:13'),
(3, 'ë³´ì„± ì²­íƒœì „', 4, 1, 'ë³´ì„±ì˜ ì „í†µ ë–¡ì°¨', 38000.00, 30400.00, 3000.00, 80, '/images/products/tea3.jpg', 'tea', 150.00, 'ì „ë‚¨ ë³´ì„±', 1, 1, 200, '2026-02-18 12:18:13'),
(4, 'ê¹€í•´ í™©ì°¨', 2, 2, 'ê¹€í•´ì˜ íŠ¹ë³„í•œ í™©ì°¨', 42000.00, 33600.00, 3000.00, 60, '/images/products/tea4.jpg', 'tea', 100.00, 'ê²½ë‚¨ ê¹€í•´', 0, 1, 80, '2026-02-18 12:18:13'),
(5, 'ê´‘ì–‘ ë§¤í™”ì°¨', 6, 1, 'ê´‘ì–‘ ë°±ìš´ì‚° ë§¤í™”ë¡œ ë§Œë“  ë¸”ë Œë”©ì°¨', 32000.00, 25600.00, 3000.00, 90, '/images/products/tea5.jpg', 'tea', 80.00, 'ì „ë‚¨ ê´‘ì–‘', 1, 1, 180, '2026-02-18 12:18:13'),
(6, 'ì´ì²œ ë„ìê¸° ì°»ì” ì„¸íŠ¸', 8, 1, 'ì´ì²œ ì „í†µ ë„ìê¸° ì¥ì¸ì˜ ìˆ˜ì œ ì°»ì”', 85000.00, 68000.00, 3000.00, 30, '/images/products/craft1.jpg', 'craft', 800.00, 'ê²½ê¸° ì´ì²œ', 1, 1, 95, '2026-02-18 12:18:13'),
(7, 'ê´‘ì£¼ ë¶„ì²­ì‚¬ê¸° ë‹¤ê´€', 9, 2, 'ì¡°ì„ ì‹œëŒ€ ê¸°ë²•ìœ¼ë¡œ ë§Œë“  ë¶„ì²­ ë‹¤ê´€', 150000.00, 120000.00, 3000.00, 15, '/images/products/craft2.jpg', 'craft', 1200.00, 'ê²½ê¸° ê´‘ì£¼', 1, 1, 70, '2026-02-18 12:18:13'),
(8, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ì°»ìƒ', 11, 1, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ë¡œ ë§Œë“  ì „í†µ ì°»ìƒ', 95000.00, 76000.00, 5000.00, 25, '/images/products/craft3.jpg', 'craft', 2500.00, 'ì „ë‚¨ ë‹´ì–‘', 0, 1, 60, '2026-02-18 12:18:13'),
(9, 'ì•ˆë™ í•œì§€ ì°»ì” ë°›ì¹¨', 11, 2, 'ì•ˆë™ ì „í†µ í•œì§€ ê³µì˜ˆí’ˆ', 28000.00, 22400.00, 2500.00, 50, '/images/products/craft4.jpg', 'craft', 100.00, 'ê²½ë¶ ì•ˆë™', 0, 1, 45, '2026-02-18 12:18:13'),
(10, 'ì „ì£¼ ë‚˜ì „ì¹ ê¸° ë‹¤ê¸°', 9, 1, 'ì „ì£¼ ì „í†µ ë‚˜ì „ì¹ ê¸° ê¸°ë²•ì˜ ë‹¤ê¸°', 280000.00, 224000.00, 3000.00, 10, '/images/products/craft5.jpg', 'craft', 1500.00, 'ì „ë¶ ì „ì£¼', 1, 1, 85, '2026-02-18 12:18:13'),
(11, 'ê°•ì§„ ì²­ì ì°»ì”', 8, 2, 'ê³ ë ¤ì²­ìì˜ ì „í†µì„ ì´ì€ í˜„ëŒ€ ì²­ì', 120000.00, 96000.00, 3000.00, 20, '/images/products/craft6.jpg', 'craft', 600.00, 'ì „ë‚¨ ê°•ì§„', 1, 1, 110, '2026-02-18 12:18:13'),
(12, 'ë‚¨ì› ëª©ê¸° ì°»ì”ë°›ì¹¨', 11, 1, 'ë‚¨ì› ì „í†µ ëª©ê³µì˜ˆ ì°»ì”ë°›ì¹¨', 35000.00, 28000.00, 2500.00, 40, '/images/products/craft7.jpg', 'craft', 300.00, 'ì „ë¶ ë‚¨ì›', 0, 1, 55, '2026-02-18 12:18:13'),
(13, 'ì œì£¼ í•œë¼ë´‰ì°¨', 6, 1, 'ì œì£¼ í•œë¼ë´‰ìœ¼ë¡œ ë§Œë“  ë¸”ë Œë”©ì°¨', 28000.00, 22400.00, 3000.00, 100, '/images/products/tea6.jpg', 'tea', 80.00, 'ì œì£¼ë„', 1, 1, 140, '2026-02-18 12:18:13'),
(14, 'í•˜ë™ ì•¼ìƒì°¨', 1, 2, 'ì§€ë¦¬ì‚° ì•¼ìƒì°¨ë‚˜ë¬´ì—ì„œ ì±„ì·¨í•œ ì°¨', 65000.00, 52000.00, 3000.00, 30, '/images/products/tea7.jpg', 'tea', 100.00, 'ê²½ë‚¨ í•˜ë™', 1, 1, 90, '2026-02-18 12:18:13'),
(15, 'ëª…ì ˆ í”„ë¦¬ë¯¸ì—„ ì„¸íŠ¸', 12, 1, 'ì°¨ì™€ ë‹¤ê¸°ê°€ í•¨ê»˜í•˜ëŠ” ëª…ì ˆ ì„ ë¬¼', 150000.00, 120000.00, 0.00, 50, '/images/products/gift1.jpg', 'gift', 2000.00, 'ì „êµ­', 1, 1, 200, '2026-02-18 12:18:13'),
(16, 'ê¸°ë…ì¼ ì°¨ ì„ ë¬¼ì„¸íŠ¸', 13, 2, 'íŠ¹ë³„í•œ ë‚ ì„ ìœ„í•œ í”„ë¦¬ë¯¸ì—„ ì°¨ ì„¸íŠ¸', 95000.00, 76000.00, 0.00, 60, '/images/products/gift2.jpg', 'gift', 1200.00, 'ì „êµ­', 1, 1, 175, '2026-02-18 12:18:13'),
(17, 'ê¸°ì—… ì„ ë¬¼ìš© ë‹¤ê¸°ì„¸íŠ¸', 14, 1, 'í’ˆê²©ìˆëŠ” ê¸°ì—… ì„ ë¬¼ìš© ì„¸íŠ¸', 180000.00, 144000.00, 0.00, 40, '/images/products/gift3.jpg', 'gift', 2500.00, 'ì „êµ­', 1, 1, 130, '2026-02-18 12:18:13'),
(18, 'ë§ì¶¤ ì„ ë¬¼ êµ¬ì„±', 15, 2, 'ì›í•˜ëŠ” ëŒ€ë¡œ êµ¬ì„±í•˜ëŠ” ì„ ë¬¼ì„¸íŠ¸', 120000.00, 96000.00, 0.00, 70, '/images/products/gift4.jpg', 'gift', 1500.00, 'ì „êµ­', 0, 1, 95, '2026-02-18 12:18:13'),
(19, 'ìš¸ì‚° ë¯¸ì—­', 19, 1, 'ë™í•´ì•ˆ ì²­ì • í•´ì—­ ë¯¸ì—­', 25000.00, 20000.00, 3000.00, 80, '/images/products/local1.jpg', 'local', 300.00, 'ìš¸ì‚°', 0, 1, 85, '2026-02-18 12:18:13'),
(20, 'ë¶€ì‚° ë©¸ì¹˜', 19, 2, 'ë¶€ì‚° ì•ë°”ë‹¤ íŠ¹ì‚° ë©¸ì¹˜', 32000.00, 25600.00, 3000.00, 90, '/images/products/local2.jpg', 'local', 500.00, 'ë¶€ì‚°', 1, 1, 110, '2026-02-18 12:18:13'),
(21, 'ì œì£¼ í‘ë¼ì§€ ìœ¡í¬', 20, 1, 'ì œì£¼ í‘ë¼ì§€ë¡œ ë§Œë“  í”„ë¦¬ë¯¸ì—„ ìœ¡í¬', 28000.00, 22400.00, 3000.00, 70, '/images/products/local3.jpg', 'local', 200.00, 'ì œì£¼ë„', 1, 1, 95, '2026-02-18 12:18:13'),
(22, 'ë³´ì„± ë…¹ì°¨ ìŒ€', 17, 2, 'ë…¹ì°¨ë¥¼ ë¨¹ì—¬ í‚¤ìš´ íŠ¹ë³„í•œ ìŒ€', 35000.00, 28000.00, 3000.00, 100, '/images/products/local4.jpg', 'local', 5000.00, 'ì „ë‚¨ ë³´ì„±', 0, 1, 75, '2026-02-18 12:18:13'),
(23, 'í•˜ë™ ì•¼ìƒí™” ê¿€', 23, 1, 'ì§€ë¦¬ì‚° ì•¼ìƒí™” ê¿€', 42000.00, 33600.00, 3000.00, 50, '/images/products/local5.jpg', 'local', 600.00, 'ê²½ë‚¨ í•˜ë™', 1, 1, 120, '2026-02-18 12:18:13'),
(24, 'ì•ˆë™ ê°„ê³ ë“±ì–´', 19, 2, 'ì•ˆë™ ì „í†µ ê°„ê³ ë“±ì–´', 38000.00, 30400.00, 3000.00, 60, '/images/products/local6.jpg', 'local', 800.00, 'ê²½ë¶ ì•ˆë™', 0, 1, 65, '2026-02-18 12:18:13'),
(25, 'ì „ì£¼ í•œê³¼', 26, 1, 'ì „í†µ ë°©ì‹ìœ¼ë¡œ ë§Œë“  ì „ì£¼ í•œê³¼', 32000.00, 25600.00, 2500.00, 80, '/images/products/local7.jpg', 'local', 400.00, 'ì „ë¶ ì „ì£¼', 1, 1, 140, '2026-02-18 12:18:13'),
(26, 'ê°•ë¦‰ ì»¤í”¼', 18, 2, 'ê°•ë¦‰ ë¡œìŠ¤í„°ë¦¬ ì›ë‘', 22000.00, 17600.00, 3000.00, 90, '/images/products/local8.jpg', 'local', 200.00, 'ê°•ì› ê°•ë¦‰', 0, 1, 105, '2026-02-18 12:18:13'),
(27, 'ê²½ì£¼ ë¹µ', 26, 1, 'ê²½ì£¼ íŠ¹ì‚° ë¹µ', 18000.00, 14400.00, 3000.00, 100, '/images/products/local9.jpg', 'local', 500.00, 'ê²½ë¶ ê²½ì£¼', 0, 1, 88, '2026-02-18 12:18:13'),
(28, 'ë‚¨ì› ì¶”ì–´íƒ•', 18, 2, 'ë‚¨ì› ì „í†µ ì¶”ì–´íƒ•', 15000.00, 12000.00, 3500.00, 70, '/images/products/local10.jpg', 'local', 1000.00, 'ì „ë¶ ë‚¨ì›', 0, 1, 72, '2026-02-18 12:18:13'),
(29, 'ì œì£¼ ê°ê·¤', 17, 1, 'ì œì£¼ ì²­ì • ê°ê·¤', 28000.00, 22400.00, 3500.00, 150, '/images/products/local11.jpg', 'local', 3000.00, 'ì œì£¼ë„', 1, 1, 180, '2026-02-18 12:18:13'),
(30, 'ì„œìš¸ ì „í†µì£¼', 22, 2, 'ì„œìš¸ ì „í†µ ë§‰ê±¸ë¦¬', 18000.00, 14400.00, 3000.00, 80, '/images/products/local12.jpg', 'local', 750.00, 'ì„œìš¸', 0, 1, 92, '2026-02-18 12:18:13'),
(31, 'ì´ì²œ ìŒ€', 17, 1, 'ì„ê¸ˆë‹˜í‘œ ì´ì²œìŒ€', 45000.00, 36000.00, 3500.00, 100, '/images/products/local13.jpg', 'local', 10000.00, 'ê²½ê¸° ì´ì²œ', 1, 1, 160, '2026-02-18 12:18:13'),
(32, 'ë‹´ì–‘ ì£½ìˆœ', 17, 2, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ì£½ìˆœ', 32000.00, 25600.00, 3000.00, 60, '/images/products/local14.jpg', 'local', 1000.00, 'ì „ë‚¨ ë‹´ì–‘', 0, 1, 78, '2026-02-18 12:18:13'),
(33, 'ê³µì£¼ ë°¤', 17, 1, 'ê³µì£¼ ì•Œë°¤', 28000.00, 22400.00, 3000.00, 90, '/images/products/local15.jpg', 'local', 2000.00, 'ì¶©ë‚¨ ê³µì£¼', 0, 1, 85, '2026-02-18 12:18:13'),
(34, 'ë³´ë ¹ êµ´ë¹„', 19, 2, 'ë³´ë ¹ ëª…í’ˆ êµ´ë¹„', 55000.00, 44000.00, 3500.00, 50, '/images/products/local16.jpg', 'local', 1200.00, 'ì¶©ë‚¨ ë³´ë ¹', 1, 1, 125, '2026-02-18 12:18:13'),
(35, 'ì˜ê´‘ ëª¨ì‹œ', 29, 1, 'ì˜ê´‘ ëª¨ì‹œ ì˜ë¥˜', 85000.00, 68000.00, 3000.00, 40, '/images/products/local17.jpg', 'local', 500.00, 'ì „ë‚¨ ì˜ê´‘', 0, 1, 68, '2026-02-18 12:18:13'),
(36, 'ë‚˜ì£¼ ë°°', 17, 2, 'ë‚˜ì£¼ ì‹ ê³ ë°°', 38000.00, 30400.00, 3500.00, 80, '/images/products/local18.jpg', 'local', 5000.00, 'ì „ë‚¨ ë‚˜ì£¼', 1, 1, 145, '2026-02-18 12:18:13'),
(37, 'ì˜ì–‘ ê³ ì¶”', 24, 1, 'ì˜ì–‘ ì²­ì • ê³ ì¶”', 42000.00, 33600.00, 3000.00, 70, '/images/products/local19.jpg', 'local', 500.00, 'ê²½ë¶ ì˜ì–‘', 0, 1, 95, '2026-02-18 12:18:13'),
(38, 'ì˜ì„± ë§ˆëŠ˜', 24, 2, 'ì˜ì„± ìœ¡ìª½ë§ˆëŠ˜', 35000.00, 28000.00, 3000.00, 90, '/images/products/local20.jpg', 'local', 1000.00, 'ê²½ë¶ ì˜ì„±', 1, 1, 132, '2026-02-18 12:18:13'),
(39, 'ì²­ì†¡ ì‚¬ê³¼', 17, 1, 'ì²­ì†¡ ì£¼ì™•ì‚° ì‚¬ê³¼', 45000.00, 36000.00, 3500.00, 100, '/images/products/local21.jpg', 'local', 5000.00, 'ê²½ë¶ ì²­ì†¡', 1, 1, 170, '2026-02-18 12:18:13'),
(40, 'ì˜ë• ëŒ€ê²Œ', 19, 2, 'ì˜ë• íŠ¹ì‚° ëŒ€ê²Œ', 95000.00, 76000.00, 5000.00, 30, '/images/products/local22.jpg', 'local', 1500.00, 'ê²½ë¶ ì˜ë•', 1, 1, 155, '2026-02-18 12:18:13'),
(41, 'ìš¸ë¦‰ë„ ì˜¤ì§•ì–´', 19, 1, 'ìš¸ë¦‰ë„ ê±´ì˜¤ì§•ì–´', 48000.00, 38400.00, 3500.00, 50, '/images/products/local23.jpg', 'local', 500.00, 'ê²½ë¶ ìš¸ë¦‰', 0, 1, 88, '2026-02-18 12:18:13'),
(42, 'ì‚¼ì²™ ê±´ì–´ë¬¼', 19, 2, 'ì‚¼ì²™ íŠ¹ì‚° ê±´ì–´ë¬¼', 32000.00, 25600.00, 3000.00, 60, '/images/products/local24.jpg', 'local', 800.00, 'ê°•ì› ì‚¼ì²™', 0, 1, 75, '2026-02-18 12:18:13'),
(43, 'ì†ì´ˆ ì˜¤ì§•ì–´ìˆœëŒ€', 18, 1, 'ì†ì´ˆ ëª…ë¬¼ ì˜¤ì§•ì–´ìˆœëŒ€', 25000.00, 20000.00, 3500.00, 70, '/images/products/local25.jpg', 'local', 600.00, 'ê°•ì› ì†ì´ˆ', 0, 1, 98, '2026-02-18 12:18:13'),
(44, 'íš¡ì„± í•œìš°', 20, 2, 'íš¡ì„± 1++ë“±ê¸‰ í•œìš°', 120000.00, 96000.00, 5000.00, 40, '/images/products/local26.jpg', 'local', 2000.00, 'ê°•ì› íš¡ì„±', 1, 1, 185, '2026-02-18 12:18:13'),
(45, 'í‰ì°½ ì†¡ì´ë²„ì„¯', 17, 1, 'í‰ì°½ ìì—°ì‚° ì†¡ì´', 150000.00, 120000.00, 5000.00, 20, '/images/products/local27.jpg', 'local', 500.00, 'ê°•ì› í‰ì°½', 1, 1, 210, '2026-02-18 12:18:13'),
(46, 'ì •ì„  ê³¤ë“œë ˆ', 17, 2, 'ì •ì„  ì‚°ë‚˜ë¬¼ ê³¤ë“œë ˆ', 28000.00, 22400.00, 3000.00, 80, '/images/products/local28.jpg', 'local', 300.00, 'ê°•ì› ì •ì„ ', 0, 1, 82, '2026-02-18 12:18:13'),
(47, 'ì–‘êµ¬ ì‹œë˜ê¸°', 17, 1, 'ì–‘êµ¬ ì²­ì • ì‹œë˜ê¸°', 22000.00, 17600.00, 3000.00, 90, '/images/products/local29.jpg', 'local', 500.00, 'ê°•ì› ì–‘êµ¬', 0, 1, 76, '2026-02-18 12:18:13'),
(48, 'ì¸ì œ ì‚°ë‚˜ë¬¼', 17, 2, 'ì¸ì œ ìì—°ì‚° ì‚°ë‚˜ë¬¼', 35000.00, 28000.00, 3000.00, 70, '/images/products/local30.jpg', 'local', 400.00, 'ê°•ì› ì¸ì œ', 0, 1, 88, '2026-02-18 12:18:13'),
(49, 'í™”ì²œ í† ë§ˆí† ', 17, 1, 'í™”ì²œ ë°©ìš¸í† ë§ˆí† ', 28000.00, 22400.00, 3500.00, 100, '/images/products/local31.jpg', 'local', 2000.00, 'ê°•ì› í™”ì²œ', 0, 1, 95, '2026-02-18 12:18:13'),
(50, 'ì² ì› ì˜¤ëŒ€ìŒ€', 17, 2, 'ì² ì› DMZ ì˜¤ëŒ€ìŒ€', 42000.00, 33600.00, 3500.00, 80, '/images/products/local32.jpg', 'local', 10000.00, 'ê°•ì› ì² ì›', 1, 1, 165, '2026-02-18 12:18:13');

INSERT INTO events (id, title, category, description, location, start_date, end_date, max_participants, current_participants, price, image_url, is_featured, status, created_at) VALUES 
(1, 'ì œì£¼ ì°¨ë°­ íˆ¬ì–´', 'tea', 'ì œì£¼ í•œë¼ì‚° ì°¨ë°­ ê²¬í•™ê³¼ ì°¨ ë§Œë“¤ê¸° ì²´í—˜', 'ì œì£¼ë„', '2026-03-15', '2026-03-15', 30, 12, 45000, '/images/events/event1.jpg', 1, 'open', '2026-02-18 12:18:13'),
(2, 'í•˜ë™ ì•¼ìƒì°¨ ì²´í—˜', 'tea', 'ì§€ë¦¬ì‚° ì•¼ìƒì°¨ ì±„ì·¨ ì²´í—˜', 'ê²½ë‚¨ í•˜ë™', '2026-03-20', '2026-03-20', 20, 8, 55000, '/images/events/event2.jpg', 1, 'open', '2026-02-18 12:18:13'),
(3, 'ë³´ì„± ë…¹ì°¨ë°­ ì¶•ì œ', 'tea', 'ë³´ì„± ë…¹ì°¨ë°­ ì¶•ì œ ë° ì°¨ ì‹œìŒíšŒ', 'ì „ë‚¨ ë³´ì„±', '2026-04-05', '2026-04-07', 100, 45, 35000, '/images/events/event3.jpg', 1, 'open', '2026-02-18 12:18:13'),
(4, 'ì´ì²œ ë„ìê¸° ë§Œë“¤ê¸°', 'craft', 'ì´ì²œ ë„ìê¸° ê³µë°© ì²´í—˜', 'ê²½ê¸° ì´ì²œ', '2026-03-22', '2026-03-22', 15, 10, 75000, '/images/events/event4.jpg', 1, 'open', '2026-02-18 12:18:13'),
(5, 'ê´‘ì£¼ ë¶„ì²­ì‚¬ê¸° ì²´í—˜', 'craft', 'ì „í†µ ë¶„ì²­ì‚¬ê¸° ì œì‘ ì²´í—˜', 'ê²½ê¸° ê´‘ì£¼', '2026-03-25', '2026-03-25', 12, 6, 85000, '/images/events/event5.jpg', 0, 'open', '2026-02-18 12:18:13'),
(6, 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ê³µì˜ˆ', 'craft', 'ë‹´ì–‘ ëŒ€ë‚˜ë¬´ ê³µì˜ˆ ë§Œë“¤ê¸°', 'ì „ë‚¨ ë‹´ì–‘', '2026-04-01', '2026-04-01', 20, 15, 45000, '/images/events/event6.jpg', 1, 'open', '2026-02-18 12:18:13'),
(7, 'ì•ˆë™ í•œì§€ ê³µì˜ˆ', 'craft', 'ì•ˆë™ ì „í†µ í•œì§€ ê³µì˜ˆ ì²´í—˜', 'ê²½ë¶ ì•ˆë™', '2026-04-08', '2026-04-08', 18, 9, 38000, '/images/events/event7.jpg', 0, 'open', '2026-02-18 12:18:13'),
(8, 'ì „ì£¼ ë‚˜ì „ì¹ ê¸° ì²´í—˜', 'craft', 'ì „ì£¼ ì „í†µ ë‚˜ì „ì¹ ê¸° ë§Œë“¤ê¸°', 'ì „ë¶ ì „ì£¼', '2026-04-12', '2026-04-12', 10, 7, 95000, '/images/events/event8.jpg', 1, 'open', '2026-02-18 12:18:13'),
(9, 'ê°•ì§„ ì²­ì ì²´í—˜', 'craft', 'ê³ ë ¤ì²­ì ë„ìê¸° ë§Œë“¤ê¸°', 'ì „ë‚¨ ê°•ì§„', '2026-04-15', '2026-04-15', 15, 5, 68000, '/images/events/event9.jpg', 0, 'open', '2026-02-18 12:18:13'),
(10, 'ë‚¨ì› ëª©ê³µì˜ˆ ì²´í—˜', 'craft', 'ì „í†µ ëª©ê³µì˜ˆ ë§Œë“¤ê¸°', 'ì „ë¶ ë‚¨ì›', '2026-04-18', '2026-04-18', 12, 8, 52000, '/images/events/event10.jpg', 0, 'open', '2026-02-18 12:18:13'),
(11, 'ë´„ ì°¨ ëª…ìƒ íë§', 'meditation', 'ë´„ ì°¨ ëª…ìƒê³¼ íë§ í”„ë¡œê·¸ë¨', 'ì œì£¼ë„', '2026-03-28', '2026-03-29', 25, 18, 120000, '/images/events/event11.jpg', 1, 'open', '2026-02-18 12:18:13'),
(12, 'ë‹¤ë„ ì…ë¬¸ êµì‹¤', 'education', 'ì „í†µ ë‹¤ë„ ê¸°ì´ˆ êµìœ¡', 'ì„œìš¸', '2026-04-02', '2026-04-02', 15, 12, 50000, '/images/events/event12.jpg', 1, 'open', '2026-02-18 12:18:13'),
(13, 'ì°¨ì™€ ìŒì‹ í˜ì–´ë§', 'tea', 'ì°¨ì™€ ìŒì‹ì˜ ì¡°í™” ì²´í—˜', 'ì„œìš¸', '2026-04-10', '2026-04-10', 20, 14, 65000, '/images/events/event13.jpg', 0, 'open', '2026-02-18 12:18:13'),
(14, 'ì—¬ë¦„ ì°¨ë°­ ìº í•‘', 'tea', 'ë³´ì„± ì°¨ë°­ì—ì„œì˜ 1ë°• 2ì¼ ìº í•‘', 'ì „ë‚¨ ë³´ì„±', '2026-06-15', '2026-06-16', 30, 8, 95000, '/images/events/event14.jpg', 1, 'open', '2026-02-18 12:18:13'),
(15, 'ì œì£¼ ì°¨ ë§Œë“¤ê¸° ì›Œí¬ìƒµ', 'tea', 'ì°¨ ì œì¡° ê³¼ì • ì „ì²´ ì²´í—˜', 'ì œì£¼ë„', '2026-05-08', '2026-05-09', 15, 6, 150000, '/images/events/event15.jpg', 1, 'open', '2026-02-18 12:18:13'),
(16, 'ì „í†µ ê³µì˜ˆ ë°•ëŒíšŒ', 'craft', 'ì „êµ­ ì „í†µ ê³µì˜ˆ ì‘ê°€ ì‘í’ˆì „', 'ì„œìš¸', '2026-05-20', '2026-05-25', 500, 120, 15000, '/images/events/event16.jpg', 1, 'open', '2026-02-18 12:18:13'),
(17, 'ì°¨ ì†Œë¯ˆë¦¬ì— ì…ë¬¸', 'education', 'ì°¨ ì†Œë¯ˆë¦¬ì— ê¸°ì´ˆ ê³¼ì •', 'ì„œìš¸', '2026-05-15', '2026-05-16', 20, 16, 180000, '/images/events/event17.jpg', 1, 'open', '2026-02-18 12:18:13'),
(18, 'ê°€ì„ ì°¨ ì¶•ì œ', 'tea', 'ì „êµ­ ì°¨ ìƒì‚°ì§€ ì—°í•© ì¶•ì œ', 'ì „ë‚¨ ë³´ì„±', '2026-09-15', '2026-09-17', 200, 85, 25000, '/images/events/event18.jpg', 1, 'open', '2026-02-18 12:18:13'),
(19, 'ëª…ìƒê³¼ ì°¨ ëª…ìƒ', 'meditation', 'ë§ˆìŒì±™ê¹€ ëª…ìƒê³¼ ì°¨ ëª…ìƒ', 'ê²½ê¸° ì–‘í‰', '2026-07-20', '2026-07-21', 18, 12, 110000, '/images/events/event19.jpg', 0, 'open', '2026-02-18 12:18:13'),
(20, 'ë„ìê¸° ê³ ê¸‰ ê³¼ì •', 'craft', 'ë„ìê¸° ì œì‘ ì‹¬í™” ê³¼ì •', 'ê²½ê¸° ì´ì²œ', '2026-06-10', '2026-06-11', 10, 8, 220000, '/images/events/event20.jpg', 0, 'open', '2026-02-18 12:18:13'),
(21, 'ê²¨ìš¸ ì°¨ ëª…ìƒ íë§', 'meditation', 'ê²¨ìš¸ ì°¨ ëª…ìƒ 1ë°• 2ì¼', 'ê°•ì› í‰ì°½', '2026-12-15', '2026-12-16', 20, 5, 135000, '/images/events/event21.jpg', 1, 'open', '2026-02-18 12:18:13'),
(22, 'ì„¤ ëª…ì ˆ ì„ ë¬¼ íŠ¹ë³„ì „', 'gift', 'ì„¤ ëª…ì ˆ ì°¨ ì„ ë¬¼ íŠ¹ë³„ì „', 'ì„œìš¸', '2027-01-20', '2027-01-28', 300, 95, 0, '/images/events/event22.jpg', 1, 'open', '2026-02-18 12:18:13'),
(23, 'ì¶”ì„ ì„ ë¬¼ íŠ¹ë³„ì „', 'gift', 'ì¶”ì„ ëª…ì ˆ ì°¨ ì„ ë¬¼ íŠ¹ë³„ì „', 'ì„œìš¸', '2026-08-25', '2026-09-05', 300, 145, 0, '/images/events/event23.jpg', 1, 'open', '2026-02-18 12:18:13'),
(24, 'ì–´ë¦°ì´ ë‹¤ë„ êµì‹¤', 'education', 'ì–´ë¦°ì´ë¥¼ ìœ„í•œ ë‹¤ë„ ì²´í—˜', 'ì„œìš¸', '2026-07-28', '2026-07-30', 25, 20, 45000, '/images/events/event24.jpg', 0, 'open', '2026-02-18 12:18:13'),
(25, 'ê¸°ì—… ì„ì§ì› íë§ í”„ë¡œê·¸ë¨', 'meditation', 'ê¸°ì—… ì„ì§ì› ì°¨ ëª…ìƒ íë§', 'ê²½ê¸° ê°€í‰', '2026-08-14', '2026-08-15', 40, 30, 95000, '/images/events/event25.jpg', 0, 'open', '2026-02-18 12:18:13'),
(26, 'ì „í†µ ì°¨ ì œì¡° ë¹„ë²•', 'tea', 'ì „í†µ ì°¨ ì œì¡° ì¥ì¸ì˜ ë¹„ë²• ì „ìˆ˜', 'ê²½ë‚¨ í•˜ë™', '2026-10-10', '2026-10-12', 12, 10, 280000, '/images/events/event26.jpg', 1, 'open', '2026-02-18 12:18:13'),
(27, 'ì—°ë§ ê°ì‚¬ ê³ ê° í–‰ì‚¬', 'gift', 'ì—°ë§ ê³ ê° ê°ì‚¬ íŠ¹ë³„ í–‰ì‚¬', 'ì„œìš¸', '2026-12-20', '2026-12-22', 100, 68, 0, '/images/events/event27.jpg', 0, 'open', '2026-02-18 12:18:13');

INSERT INTO experiences (id, title, category, description, location, duration, price, max_participants, difficulty, image_url, is_featured, status, included_items, created_at) VALUES 
(1, 'ì œì£¼ ì°¨ë°­ íŠ¸ë ˆí‚¹', 'tea', 'ì œì£¼ í•œë¼ì‚° ì°¨ë°­ íŠ¸ë ˆí‚¹ê³¼ ì°¨ ì‹œìŒ', 'ì œì£¼ë„', '3ì‹œê°„', 45000, 20, 'easy', '/images/exp/exp1.jpg', 1, 'available', 'ê°€ì´ë“œ, ì°¨ ì‹œìŒ, ë‹¤ê³¼', '2026-02-18 12:18:13'),
(2, 'í•˜ë™ ì°¨ ë§Œë“¤ê¸° ì²´í—˜', 'tea', 'ì „í†µ ë°©ì‹ìœ¼ë¡œ ì°¨ ë§Œë“¤ê¸°', 'ê²½ë‚¨ í•˜ë™', '4ì‹œê°„', 65000, 15, 'medium', '/images/exp/exp2.jpg', 1, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ í¬ì¥', '2026-02-18 12:18:13'),
(3, 'ì´ì²œ ë„ìê¸° ì›ë°ì´ í´ë˜ìŠ¤', 'craft', 'ë¬¼ë ˆë¥¼ ì´ìš©í•œ ë„ìê¸° ë§Œë“¤ê¸°', 'ê²½ê¸° ì´ì²œ', '5ì‹œê°„', 95000, 10, 'medium', '/images/exp/exp3.jpg', 1, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ ë°°ì†¡', '2026-02-18 12:18:13'),
(4, 'ë‹´ì–‘ ì£½ì œí’ˆ ë§Œë“¤ê¸°', 'craft', 'ëŒ€ë‚˜ë¬´ë¥¼ ì´ìš©í•œ ìƒí™œìš©í’ˆ ì œì‘', 'ì „ë‚¨ ë‹´ì–‘', '3ì‹œê°„', 48000, 12, 'easy', '/images/exp/exp4.jpg', 0, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ', '2026-02-18 12:18:13'),
(5, 'ì „ì£¼ í•œì§€ ê³µì˜ˆ ì²´í—˜', 'craft', 'ì „í†µ í•œì§€ë¥¼ ì´ìš©í•œ ê³µì˜ˆí’ˆ ë§Œë“¤ê¸°', 'ì „ë¶ ì „ì£¼', '3ì‹œê°„', 42000, 15, 'easy', '/images/exp/exp5.jpg', 0, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ', '2026-02-18 12:18:13'),
(6, 'ì°¨ ëª…ìƒ íë§ í”„ë¡œê·¸ë¨', 'meditation', 'ì°¨ë¥¼ ë§ˆì‹œë©° í•˜ëŠ” ëª…ìƒ í”„ë¡œê·¸ë¨', 'ì œì£¼ë„', '2ì‹œê°„', 55000, 12, 'easy', '/images/exp/exp6.jpg', 1, 'available', 'ê°€ì´ë“œ, ì°¨, ë‹¤ê³¼', '2026-02-18 12:18:13'),
(7, 'ë‹¤ë„ ì˜ˆì ˆ êµìœ¡', 'education', 'ì „í†µ ë‹¤ë„ ì˜ˆì ˆ ë°°ìš°ê¸°', 'ì„œìš¸', '2ì‹œê°„', 40000, 15, 'easy', '/images/exp/exp7.jpg', 1, 'available', 'ê°€ì´ë“œ, êµì¬, ì°¨', '2026-02-18 12:18:13'),
(8, 'ì°¨ì™€ ìŒì‹ í˜ì–´ë§ í´ë˜ìŠ¤', 'tea', 'ì°¨ì™€ ì–´ìš¸ë¦¬ëŠ” ìŒì‹ ì¡°í•© ë°°ìš°ê¸°', 'ì„œìš¸', '3ì‹œê°„', 75000, 12, 'medium', '/images/exp/exp8.jpg', 0, 'available', 'ê°€ì´ë“œ, ì°¨, ìŒì‹ ì¬ë£Œ', '2026-02-18 12:18:13'),
(9, 'ì²­ì ë„ìê¸° ì²´í—˜', 'craft', 'ê³ ë ¤ì²­ì ë§Œë“¤ê¸°', 'ì „ë‚¨ ê°•ì§„', '4ì‹œê°„', 72000, 10, 'medium', '/images/exp/exp9.jpg', 1, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ ë°°ì†¡', '2026-02-18 12:18:13'),
(10, 'ë‚˜ì „ì¹ ê¸° ì²´í—˜', 'craft', 'ì „í†µ ë‚˜ì „ì¹ ê¸° ì†Œí’ˆ ë§Œë“¤ê¸°', 'ì „ë¶ ì „ì£¼', '6ì‹œê°„', 120000, 8, 'hard', '/images/exp/exp10.jpg', 0, 'available', 'ì¬ë£Œë¹„, ê°€ì´ë“œ, ì™„ì„±í’ˆ', '2026-02-18 12:18:13'),
(11, 'ì°¨ë°­ ìš”ê°€ ëª…ìƒ', 'meditation', 'ì°¨ë°­ì—ì„œ í•˜ëŠ” ìš”ê°€ì™€ ëª…ìƒ', 'ì „ë‚¨ ë³´ì„±', '2ì‹œê°„', 48000, 15, 'easy', '/images/exp/exp11.jpg', 1, 'available', 'ê°€ì´ë“œ, ìš”ê°€ë§¤íŠ¸, ì°¨', '2026-02-18 12:18:13'),
(12, 'ì°¨ ì†Œë¯ˆë¦¬ì— ì²´í—˜', 'education', 'ë‹¤ì–‘í•œ ì°¨ ê°ë³„ ë° ì‹œìŒ', 'ì„œìš¸', '3ì‹œê°„', 85000, 10, 'medium', '/images/exp/exp12.jpg', 0, 'available', 'ê°€ì´ë“œ, êµì¬, ì°¨ ìƒ˜í”Œ', '2026-02-18 12:18:13');

INSERT INTO education_categories (id, parent_id, name, description, display_order, icon, created_at) VALUES 
(1, NULL, 'ë‹¤ë„êµìœ¡', 'ì°¨ë¬¸í™”ì™€ ëª…ìƒì„ í†µí•œ ë§ˆìŒì˜ í‰ì•ˆ', 1, 'fa-spa', '2026-02-18 12:18:04'),
(2, 1, 'ì°¨ê³µë¶€', 'ì°¨ì˜ ì—­ì‚¬ì™€ ë¬¸í™”, ì¢…ë¥˜ì™€ ìš°ë¦¬ëŠ” ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤', 1, 'fa-mug-hot', '2026-02-18 12:18:04'),
(3, 1, 'ê³µì˜ˆê³µë¶€', 'í•œêµ­ ì „í†µ ê³µì˜ˆì˜ ì—­ì‚¬ì™€ ì œì‘ ê¸°ë²•ì„ ë°°ì›ë‹ˆë‹¤', 2, 'fa-palette', '2026-02-18 12:18:04'),
(4, 1, 'ë‹¤ë„êµìœ¡', 'ë‹¤ë„ì˜ ì˜ë¯¸ì™€ ì—­ì‚¬, ëª…ìƒê³¼ ì¸ì„±êµìœ¡ì„ ë°°ì›ë‹ˆë‹¤', 3, 'fa-spa', '2026-02-18 12:18:06'),
(5, 1, 'ëª…ìƒêµìœ¡', 'ëª…ìƒì˜ ì—­ì‚¬ì™€ ì¢…ë¥˜, ì‹¤ì²œ ë°©ë²•ì„ ë°°ìš°ê³  ë§ˆìŒì˜ í‰ì•ˆì„ ì°¾ìŠµë‹ˆë‹¤', 4, 'fa-om', '2026-02-18 13:59:11');

INSERT INTO education_curriculum (id, category_id, title, description, content, duration, difficulty, display_order, thumbnail_image, created_at) VALUES 
(1, 2, 'ì°¨ì˜ ì—­ì‚¬', 'ì°¨ì˜ ê¸°ì›ë¶€í„° í˜„ëŒ€ê¹Œì§€ì˜ ì—­ì‚¬ë¥¼ ë°°ì›ë‹ˆë‹¤', 'ì°¨ì˜ ë°œê²¬ê³¼ ì „íŒŒ, í•œêµ­ ì°¨ë¬¸í™”ì˜ ë°œì „ ê³¼ì •ì„ í•™ìŠµí•©ë‹ˆë‹¤', '90ë¶„', 'beginner', 1, '/images/curriculum/tea_history.jpg', '2026-02-18 12:18:04'),
(2, 2, 'í•œêµ­ì°¨ì˜ ì—­ì‚¬', 'í•œêµ­ ì „í†µì°¨ì˜ ì—­ì‚¬ì™€ ë¬¸í™”ì  ë°°ê²½', 'ì‚¼êµ­ì‹œëŒ€ë¶€í„° ì¡°ì„ ì‹œëŒ€ê¹Œì§€ í•œêµ­ ì°¨ë¬¸í™”ì˜ ë°œì „ì‚¬', '120ë¶„', 'intermediate', 2, '/images/curriculum/korean_tea_history.jpg', '2026-02-18 12:18:04'),
(3, 2, '6ëŒ€ ì°¨ë¥˜', 'ì°¨ì˜ 6ê°€ì§€ ë¶„ë¥˜ì™€ ê°ê°ì˜ íŠ¹ì§•', 'ë…¹ì°¨, ë°±ì°¨, í™©ì°¨, ì²­ì°¨, í™ì°¨, í‘ì°¨ì˜ ë¶„ë¥˜ì™€ íŠ¹ì„±', '150ë¶„', 'intermediate', 3, '/images/curriculum/six_types.jpg', '2026-02-18 12:18:04'),
(4, 2, 'í•œêµ­ì°¨ì˜ ì¢…ë¥˜', 'í•œêµ­ ì „í†µì°¨ì˜ ë‹¤ì–‘í•œ ì¢…ë¥˜', 'ë…¹ì°¨, ë°œíš¨ì°¨, ê°€í–¥ì°¨ ë“± í•œêµ­ ì°¨ì˜ ë¶„ë¥˜ì™€ íŠ¹ì§•', '120ë¶„', 'intermediate', 4, '/images/curriculum/korean_tea_types.jpg', '2026-02-18 12:18:04'),
(5, 2, 'ì°¨ì˜ ì´ë¡œìš´ ì ', 'ì°¨ì˜ ê±´ê°•ìƒ ì´ì ê³¼ íš¨ëŠ¥', 'ì°¨ì˜ ì„±ë¶„ê³¼ ê±´ê°• íš¨ëŠ¥, ì˜¬ë°”ë¥¸ ì„­ì·¨ ë°©ë²•', '90ë¶„', 'beginner', 5, '/images/curriculum/tea_benefits.jpg', '2026-02-18 12:18:04'),
(6, 2, '6ëŒ€ ì°¨ë¥˜ ìš°ë¦¬ëŠ” ë°©ë²•', 'ì°¨ ì¢…ë¥˜ë³„ ì˜¬ë°”ë¥¸ ìš°ë¦¬ëŠ” ë°©ë²•', 'ê° ì°¨ë¥˜ë³„ ìµœì ì˜ ì˜¨ë„, ì‹œê°„, ë¬¼ì˜ ì–‘', '180ë¶„', 'advanced', 6, '/images/curriculum/brewing_methods.jpg', '2026-02-18 12:18:04'),
(7, 3, 'ê³µì˜ˆì˜ ì—­ì‚¬', 'í•œêµ­ ì „í†µ ê³µì˜ˆì˜ ì—­ì‚¬', 'ì‚¼êµ­ì‹œëŒ€ë¶€í„° í˜„ëŒ€ê¹Œì§€ í•œêµ­ ê³µì˜ˆì˜ ë°œì „ì‚¬', '90ë¶„', 'beginner', 1, '/images/curriculum/craft_history.jpg', '2026-02-18 12:18:04'),
(8, 3, 'í•œêµ­ê³µì˜ˆì˜ ì‹œëŒ€ë³„ ë³€ì²œì‚¬', 'ì‹œëŒ€ë³„ í•œêµ­ ê³µì˜ˆì˜ íŠ¹ì§•ê³¼ ë³€í™”', 'ì‹œëŒ€ë³„ ê³µì˜ˆ ê¸°ë²•ê³¼ ì–‘ì‹ì˜ ë³€ì²œ', '150ë¶„', 'intermediate', 2, '/images/curriculum/craft_evolution.jpg', '2026-02-18 12:18:04'),
(9, 3, 'ë„ìê¸°ì˜ ì œì‘ ê¸°ë²•', 'ì „í†µ ë„ìê¸° ì œì‘ ê¸°ë²•', 'ë¬¼ë ˆ ì„±í˜•, ìœ ì•½, ì†Œì„± ë“± ë„ìê¸° ì œì‘ ê³¼ì •', '180ë¶„', 'advanced', 3, '/images/curriculum/pottery_technique.jpg', '2026-02-18 12:18:04'),
(10, 3, 'ë„ìê¸°ì˜ í™œìš©ë²•', 'ë„ìê¸°ì˜ ë‹¤ì–‘í•œ í™œìš©', 'ë‹¤ê¸°, ìƒí™œìš©ê¸°, ì¥ì‹í’ˆ ë“± ë„ìê¸° í™œìš©', '90ë¶„', 'beginner', 4, '/images/curriculum/pottery_usage.jpg', '2026-02-18 12:18:04'),
(11, 3, 'ë„ìê¸°ì˜ ì´ë¡œìš´ ì ', 'ë„ìê¸° ì‚¬ìš©ì˜ ì¥ì ', 'ê±´ê°•ìƒ ì´ì ê³¼ ì¹œí™˜ê²½ì  ê°€ì¹˜', '90ë¶„', 'beginner', 5, '/images/curriculum/pottery_benefits.jpg', '2026-02-18 12:18:04'),
(12, 3, 'ì„œì˜ˆì˜ ì—­ì‚¬ì™€ ë°œì „', 'í•œêµ­ ì„œì˜ˆì˜ ì—­ì‚¬', 'í•œê¸€ê³¼ í•œë¬¸ ì„œì˜ˆì˜ ë°œì „ ê³¼ì •', '120ë¶„', 'intermediate', 6, '/images/curriculum/calligraphy_history.jpg', '2026-02-18 12:18:04'),
(13, 3, 'í•œêµ­ ì „í†µë¯¸ìˆ ê³¼ ë¯¼í™”', 'ë¯¼í™”ì˜ ì—­ì‚¬ì™€ íŠ¹ì§•', 'ë¯¼í™”ì˜ ì¢…ë¥˜ì™€ ì˜ë¯¸, í˜„ëŒ€ì  í•´ì„', '90ë¶„', 'intermediate', 7, '/images/curriculum/minhwa.jpg', '2026-02-18 12:18:04'),
(14, 3, 'í•œë³µì˜ ì—­ì‚¬ì™€ ì•„ë¦„ë‹¤ì›€', 'í•œë³µì˜ ì—­ì‚¬ì™€ ë¯¸í•™', 'í•œë³µì˜ êµ¬ì¡°, ìƒ‰ìƒ, ë¬¸ì–‘ì˜ ì˜ë¯¸', '90ë¶„', 'beginner', 8, '/images/curriculum/hanbok.jpg', '2026-02-18 12:18:04'),
(15, 3, 'í•œì§€ì˜ ì—­ì‚¬ì™€ ì œì¡°ë²•', 'ì „í†µ í•œì§€ì˜ ì—­ì‚¬ì™€ ì œì‘', 'í•œì§€ì˜ ì œì¡° ê³¼ì •ê³¼ íŠ¹ì„±, í˜„ëŒ€ì  í™œìš©', '120ë¶„', 'intermediate', 9, '/images/curriculum/hanji.jpg', '2026-02-18 12:18:04'),
(16, 4, 'ë‹¤ë„ì˜ ì˜ë¯¸', 'ë‹¤ë„ì˜ ì •ì‹ ê³¼ ì² í•™', 'ì°¨ë¥¼ í†µí•œ ìˆ˜ì–‘ê³¼ ì˜ˆì ˆì˜ ì˜ë¯¸', '120ë¶„', 'beginner', 1, '/images/curriculum/dado_meaning.jpg', '2026-02-18 12:18:06'),
(17, 4, 'ë‹¤ë„ì˜ ì—­ì‚¬ì™€ ì‹œëŒ€ì  ë³€ì²œì‚¬', 'í•œêµ­ ë‹¤ë„ì˜ ì—­ì‚¬ì  ë°œì „', 'ì‹œëŒ€ë³„ ë‹¤ë„ ë¬¸í™”ì˜ ë³€í™”ì™€ íŠ¹ì§•', '150ë¶„', 'intermediate', 2, '/images/curriculum/dado_history.jpg', '2026-02-18 12:18:06'),
(18, 4, 'ë‹¤ë„ì˜ ì¢…ë¥˜', 'ë‹¤ì–‘í•œ ë‹¤ë„ì˜ ìœ í˜•', 'í•œêµ­, ì¤‘êµ­, ì¼ë³¸ ë‹¤ë„ì˜ íŠ¹ì§• ë¹„êµ', '120ë¶„', 'intermediate', 3, '/images/curriculum/dado_types.jpg', '2026-02-18 12:18:06'),
(19, 4, 'ë‹¤ë„ì™€ ëª…ìƒì˜ íš¨ê³¼', 'ë‹¤ë„ë¥¼ í†µí•œ ëª…ìƒ íš¨ê³¼', 'ë§ˆìŒì˜ í‰ì•ˆê³¼ ì§‘ì¤‘ë ¥ í–¥ìƒ', '90ë¶„', 'beginner', 4, '/images/curriculum/dado_meditation.jpg', '2026-02-18 12:18:06'),
(20, 4, 'ì¸ì„±êµìœ¡ìœ¼ë¡œ ë‹¤ë„ ëª…ìƒì„ í•´ì•¼í•˜ëŠ” ì´ìœ ', 'ë‹¤ë„ë¥¼ í†µí•œ ì¸ì„± í•¨ì–‘', 'ì˜ˆì ˆ, ë°°ë ¤, ì§‘ì¤‘ë ¥ ë“± ì¸ì„± êµìœ¡', '150ë¶„', 'intermediate', 5, '/images/curriculum/dado_character.jpg', '2026-02-18 12:18:06'),
(21, 4, 'ë‹¤ë„ì˜ ì—­ì‚¬ì™€ ì •ì‹ ', 'ë‹¤ë„ì˜ ì² í•™ì  ë°°ê²½', 'ì„ ç¦ªê³¼ ì°¨ì˜ ì •ì‹ ì  ì—°ê²°', '120ë¶„', 'intermediate', 7, '/images/curriculum/dado_spirit.jpg', '2026-02-18 12:18:06'),
(22, 4, 'ë‹¤ë„êµìœ¡ì˜ ì´ë¡ ê³¼ ì‹¤ì œ', 'ë‹¤ë„ êµìœ¡ ë°©ë²•ë¡ ', 'ì´ë¡  í•™ìŠµê³¼ ì‹¤ìŠµì„ í†µí•œ ë‹¤ë„ êµìœ¡', '150ë¶„', 'advanced', 8, '/images/curriculum/dado_practice.jpg', '2026-02-18 12:18:06'),
(23, 5, 'í˜¸í¡ ëª…ìƒ', 'í˜¸í¡ì„ í†µí•œ ëª…ìƒ', 'ì˜¬ë°”ë¥¸ í˜¸í¡ë²•ê³¼ ëª…ìƒ ì‹¤ìŠµ', '45ë¶„', 'beginner', 0, '/images/curriculum/breathing.jpg', '2026-02-18 13:59:11'),
(24, 5, 'ë§ˆìŒì±™ê¹€ ëª…ìƒ', 'ë§ˆìŒì±™ê¹€ ëª…ìƒì˜ ì´ë¡ ê³¼ ì‹¤ìŠµ', 'í˜„ì¬ ìˆœê°„ì— ì§‘ì¤‘í•˜ëŠ” ëª…ìƒ', '60ë¶„', 'intermediate', 0, '/images/curriculum/mindfulness.jpg', '2026-02-18 13:59:11'),
(25, 5, 'ì°¨ ëª…ìƒ', 'ì°¨ë¥¼ ë§ˆì‹œë©° í•˜ëŠ” ëª…ìƒ', 'ì°¨ë¥¼ í†µí•œ ì˜¤ê° ëª…ìƒ', '90ë¶„', 'intermediate', 0, '/images/curriculum/tea_meditation.jpg', '2026-02-18 13:59:11'),
(26, 5, 'ìš”ê°€ì™€ ëª…ìƒ', 'ìš”ê°€ ë™ì‘ê³¼ ëª…ìƒì˜ ê²°í•©', 'ëª¸ê³¼ ë§ˆìŒì„ í•¨ê»˜ ë‹¤ìŠ¤ë¦¬ëŠ” ëª…ìƒ', '75ë¶„', 'intermediate', 0, '/images/curriculum/yoga_meditation.jpg', '2026-02-18 13:59:11'),
(27, 5, 'ëª…ìƒì˜ ì—­ì‚¬', 'ëª…ìƒì˜ ê¸°ì›ê³¼ ë°œì „', 'ë™ì„œì–‘ ëª…ìƒì˜ ì—­ì‚¬ì™€ ì² í•™', '90ë¶„', 'beginner', 1, '/images/curriculum/meditation_history.jpg', '2026-02-18 13:59:11'),
(28, 5, 'ëª…ìƒì˜ ì¢…ë¥˜ì™€ ì‹¤ì²œ', 'ë‹¤ì–‘í•œ ëª…ìƒë²•', 'í˜¸í¡ëª…ìƒ, ì„ ëª…ìƒ, ìœ„ë¹ ì‚¬ë‚˜ ë“±', '150ë¶„', 'intermediate', 2, '/images/curriculum/meditation_types.jpg', '2026-02-18 13:59:11'),
(29, 5, 'ëª…ìƒì˜ ì •ì˜ì™€ ì›ë¦¬', 'ëª…ìƒì˜ ë³¸ì§ˆê³¼ ì‘ìš© ì›ë¦¬', 'ëª…ìƒì´ ë‡Œì™€ ì‹ ì²´ì— ë¯¸ì¹˜ëŠ” ì˜í–¥', '60ë¶„', 'beginner', 2, '/images/curriculum/meditation_principle.jpg', '2026-02-18 13:59:11'),
(30, 5, 'ì¼ìƒ ì† ëª…ìƒ ì‹¤ì²œ', 'ë°”ìœ ì¼ìƒ ì† ëª…ìƒ ì ìš©', 'ì§§ì€ ì‹œê°„ìœ¼ë¡œ í•˜ëŠ” ì‹¤ìš©ì  ëª…ìƒë²•', '45ë¶„', 'beginner', 3, '/images/curriculum/daily_meditation.jpg', '2026-02-18 13:59:11');`;
  
  return c.text(sql, 200, {
    'Content-Type': 'text/plain; charset=utf-8',
    'Content-Disposition': 'inline; filename="COPY_THIS.sql"'
  })
})

// ë„¤ì´ë²„ ì‚¬ì´íŠ¸ ì†Œìœ  í™•ì¸ íŒŒì¼ (êµ¬ë²„ì „)
app.get('/naverf3735d7a56c13e617b246ff2b6e0da46.html', (c) => {
  return c.text('naver-site-verification: naverf3735d7a56c13e617b246ff2b6e0da46.html', 200, {
    'Content-Type': 'text/html; charset=utf-8'
  })
})

// ë„¤ì´ë²„ ì‚¬ì´íŠ¸ ì†Œìœ  í™•ì¸ íŒŒì¼ (ì‹ ê·œ - dagong-bi1.pages.dev)
app.get('/navere1b82926e3746b15d5a96506bba49b8f.html', (c) => {
  return c.text('naver-site-verification: navere1b82926e3746b15d5a96506bba49b8f.html', 200, {
    'Content-Type': 'text/html; charset=utf-8'
  })
})

// êµ¬ê¸€ ì‚¬ì´íŠ¸ ì†Œìœ  í™•ì¸ íŒŒì¼
app.get('/googleee4e97dad940b617.html', (c) => {
  return c.text('google-site-verification: googleee4e97dad940b617.html', 200, {
    'Content-Type': 'text/html; charset=utf-8'
  })
})

// robots.txt ì„œë¹™
app.get('/robots.txt', (c) => {
  // ìš”ì²­ì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ì´íŠ¸ë§µ URL ìƒì„±
  const protocol = c.req.header('x-forwarded-proto') || 'https'
  const host = c.req.header('host') || 'dagong-bi1.pages.dev'
  const sitemapUrl = `${protocol}://${host}/sitemap.xml`
  
  return c.text(`User-agent: *
Allow: /

Sitemap: ${sitemapUrl}`, 200, {
    'Content-Type': 'text/plain; charset=utf-8'
  })
})

// PWA Manifest ì„œë¹™
app.get('/manifest.json', (c) => {
  return c.json({
    name: 'ë‹¤ê³µ(èŒ¶å·¥) - ì°¨ ìƒì‚°ì ì§ê±°ë˜ í”Œë«í¼',
    short_name: 'ë‹¤ê³µ',
    description: 'ì°¨ ìƒì‚°ìì™€ ì†Œë¹„ìë¥¼ ì§ì ‘ ì—°ê²°í•˜ëŠ” ì§ê±°ë˜ í”Œë«í¼. ì°¨ ì§ê±°ë˜, ê³µì˜ˆí’ˆ, ì²´í—˜ êµìœ¡ì„ ì œê³µí•©ë‹ˆë‹¤.',
    start_url: '/',
    display: 'standalone',
    background_color: '#ffffff',
    theme_color: '#059669',
    orientation: 'portrait-primary',
    scope: '/',
    icons: [
      { src: '/static/icons/icon-192x192.png', sizes: '192x192', type: 'image/png', purpose: 'any maskable' },
      { src: '/static/icons/icon-512x512.png', sizes: '512x512', type: 'image/png', purpose: 'any maskable' }
    ],
    categories: ['shopping', 'lifestyle', 'business'],
    prefer_related_applications: false
  })
})

// Digital Asset Links for Android TWA
app.get('/.well-known/assetlinks.json', (c) => {
  return c.json([{
    relation: ['delegate_permission/common.handle_all_urls'],
    target: {
      namespace: 'android_app',
      package_name: 'kr.co.dagong',
      sha256_cert_fingerprints: [
        'ì—¬ê¸°ì—_ì‹¤ì œ_SHA256_ì§€ë¬¸ì„_ì…ë ¥í•˜ì„¸ìš”'
      ]
    }
  }])
})

// sitemap.xml ì„œë¹™ (ê°„ë‹¨ ë²„ì „)
app.get('/sitemap.xml', (c) => {
  // ìš”ì²­ì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ baseUrl ë™ì  ìƒì„±
  const protocol = c.req.header('x-forwarded-proto') || 'https'
  const host = c.req.header('host') || 'dagong-bi1.pages.dev'
  const baseUrl = `${protocol}://${host}`
  const today = new Date().toISOString().split('T')[0]
  
  const xml = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>${baseUrl}/</loc>
    <lastmod>${today}</lastmod>
    <changefreq>daily</changefreq>
    <priority>1.0</priority>
  </url>
  <url>
    <loc>${baseUrl}/products</loc>
    <lastmod>${today}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  <url>
    <loc>${baseUrl}/products?type=tea</loc>
    <lastmod>${today}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  <url>
    <loc>${baseUrl}/products?type=craft</loc>
    <lastmod>${today}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  <url>
    <loc>${baseUrl}/regions</loc>
    <lastmod>${today}</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.8</priority>
  </url>
  <url>
    <loc>${baseUrl}/producers</loc>
    <lastmod>${today}</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.8</priority>
  </url>
  <url>
    <loc>${baseUrl}/experiences</loc>
    <lastmod>${today}</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.7</priority>
  </url>
  <url>
    <loc>${baseUrl}/education/apply</loc>
    <lastmod>${today}</lastmod>
    <changefreq>monthly</changefreq>
    <priority>0.6</priority>
  </url>
  <url>
    <loc>${baseUrl}/education/curriculum</loc>
    <lastmod>${today}</lastmod>
    <changefreq>monthly</changefreq>
    <priority>0.6</priority>
  </url>
  <url>
    <loc>${baseUrl}/events</loc>
    <lastmod>${today}</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.7</priority>
  </url>
</urlset>`

  return c.text(xml, 200, {
    'Content-Type': 'application/xml; charset=utf-8'
  })
})

// PWA íŒŒì¼ ì„œë¹™
app.get('/manifest.json', async (c) => {
  const manifestData = {
    name: "ë‹¤ê³µ - ì°¨ì™€ ê³µì˜ˆì˜ ì§ê±°ë˜ í”Œë«í¼",
    short_name: "ë‹¤ê³µ",
    description: "ì „í†µ ì°¨ì™€ ê³µì˜ˆí’ˆì„ ìƒì‚°ìì™€ ì§ê±°ë˜í•˜ëŠ” ëª¨ë°”ì¼ í”Œë«í¼. ì†Œë¹„ìê°€ì™€ ì§ê±°ë˜ê°€ë¡œ ìµœëŒ€ 50% ì ˆì•½í•˜ì„¸ìš”.",
    start_url: "/",
    display: "standalone",
    background_color: "#f5f1e8",
    theme_color: "#7c9473",
    orientation: "portrait-primary",
    scope: "/",
    icons: [
      { src: "/static/icons/icon-72x72.png", sizes: "72x72", type: "image/png", purpose: "any" },
      { src: "/static/icons/icon-96x96.png", sizes: "96x96", type: "image/png", purpose: "any" },
      { src: "/static/icons/icon-128x128.png", sizes: "128x128", type: "image/png", purpose: "any" },
      { src: "/static/icons/icon-144x144.png", sizes: "144x144", type: "image/png", purpose: "any" },
      { src: "/static/icons/icon-152x152.png", sizes: "152x152", type: "image/png", purpose: "any" },
      { src: "/static/icons/icon-192x192.png", sizes: "192x192", type: "image/png", purpose: "any maskable" },
      { src: "/static/icons/icon-384x384.png", sizes: "384x384", type: "image/png", purpose: "any" },
      { src: "/static/icons/icon-512x512.png", sizes: "512x512", type: "image/png", purpose: "any maskable" }
    ],
    screenshots: [
      { src: "/static/screenshots/screenshot-mobile.png", sizes: "540x720", type: "image/png", form_factor: "narrow", label: "í™ˆ í™”ë©´" },
      { src: "/static/screenshots/screenshot-products.png", sizes: "540x720", type: "image/png", form_factor: "narrow", label: "ìƒí’ˆ ëª©ë¡" }
    ],
    categories: ["shopping", "food", "lifestyle"],
    lang: "ko-KR",
    dir: "ltr",
    prefer_related_applications: false,
    related_applications: [
      {
        platform: "play",
        url: "https://play.google.com/store/apps/details?id=kr.co.dagong.twa",
        id: "kr.co.dagong.twa"
      }
    ],
    share_target: {
      action: "/share",
      method: "POST",
      enctype: "multipart/form-data",
      params: {
        title: "title",
        text: "text",
        url: "url"
      }
    }
  }
  return c.json(manifestData)
})

// ë Œë”ëŸ¬ ë¯¸ë“¤ì›¨ì–´
app.use(renderer)

// ===== API ë¼ìš°íŠ¸ =====

// ì§€ì—­ ëª©ë¡ ì¡°íšŒ API
app.get('/api/regions', async (c) => {
  const type = c.req.query('type') // 'tea' ë˜ëŠ” 'craft'
  
  let query = 'SELECT * FROM regions'
  const params: string[] = []
  
  if (type) {
    query += ' WHERE type = ?'
    params.push(type)
  }
  
  query += ' ORDER BY id'
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ regions: results })
})

// íŠ¹ì • ì§€ì—­ ìƒì„¸ ì¡°íšŒ API
app.get('/api/regions/:id', async (c) => {
  const id = c.req.param('id')
  
  const region = await c.env.DB.prepare(
    'SELECT * FROM regions WHERE id = ?'
  ).bind(id).first()
  
  if (!region) {
    return c.json({ error: 'ì§€ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  // í•´ë‹¹ ì§€ì—­ì˜ ìƒì‚°ì ëª©ë¡
  const { results: producers } = await c.env.DB.prepare(
    'SELECT * FROM producers WHERE region_id = ?'
  ).bind(id).all()
  
  // í•´ë‹¹ ì§€ì—­ì˜ ê´€ê´‘ì§€
  const { results: attractions } = await c.env.DB.prepare(
    'SELECT * FROM attractions WHERE region_id = ?'
  ).bind(id).all()
  
  return c.json({ 
    region, 
    producers,
    attractions
  })
})

// ìƒì‚°ì ëª©ë¡ ì¡°íšŒ API
app.get('/api/producers', async (c) => {
  const type = c.req.query('type')
  const regionId = c.req.query('region_id')
  
  let query = `
    SELECT p.*, r.name as region_name 
    FROM producers p 
    LEFT JOIN regions r ON p.region_id = r.id
    WHERE 1=1
  `
  const params: string[] = []
  
  if (type) {
    query += ' AND p.producer_type = ?'
    params.push(type)
  }
  
  if (regionId) {
    query += ' AND p.region_id = ?'
    params.push(regionId)
  }
  
  query += ' ORDER BY p.id'
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ producers: results })
})

// íŠ¹ì • ìƒì‚°ì ìƒì„¸ ì¡°íšŒ API
app.get('/api/producers/:id', async (c) => {
  const id = c.req.param('id')
  
  const producer = await c.env.DB.prepare(`
    SELECT p.*, r.name as region_name 
    FROM producers p 
    LEFT JOIN regions r ON p.region_id = r.id
    WHERE p.id = ?
  `).bind(id).first()
  
  if (!producer) {
    return c.json({ error: 'ìƒì‚°ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  // í•´ë‹¹ ìƒì‚°ìì˜ ìƒí’ˆ ëª©ë¡
  const { results: products } = await c.env.DB.prepare(
    'SELECT * FROM products WHERE producer_id = ? AND is_available = 1'
  ).bind(id).all()
  
  return c.json({ producer, products })
})

// íŒë§¤ì ì •ë³´ ë“±ë¡ (ì‚¬ì—…ì/ê°œì¸ êµ¬ë¶„) - ë¡œê·¸ì¸ í•„ìˆ˜
app.post('/api/producers', authMiddleware, async (c) => {
  const data = await c.req.json()
  const user = c.get('user') as any
  
  // ì´ë¯¸ íŒë§¤ì ì •ë³´ê°€ ìˆëŠ”ì§€ í™•ì¸
  const existingProducer = await c.env.DB.prepare(
    'SELECT id FROM producers WHERE user_id = ?'
  ).bind(user.user_id).first()
  
  if (existingProducer) {
    return c.json({ 
      error: 'ì´ë¯¸ íŒë§¤ì ì •ë³´ê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤',
      producer_id: (existingProducer as any).id 
    }, 400)
  }
  
  // seller_type ê²€ì¦: 'business' ë˜ëŠ” 'individual'
  const sellerType = data.seller_type || 'individual'
  if (!['business', 'individual'].includes(sellerType)) {
    return c.json({ error: 'seller_typeì€ business ë˜ëŠ” individualì´ì–´ì•¼ í•©ë‹ˆë‹¤' }, 400)
  }
  
  // ì‚¬ì—…ìì¸ ê²½ìš° í•„ìˆ˜ í•„ë“œ ê²€ì¦
  if (sellerType === 'business') {
    if (!data.business_registration_number) {
      return c.json({ error: 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤' }, 400)
    }
    if (!data.business_name) {
      return c.json({ error: 'ìƒí˜¸ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤' }, 400)
    }
    if (!data.representative_name) {
      return c.json({ error: 'ëŒ€í‘œìëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤' }, 400)
    }
  }
  
  // ê°œì¸ì¸ ê²½ìš° í•„ìˆ˜ í•„ë“œ ê²€ì¦
  if (sellerType === 'individual') {
    if (!data.personal_id_number) {
      return c.json({ error: 'ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤' }, 400)
    }
    if (!data.mobile_phone) {
      return c.json({ error: 'íœ´ëŒ€í° ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤' }, 400)
    }
    if (!data.personal_email) {
      return c.json({ error: 'ì´ë©”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤' }, 400)
    }
  }
  
  // ê³µí†µ í•„ìˆ˜ í•„ë“œ
  const accountHolder = data.account_holder_name || data.account_holder;
  const accountNumber = data.bank_account_number || data.account_number;
  
  if (!data.bank_name || !accountNumber || !accountHolder) {
    return c.json({ error: 'ì€í–‰ëª…, ê³„ì¢Œë²ˆí˜¸, ì˜ˆê¸ˆì£¼ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤' }, 400)
  }
  
  try {
    const result = await c.env.DB.prepare(`
      INSERT INTO producers (
        user_id, name, region_id, producer_type, description, profile_image,
        contact_phone, contact_email, address,
        seller_type,
        business_registration_number, business_name, representative_name,
        business_address, business_phone,
        personal_id_number, mobile_phone, personal_address, personal_zipcode, personal_email,
        bank_name, account_number, account_holder,
        is_verified
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(
      user.user_id,
      data.name,
      data.region_id || null,
      data.producer_type || 'both',
      data.description || null,
      data.profile_image || null,
      data.phone || data.contact_phone || null,
      data.email || data.contact_email || null,
      data.address || null,
      sellerType,
      sellerType === 'business' ? (data.business_registration_number || null) : null,
      sellerType === 'business' ? (data.business_name || null) : null,
      sellerType === 'business' ? (data.representative_name || null) : null,
      sellerType === 'business' ? (data.business_address || null) : null,
      sellerType === 'business' ? (data.business_phone || null) : null,
      sellerType === 'individual' ? (data.personal_id_number || null) : null,
      sellerType === 'individual' ? (data.mobile_phone || null) : null,
      sellerType === 'individual' ? (data.personal_address || null) : null,
      sellerType === 'individual' ? (data.personal_zipcode || null) : null,
      sellerType === 'individual' ? (data.personal_email || null) : null,
      data.bank_name,
      accountNumber,
      accountHolder,
      0 // is_verified: ê¸°ë³¸ê°’ 0 (ë¯¸ì¸ì¦)
    ).run()
    
    return c.json({ 
      success: true, 
      producer_id: result.meta.last_row_id,
      message: 'íŒë§¤ì ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ìƒí’ˆ ë“±ë¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
    })
  } catch (error: any) {
    return c.json({ error: 'íŒë§¤ì ë“±ë¡ ì‹¤íŒ¨: ' + error.message }, 500)
  }
})

// íŒë§¤ì ì •ë³´ ìˆ˜ì •
app.put('/api/producers/:id', async (c) => {
  const producerId = c.req.param('id')
  const data = await c.req.json()
  
  // seller_type ê²€ì¦ (ë³€ê²½ ê°€ëŠ¥)
  if (data.seller_type && !['business', 'individual'].includes(data.seller_type)) {
    return c.json({ error: 'seller_typeì€ business ë˜ëŠ” individualì´ì–´ì•¼ í•©ë‹ˆë‹¤' }, 400)
  }
  
  // ê¸°ì¡´ íŒë§¤ì ì •ë³´ ì¡°íšŒ
  const existingProducer = await c.env.DB.prepare(
    'SELECT seller_type FROM producers WHERE id = ?'
  ).bind(producerId).first()
  
  if (!existingProducer) {
    return c.json({ error: 'íŒë§¤ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  const sellerType = data.seller_type || existingProducer.seller_type
  
  try {
    await c.env.DB.prepare(`
      UPDATE producers SET
        name = COALESCE(?, name),
        region_id = COALESCE(?, region_id),
        producer_type = COALESCE(?, producer_type),
        description = COALESCE(?, description),
        profile_image = COALESCE(?, profile_image),
        contact_phone = COALESCE(?, contact_phone),
        contact_email = COALESCE(?, contact_email),
        address = COALESCE(?, address),
        seller_type = COALESCE(?, seller_type),
        business_registration_number = ?,
        business_name = ?,
        representative_name = ?,
        business_address = ?,
        business_phone = ?,
        personal_id_number = ?,
        mobile_phone = ?,
        personal_address = ?,
        personal_zipcode = ?,
        personal_email = ?,
        bank_name = COALESCE(?, bank_name),
        account_number = COALESCE(?, account_number),
        account_holder = COALESCE(?, account_holder),
        updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(
      data.name || null,
      data.region_id || null,
      data.producer_type || null,
      data.description || null,
      data.profile_image || null,
      data.phone || data.contact_phone || null,
      data.email || data.contact_email || null,
      data.address || null,
      data.seller_type || null,
      sellerType === 'business' ? data.business_registration_number : null,
      sellerType === 'business' ? data.business_name : null,
      sellerType === 'business' ? data.representative_name : null,
      sellerType === 'business' ? data.business_address : null,
      sellerType === 'business' ? data.business_phone : null,
      sellerType === 'individual' ? data.personal_id_number : null,
      sellerType === 'individual' ? data.mobile_phone : null,
      sellerType === 'individual' ? data.personal_address : null,
      sellerType === 'individual' ? data.personal_zipcode : null,
      sellerType === 'individual' ? data.personal_email : null,
      data.bank_name || null,
      data.bank_account_number || data.account_number || null,
      data.account_holder_name || data.account_holder || null,
      producerId
    ).run()
    
    return c.json({ success: true, message: 'íŒë§¤ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' })
  } catch (error: any) {
    return c.json({ error: 'íŒë§¤ì ì •ë³´ ìˆ˜ì • ì‹¤íŒ¨: ' + error.message }, 500)
  }
})

// ìƒí’ˆ ëª©ë¡ ì¡°íšŒ API
app.get('/api/products', async (c) => {
  const type = c.req.query('type')
  const categoryId = c.req.query('category_id')
  const featured = c.req.query('featured')
  const search = c.req.query('search')
  const limit = c.req.query('limit') || '20'
  const offset = c.req.query('offset') || '0'
  
  let query = `
    SELECT p.*, c.name as category_name, pr.name as producer_name, r.name as region_name
    FROM products p
    LEFT JOIN categories c ON p.category_id = c.id
    LEFT JOIN producers pr ON p.producer_id = pr.id
    LEFT JOIN regions r ON pr.region_id = r.id
    WHERE p.is_available = 1
  `
  const params: any[] = []
  
  if (type) {
    query += ' AND p.product_type = ?'
    params.push(type)
  }
  
  if (categoryId) {
    query += ' AND p.category_id = ?'
    params.push(categoryId)
  }
  
  if (featured === 'true') {
    query += ' AND p.is_featured = 1'
  }
  
  if (search) {
    query += ' AND (p.name LIKE ? OR p.description LIKE ?)'
    params.push(`%${search}%`, `%${search}%`)
  }
  
  query += ' ORDER BY p.is_featured DESC, p.created_at DESC LIMIT ? OFFSET ?'
  params.push(parseInt(limit), parseInt(offset))
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ products: results })
})

// íŠ¹ì • ìƒí’ˆ ìƒì„¸ ì¡°íšŒ API
app.get('/api/products/:id', async (c) => {
  const id = c.req.param('id')
  
  const product = await c.env.DB.prepare(`
    SELECT p.*, c.name as category_name, pr.name as producer_name, 
           pr.description as producer_description, r.name as region_name
    FROM products p
    LEFT JOIN categories c ON p.category_id = c.id
    LEFT JOIN producers pr ON p.producer_id = pr.id
    LEFT JOIN regions r ON pr.region_id = r.id
    WHERE p.id = ?
  `).bind(id).first()
  
  if (!product) {
    return c.json({ error: 'ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  // ì¡°íšŒìˆ˜ ì¦ê°€
  await c.env.DB.prepare(
    'UPDATE products SET view_count = view_count + 1 WHERE id = ?'
  ).bind(id).run()
  
  // ìƒí’ˆ ì´ë¯¸ì§€ ëª©ë¡
  const { results: images } = await c.env.DB.prepare(
    'SELECT * FROM product_images WHERE product_id = ? ORDER BY display_order'
  ).bind(id).all()
  
  // ì„ ë¬¼ì„¸íŠ¸ì¸ ê²½ìš° êµ¬ì„±í’ˆ ì¡°íšŒ
  let giftSetItems = []
  if (product.product_type === 'gift_set') {
    const { results } = await c.env.DB.prepare(`
      SELECT p.*, gsi.quantity
      FROM gift_set_items gsi
      LEFT JOIN products p ON gsi.product_id = p.id
      WHERE gsi.gift_set_id = ?
    `).bind(id).all()
    giftSetItems = results
  }
  
  return c.json({ product, images, giftSetItems })
})

// ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ API
app.get('/api/categories', async (c) => {
  const type = c.req.query('type')
  
  let query = 'SELECT * FROM categories WHERE parent_id IS NULL'
  const params: string[] = []
  
  if (type) {
    query += ' AND type = ?'
    params.push(type)
  }
  
  // display_order ì»¬ëŸ¼ìœ¼ë¡œ ì •ë ¬ (ì—†ìœ¼ë©´ idë¡œ ì •ë ¬)
  query += ' ORDER BY display_order, id'
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ categories: results })
})

// ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ API
app.get('/api/events', async (c) => {
  try {
    const active = c.req.query('active')
    const month = c.req.query('month')
    const limitParam = c.req.query('limit')
    const limit = limitParam ? parseInt(limitParam) : 30
    
    let query = `SELECT * FROM events`
    const params: (string | number)[] = []
    let whereAdded = false
    
    // í™œì„± ìƒíƒœ í•„í„°ë§
    if (active === 'true' || active === undefined) {
      query += ' WHERE is_active = 1'
      whereAdded = true
    } else if (active === 'false') {
      query += ' WHERE is_active = 0'
      whereAdded = true
    }
    
    // ì›”ë³„ í•„í„°ë§
    if (month) {
      query += whereAdded ? ' AND' : ' WHERE'
      query += ' month = ?'
      params.push(parseInt(month))
      whereAdded = true
    }
    
    // ìš°ì„ ìˆœìœ„ì™€ ì›” ìˆœìœ¼ë¡œ ì •ë ¬
    query += ' ORDER BY month ASC, priority DESC, start_date ASC LIMIT ?'
    params.push(limit)
    
    const { results } = await c.env.DB.prepare(query).bind(...params).all()
    
    return c.json({ events: results || [] })
  } catch (error) {
    console.error('Events API error:', error)
    // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜ (í™ˆí˜ì´ì§€ê°€ ë¡œë“œë˜ë„ë¡)
    return c.json({ events: [] })
  }
})

// íŠ¹ì • ì´ë²¤íŠ¸ ìƒì„¸ ì¡°íšŒ API
app.get('/api/events/:id', async (c) => {
  const id = c.req.param('id')
  
  const event = await c.env.DB.prepare(
    'SELECT * FROM events WHERE id = ?'
  ).bind(id).first()
  
  if (!event) {
    return c.json({ error: 'ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  return c.json({ event })
})

// ê´€ê´‘ì§€ ëª©ë¡ ì¡°íšŒ API
app.get('/api/attractions', async (c) => {
  const regionId = c.req.query('region_id')
  const type = c.req.query('type')
  
  let query = `
    SELECT a.*, r.name as region_name
    FROM attractions a
    LEFT JOIN regions r ON a.region_id = r.id
    WHERE 1=1
  `
  const params: string[] = []
  
  if (regionId) {
    query += ' AND a.region_id = ?'
    params.push(regionId)
  }
  
  if (type) {
    query += ' AND a.attraction_type = ?'
    params.push(type)
  }
  
  query += ' ORDER BY a.id'
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ attractions: results })
})

// ì²´í—˜ í”„ë¡œê·¸ë¨ ëª©ë¡ ì¡°íšŒ API
app.get('/api/experiences', async (c) => {
  const type = c.req.query('type')
  const regionId = c.req.query('region_id')
  
  let query = `
    SELECT e.*, r.name as region_name, p.name as producer_name
    FROM experiences e
    LEFT JOIN regions r ON e.region_id = r.id
    LEFT JOIN producers p ON e.producer_id = p.id
    WHERE e.is_available = 1
  `
  const params: string[] = []
  
  if (type) {
    query += ' AND e.experience_type = ?'
    params.push(type)
  }
  
  if (regionId) {
    query += ' AND e.region_id = ?'
    params.push(regionId)
  }
  
  query += ' ORDER BY e.id'
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ experiences: results })
})

// íŠ¹ì • ì²´í—˜ ìƒì„¸ ì¡°íšŒ API
app.get('/api/experiences/:id', async (c) => {
  const id = c.req.param('id')
  
  const experience = await c.env.DB.prepare(`
    SELECT e.*, r.name as region_name, p.name as producer_name
    FROM experiences e
    LEFT JOIN regions r ON e.region_id = r.id
    LEFT JOIN producers p ON e.producer_id = p.id
    WHERE e.id = ?
  `).bind(id).first()
  
  if (!experience) {
    return c.json({ error: 'ì²´í—˜ í”„ë¡œê·¸ë¨ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  // ì˜ˆì•½ ê°€ëŠ¥í•œ ì¼ì • ëª©ë¡
  const { results: schedules } = await c.env.DB.prepare(`
    SELECT * FROM experience_schedules 
    WHERE experience_id = ? 
    AND date(schedule_date) >= date('now')
    AND booked_slots < available_slots
    ORDER BY schedule_date, start_time
  `).bind(id).all()
  
  return c.json({ experience, schedules })
})

// ê²€ìƒ‰ API
app.get('/api/search', async (c) => {
  const q = c.req.query('q')
  
  if (!q) {
    return c.json({ error: 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”' }, 400)
  }
  
  // ìƒí’ˆ ê²€ìƒ‰
  const { results: products } = await c.env.DB.prepare(`
    SELECT p.*, 'product' as result_type
    FROM products p
    WHERE (p.name LIKE ? OR p.description LIKE ?)
    AND p.is_available = 1
    LIMIT 10
  `).bind(`%${q}%`, `%${q}%`).all()
  
  // ìƒì‚°ì ê²€ìƒ‰
  const { results: producers } = await c.env.DB.prepare(`
    SELECT pr.*, 'producer' as result_type
    FROM producers pr
    WHERE pr.name LIKE ? OR pr.description LIKE ?
    LIMIT 10
  `).bind(`%${q}%`, `%${q}%`).all()
  
  // ì§€ì—­ ê²€ìƒ‰
  const { results: regions } = await c.env.DB.prepare(`
    SELECT r.*, 'region' as result_type
    FROM regions r
    WHERE r.name LIKE ? OR r.description LIKE ?
    LIMIT 10
  `).bind(`%${q}%`, `%${q}%`).all()
  
  return c.json({ 
    results: {
      products,
      producers,
      regions
    }
  })
})

// ===== ìƒì‚°ì ê´€ë¦¬ API =====

// ìƒì‚°ìë³„ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
app.get('/api/producers/:id/products', async (c) => {
  const producerId = c.req.param('id')
  
  const { results } = await c.env.DB.prepare(`
    SELECT p.*, c.name as category_name, c.type as category_type
    FROM products p
    LEFT JOIN categories c ON p.category_id = c.id
    WHERE p.producer_id = ?
    ORDER BY p.created_at DESC
  `).bind(producerId).all()
  
  return c.json({ products: results })
})

// ìƒì‚°ìë³„ ì²´í—˜ ëª©ë¡ ì¡°íšŒ
app.get('/api/producers/:id/experiences', async (c) => {
  const producerId = c.req.param('id')
  
  const { results } = await c.env.DB.prepare(`
    SELECT e.*, r.name as region_name
    FROM experiences e
    LEFT JOIN regions r ON e.region_id = r.id
    WHERE e.producer_id = ?
    ORDER BY e.created_at DESC
  `).bind(producerId).all()
  
  return c.json({ experiences: results })
})

// ìƒí’ˆ ë“±ë¡
app.post('/api/products', authMiddleware, async (c) => {
  const data = await c.req.json()
  const user = c.get('user') as any
  
  // íŒë§¤ì ì •ë³´ í™•ì¸
  const producer = await c.env.DB.prepare(
    'SELECT id FROM producers WHERE user_id = ? AND is_verified = 1'
  ).bind(user.user_id).first()
  
  if (!producer) {
    return c.json({ 
      error: 'íŒë§¤ì ì •ë³´ê°€ ì—†ê±°ë‚˜ ìŠ¹ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € íŒë§¤ì ì •ë³´ë¥¼ ë“±ë¡í•˜ê³  ìŠ¹ì¸ì„ ë°›ì•„ì£¼ì„¸ìš”.'
    }, 403)
  }
  
  const producerId = (producer as any).id
  
  // ì´ë¯¸ì§€ ê°œìˆ˜ ê²€ì¦ (ìµœì†Œ 5ê°œ, ìµœëŒ€ 10ê°œ)
  const images = data.images || []
  if (images.length < 5) {
    return c.json({ error: 'ìƒí’ˆ ì´ë¯¸ì§€ëŠ” ìµœì†Œ 5ê°œ ì´ìƒ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤', min_images: 5 }, 400)
  }
  if (images.length > 10) {
    return c.json({ error: 'ìƒí’ˆ ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 10ê°œê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', max_images: 10 }, 400)
  }
  
  // í• ì¸ìœ¨ ê²€ì¦ (20% ~ 50%)
  const discountRate = data.discount_rate || 30
  if (discountRate < 20 || discountRate > 50) {
    return c.json({ error: 'í• ì¸ìœ¨ì€ 20%ì—ì„œ 50% ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤', min: 20, max: 50 }, 400)
  }
  
  // ìƒˆë¡œìš´ ê°€ê²© í•„ë“œ ì‚¬ìš©: consumer_price, direct_price
  // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ original_price, priceë„ ìœ ì§€
  const consumerPrice = data.consumer_price || data.original_price
  const directPrice = data.direct_price || data.price
  
  // ìˆ˜ìˆ˜ë£Œ ê³„ì‚°: í”Œë«í¼ 6.6% + ì¹´ë“œ 3.3% + ì„¸ê¸ˆ 3.3% = ì´ 13.2%
  const platformFeeRate = 6.6
  const cardFeeRate = 3.3
  const taxRate = 3.3
  const totalFeeRate = 13.2
  
  const platformFeeAmount = Math.round(directPrice * (platformFeeRate / 100))
  const cardFeeAmount = Math.round(directPrice * (cardFeeRate / 100))
  const taxAmount = Math.round(directPrice * (taxRate / 100))
  const totalFeeAmount = platformFeeAmount + cardFeeAmount + taxAmount
  const producerRevenue = directPrice - totalFeeAmount
  
  const result = await c.env.DB.prepare(`
    INSERT INTO products (
      name, category_id, producer_id, description, 
      consumer_price, direct_price, original_price, price, discount_rate, 
      shipping_fee, stock_quantity, 
      platform_fee_rate, card_fee_rate, tax_rate, total_fee_rate,
      platform_fee_amount, card_fee_amount, tax_amount, total_fee_amount, producer_revenue,
      main_image, product_type, weight, origin, is_featured
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
  `).bind(
    data.name,
    data.category_id,
    producerId, // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ íŒë§¤ì ID ì‚¬ìš©
    data.description || null,
    consumerPrice,
    directPrice,
    consumerPrice, // í•˜ìœ„ í˜¸í™˜ì„±
    directPrice, // í•˜ìœ„ í˜¸í™˜ì„±
    discountRate,
    data.shipping_fee || 3000,
    data.stock_quantity || 0,
    platformFeeRate,
    cardFeeRate,
    taxRate,
    totalFeeRate,
    platformFeeAmount,
    cardFeeAmount,
    taxAmount,
    totalFeeAmount,
    producerRevenue,
    data.main_image || '/images/products/default.jpg',
    data.product_type || null,
    data.weight || null,
    data.origin || null,
    data.is_featured ? 1 : 0
  ).run()
  
  const productId = result.meta.last_row_id
  
  // ìƒí’ˆ ì´ë¯¸ì§€ ë“±ë¡ (5~10ê°œ)
  for (let i = 0; i < images.length; i++) {
    await c.env.DB.prepare(`
      INSERT INTO product_images (product_id, image_url, display_order)
      VALUES (?, ?, ?)
    `).bind(productId, images[i], i + 1).run()
  }
  
  return c.json({ 
    success: true, 
    product_id: productId,
    images_count: images.length,
    message: 'ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤'
  })
})

// ìƒí’ˆ ìˆ˜ì •
app.put('/api/products/:id', async (c) => {
  const productId = c.req.param('id')
  const data = await c.req.json()
  
  // í• ì¸ìœ¨ ê²€ì¦ (20% ~ 50%)
  const discountRate = data.discount_rate || 30
  if (discountRate < 20 || discountRate > 50) {
    return c.json({ error: 'í• ì¸ìœ¨ì€ 20%ì—ì„œ 50% ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤', min: 20, max: 50 }, 400)
  }
  
  const consumerPrice = data.consumer_price || data.original_price
  const directPrice = data.direct_price || data.price
  
  // ìˆ˜ìˆ˜ë£Œ ê³„ì‚°: í”Œë«í¼ 6.6% + ì¹´ë“œ 3.3% + ì„¸ê¸ˆ 3.3% = ì´ 13.2%
  const platformFeeRate = 6.6
  const cardFeeRate = 3.3
  const taxRate = 3.3
  const totalFeeRate = 13.2
  
  const platformFeeAmount = Math.round(directPrice * (platformFeeRate / 100))
  const cardFeeAmount = Math.round(directPrice * (cardFeeRate / 100))
  const taxAmount = Math.round(directPrice * (taxRate / 100))
  const totalFeeAmount = platformFeeAmount + cardFeeAmount + taxAmount
  const producerRevenue = directPrice - totalFeeAmount
  
  await c.env.DB.prepare(`
    UPDATE products 
    SET name = ?, category_id = ?, description = ?,
        consumer_price = ?, direct_price = ?, original_price = ?, price = ?,
        discount_rate = ?, shipping_fee = ?, stock_quantity = ?,
        platform_fee_rate = ?, card_fee_rate = ?, tax_rate = ?, total_fee_rate = ?,
        platform_fee_amount = ?, card_fee_amount = ?, tax_amount = ?, total_fee_amount = ?,
        producer_revenue = ?,
        main_image = ?, weight = ?, origin = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `).bind(
    data.name,
    data.category_id,
    data.description,
    consumerPrice,
    directPrice,
    consumerPrice, // í•˜ìœ„ í˜¸í™˜ì„±
    directPrice, // í•˜ìœ„ í˜¸í™˜ì„±
    discountRate,
    data.shipping_fee || 3000,
    data.stock_quantity,
    platformFeeRate,
    cardFeeRate,
    taxRate,
    totalFeeRate,
    platformFeeAmount,
    cardFeeAmount,
    taxAmount,
    totalFeeAmount,
    producerRevenue,
    data.main_image,
    data.weight,
    data.origin,
    productId
  ).run()
  
  // ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ (ìˆì„ ê²½ìš°)
  if (data.images && data.images.length > 0) {
    // ì´ë¯¸ì§€ ê°œìˆ˜ ê²€ì¦ (5~10ê°œ)
    if (data.images.length < 5 || data.images.length > 10) {
      return c.json({ 
        error: 'ìƒí’ˆ ì´ë¯¸ì§€ëŠ” 5ê°œì—ì„œ 10ê°œ ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤', 
        min_images: 5, 
        max_images: 10 
      }, 400)
    }
    
    // ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ
    await c.env.DB.prepare('DELETE FROM product_images WHERE product_id = ?')
      .bind(productId).run()
    
    // ìƒˆ ì´ë¯¸ì§€ ë“±ë¡
    for (let i = 0; i < data.images.length; i++) {
      await c.env.DB.prepare(`
        INSERT INTO product_images (product_id, image_url, display_order)
        VALUES (?, ?, ?)
      `).bind(productId, data.images[i], i + 1).run()
    }
  }
  
  return c.json({ success: true, message: 'ìƒí’ˆ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤' })
})

// ìƒí’ˆ ì‚­ì œ
app.delete('/api/products/:id', async (c) => {
  const productId = c.req.param('id')
  
  await c.env.DB.prepare(`
    DELETE FROM products WHERE id = ?
  `).bind(productId).run()
  
  return c.json({ success: true })
})

// ì²´í—˜ ë“±ë¡
app.post('/api/experiences', async (c) => {
  const data = await c.req.json()
  
  const result = await c.env.DB.prepare(`
    INSERT INTO experiences (
      name, region_id, producer_id, type, description,
      original_price, price, discount_rate, duration_hours,
      max_participants, image_url
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
  `).bind(
    data.name,
    data.region_id,
    data.producer_id,
    data.type,
    data.description,
    data.original_price,
    data.price,
    data.discount_rate || 30,
    data.duration_hours,
    data.max_participants,
    data.image_url || '/images/experiences/default.jpg'
  ).run()
  
  return c.json({ 
    success: true, 
    experience_id: result.meta.last_row_id 
  })
})

// ì²´í—˜ ìˆ˜ì •
app.put('/api/experiences/:id', async (c) => {
  const experienceId = c.req.param('id')
  const data = await c.req.json()
  
  await c.env.DB.prepare(`
    UPDATE experiences 
    SET name = ?, type = ?, description = ?,
        original_price = ?, price = ?, discount_rate = ?,
        duration_hours = ?, max_participants = ?, image_url = ?
    WHERE id = ?
  `).bind(
    data.name,
    data.type,
    data.description,
    data.original_price,
    data.price,
    data.discount_rate || 30,
    data.duration_hours,
    data.max_participants,
    data.image_url,
    experienceId
  ).run()
  
  return c.json({ success: true })
})

// ì²´í—˜ ì‚­ì œ
app.delete('/api/experiences/:id', async (c) => {
  const experienceId = c.req.param('id')
  
  await c.env.DB.prepare(`
    DELETE FROM experiences WHERE id = ?
  `).bind(experienceId).run()
  
  return c.json({ success: true })
})

// ì²´í—˜ ì¼ì • ì¶”ê°€
app.post('/api/experience-schedules', async (c) => {
  const data = await c.req.json()
  
  const result = await c.env.DB.prepare(`
    INSERT INTO experience_schedules (
      experience_id, date, start_time, available_slots, booked_slots
    ) VALUES (?, ?, ?, ?, ?)
  `).bind(
    data.experience_id,
    data.date,
    data.start_time,
    data.available_slots,
    data.booked_slots || 0
  ).run()
  
  return c.json({ 
    success: true, 
    schedule_id: result.meta.last_row_id 
  })
})

// ì²´í—˜ ì¼ì • ì‚­ì œ
app.delete('/api/experience-schedules/:id', async (c) => {
  const scheduleId = c.req.param('id')
  
  await c.env.DB.prepare(`
    DELETE FROM experience_schedules WHERE id = ?
  `).bind(scheduleId).run()
  
  return c.json({ success: true })
})

// ===== êµìœ¡ ì‹ ì²­ API =====

// êµìœ¡ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ API
app.get('/api/education-applications', async (c) => {
  const status = c.req.query('status')
  const orgType = c.req.query('org_type')
  const limit = c.req.query('limit') || '50'
  const offset = c.req.query('offset') || '0'
  
  let query = 'SELECT * FROM education_applications WHERE 1=1'
  const params: any[] = []
  
  if (status) {
    query += ' AND status = ?'
    params.push(status)
  }
  
  if (orgType) {
    query += ' AND organization_type = ?'
    params.push(orgType)
  }
  
  query += ' ORDER BY created_at DESC LIMIT ? OFFSET ?'
  params.push(parseInt(limit), parseInt(offset))
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ applications: results })
})

// íŠ¹ì • êµìœ¡ ì‹ ì²­ ìƒì„¸ ì¡°íšŒ API
app.get('/api/education-applications/:id', async (c) => {
  const id = c.req.param('id')
  
  const application = await c.env.DB.prepare(
    'SELECT * FROM education_applications WHERE id = ?'
  ).bind(id).first()
  
  if (!application) {
    return c.json({ error: 'ì‹ ì²­ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  return c.json({ application })
})

// êµìœ¡ ì‹ ì²­ ë“±ë¡ API
app.post('/api/education-applications', async (c) => {
  const body = await c.req.json()
  
  const {
    organization_type,
    organization_name,
    contact_person,
    contact_phone,
    contact_email,
    address,
    participant_count,
    preferred_date,
    preferred_time,
    education_type,
    message
  } = body
  
  // í•„ìˆ˜ í•„ë“œ ê²€ì¦
  if (!organization_type || !organization_name || !contact_person || 
      !contact_phone || !address || !participant_count || !education_type) {
    return c.json({ error: 'í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”' }, 400)
  }
  
  const result = await c.env.DB.prepare(`
    INSERT INTO education_applications (
      organization_type, organization_name, contact_person, contact_phone, 
      contact_email, address, participant_count, preferred_date, preferred_time,
      education_type, message, status
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'pending')
  `).bind(
    organization_type, organization_name, contact_person, contact_phone,
    contact_email, address, participant_count, preferred_date, preferred_time,
    education_type, message
  ).run()
  
  return c.json({ 
    success: true, 
    id: result.meta.last_row_id,
    message: 'êµìœ¡ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹´ë‹¹ì í™•ì¸ í›„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.'
  })
})

// êµìœ¡ ì‹ ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸ API (ê´€ë¦¬ììš©)
app.put('/api/education-applications/:id', async (c) => {
  const id = c.req.param('id')
  const body = await c.req.json()
  
  const {
    status,
    approved_date,
    education_start_date,
    education_end_date,
    instructor_name,
    notes
  } = body
  
  await c.env.DB.prepare(`
    UPDATE education_applications 
    SET status = ?,
        approved_date = ?,
        education_start_date = ?,
        education_end_date = ?,
        instructor_name = ?,
        notes = ?,
        updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `).bind(
    status || 'pending',
    approved_date,
    education_start_date,
    education_end_date,
    instructor_name,
    notes,
    id
  ).run()
  
  return c.json({ success: true, message: 'ì‹ ì²­ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.' })
})

// êµìœ¡ í†µê³„ API
app.get('/api/education-statistics', async (c) => {
  // ê¸°ê´€ë³„ í†µê³„
  const { results: orgStats } = await c.env.DB.prepare(`
    SELECT 
      organization_type,
      COUNT(*) as count
    FROM education_applications
    GROUP BY organization_type
  `).all()
  
  // ìƒíƒœë³„ í†µê³„
  const { results: statusStats } = await c.env.DB.prepare(`
    SELECT 
      status,
      COUNT(*) as count
    FROM education_applications
    GROUP BY status
  `).all()
  
  // êµìœ¡ íƒ€ì…ë³„ í†µê³„
  const { results: typeStats } = await c.env.DB.prepare(`
    SELECT 
      education_type,
      COUNT(*) as count
    FROM education_applications
    GROUP BY education_type
  `).all()
  
  return c.json({
    organizationStats: orgStats,
    statusStats: statusStats,
    typeStats: typeStats
  })
})

// êµìœ¡ íƒ€ì…ë³„ ìƒíƒœ í†µê³„ API
app.get('/api/education/applications/status', async (c) => {
  const educationType = c.req.query('education_type')
  
  if (!educationType) {
    return c.json({ error: 'education_type parameter is required' }, 400)
  }
  
  // ì „ì²´ ì‹ ì²­ ìˆ˜
  const { results: totalResult } = await c.env.DB.prepare(`
    SELECT COUNT(*) as count
    FROM education_applications
    WHERE education_type = ?
  `).bind(educationType).all()
  
  // ìŠ¹ì¸ ëŒ€ê¸° ìˆ˜
  const { results: pendingResult } = await c.env.DB.prepare(`
    SELECT COUNT(*) as count
    FROM education_applications
    WHERE education_type = ? AND status = 'pending'
  `).bind(educationType).all()
  
  // ì§„í–‰ ì¤‘ ìˆ˜
  const { results: approvedResult } = await c.env.DB.prepare(`
    SELECT COUNT(*) as count
    FROM education_applications
    WHERE education_type = ? AND status = 'approved'
  `).bind(educationType).all()
  
  // ì™„ë£Œ ìˆ˜
  const { results: completedResult } = await c.env.DB.prepare(`
    SELECT COUNT(*) as count
    FROM education_applications
    WHERE education_type = ? AND status = 'completed'
  `).bind(educationType).all()
  
  // ì‹ ì²­ ëª©ë¡ (ìµœê·¼ 10ê°œ)
  const { results: recentApplications } = await c.env.DB.prepare(`
    SELECT *
    FROM education_applications
    WHERE education_type = ?
    ORDER BY created_at DESC
    LIMIT 10
  `).bind(educationType).all()
  
  return c.json({
    total: totalResult[0]?.count || 0,
    pending: pendingResult[0]?.count || 0,
    approved: approvedResult[0]?.count || 0,
    completed: completedResult[0]?.count || 0,
    recentApplications: recentApplications
  })
})

// ===== êµìœ¡ ì»¤ë¦¬í˜ëŸ¼ API =====

// êµìœ¡ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ (ì°¨ê³µë¶€, ê³µì˜ˆê³µë¶€)
app.get('/api/education/categories', async (c) => {
  const { results } = await c.env.DB.prepare(`
    SELECT * FROM education_categories 
    ORDER BY display_order ASC
  `).all()
  
  return c.json({ categories: results })
})

// êµìœ¡ ì»¤ë¦¬í˜ëŸ¼ ëª©ë¡ ì¡°íšŒ
app.get('/api/education/curriculum', async (c) => {
  const categoryId = c.req.query('category_id')
  const difficulty = c.req.query('difficulty')
  
  let query = `
    SELECT 
      ec.*,
      cat.name as category_name,
      cat.icon as category_icon
    FROM education_curriculum ec
    LEFT JOIN education_categories cat ON ec.category_id = cat.id
    WHERE 1=1
  `
  const params: any[] = []
  
  if (categoryId) {
    query += ' AND ec.category_id = ?'
    params.push(parseInt(categoryId))
  }
  
  if (difficulty) {
    query += ' AND ec.difficulty = ?'
    params.push(difficulty)
  }
  
  query += ' ORDER BY ec.category_id ASC, ec.display_order ASC'
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  return c.json({ curriculum: results })
})

// êµìœ¡ ì»¤ë¦¬í˜ëŸ¼ ìƒì„¸ ì¡°íšŒ
app.get('/api/education/curriculum/:id', async (c) => {
  const id = c.req.param('id')
  
  const curriculum = await c.env.DB.prepare(`
    SELECT 
      ec.*,
      cat.name as category_name,
      cat.description as category_description,
      cat.icon as category_icon
    FROM education_curriculum ec
    LEFT JOIN education_categories cat ON ec.category_id = cat.id
    WHERE ec.id = ?
  `).bind(id).first()
  
  if (!curriculum) {
    return c.json({ error: 'ì»¤ë¦¬í˜ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  return c.json({ curriculum })
})

// ===== í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ë¼ìš°íŠ¸ =====

// í™ˆ í˜ì´ì§€
app.get('/', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ìƒí’ˆ ëª©ë¡ í˜ì´ì§€
app.get('/products', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ìƒí’ˆ ë“±ë¡ í˜ì´ì§€ (ë°˜ë“œì‹œ /products/:id ì•ì— ìœ„ì¹˜)
app.get('/products/new', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ìƒí’ˆ ë“±ë¡ - ë‹¤ê³µ</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
          body {
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px 0;
          }
          .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.08);
            padding: 40px;
          }
          .form-group {
            margin-bottom: 25px;
          }
          .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
          }
          .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
          }
          .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #4a90e2;
          }
          .form-group textarea {
            min-height: 120px;
            resize: vertical;
          }
          .required::after {
            content: " *";
            color: #e74c3c;
          }
          .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
          }
          .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
          }
          .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
          }
          .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
          }
          .image-preview {
            position: relative;
            width: 100%;
            padding-top: 100%;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
          }
          .image-preview:hover {
            border-color: #667eea;
            background: #f0f4ff;
          }
          .image-preview img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
          }
          .image-preview .upload-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #6c757d;
          }
          .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #e74c3c;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 10;
          }
          .help-text {
            font-size: 13px;
            color: #6c757d;
            margin-top: 6px;
          }
          .error-text {
            font-size: 13px;
            color: #e74c3c;
            margin-top: 6px;
          }
          .info-box {
            background: #f0f8ff;
            border-left: 4px solid #4a90e2;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
          }

        </style>
    </head>
    <body>
        <div class="form-container">
            <h1 style="font-size: 28px; font-weight: 700; color: #2c3e50; margin-bottom: 10px;">
                <i class="fas fa-box"></i> ìƒí’ˆ ë“±ë¡
            </h1>
            <p style="color: #6c757d; margin-bottom: 30px;">
                ê°„í¸í•˜ê²Œ ìƒí’ˆì„ ë“±ë¡í•˜ê³  íŒë§¤ë¥¼ ì‹œì‘í•˜ì„¸ìš”
            </p>

            <div class="info-box">
                <i class="fas fa-info-circle"></i> 
                <strong>ë“±ë¡ ì•ˆë‚´</strong><br>
                â€¢ ìƒí’ˆ ì‚¬ì§„ì€ 5~10ì¥ í•„ìˆ˜ì…ë‹ˆë‹¤<br>
                â€¢ í• ì¸ìœ¨ì€ 20%~50% ë²”ìœ„ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </div>

            <form id="productForm">
                <!-- ìƒí’ˆëª… -->
                <div class="form-group">
                    <label class="required">ìƒí’ˆëª…</label>
                    <input type="text" name="name" id="name" placeholder="ì˜ˆ: ì œì£¼ í•œë¼ì‚° ë…¹ì°¨ 50g" required>
                    <div class="help-text">ê³ ê°ì´ ì•Œì•„ë³´ê¸° ì‰¬ìš´ ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”</div>
                </div>

                <!-- ìƒí’ˆ ì„¤ëª… -->
                <div class="form-group">
                    <label class="required">ìƒí’ˆ ì„¤ëª…</label>
                    <textarea name="description" id="description" placeholder="ìƒí’ˆì˜ íŠ¹ì§•, ì›ì‚°ì§€, ì œì¡° ë°©ë²• ë“±ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”" required></textarea>
                    <div class="help-text">ìƒí’ˆì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                </div>

                <!-- ìƒí’ˆ ì‚¬ì§„ -->
                <div class="form-group">
                    <label class="required">ìƒí’ˆ ì‚¬ì§„ (5~10ì¥)</label>
                    <div class="image-preview-container" id="imagePreviewContainer">
                        <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                    <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                    <button type="button" class="btn-primary" onclick="document.getElementById('imageInput').click()" style="margin-top: 15px; background: linear-gradient(135deg, #48c774 0%, #00b894 100%);">
                        <i class="fas fa-camera"></i> ì‚¬ì§„ ì¶”ê°€
                    </button>
                    <div class="help-text" id="imageCountText">0ì¥ ì„ íƒë¨ (ìµœì†Œ 5ì¥, ìµœëŒ€ 10ì¥)</div>
                    <div class="error-text" id="imageError" style="display: none;"></div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ -->
                <div class="form-group">
                    <label class="required">ì¹´í…Œê³ ë¦¬</label>
                    <select name="category_id" id="category_id" required>
                        <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                        <option value="1">ì°¨ (èŒ¶)</option>
                        <option value="2">ê³µì˜ˆí’ˆ</option>
                        <option value="3">ì„ ë¬¼ì„¸íŠ¸</option>
                    </select>
                </div>

                <!-- ìƒí’ˆ íƒ€ì… -->
                <div class="form-group">
                    <label class="required">ìƒí’ˆ íƒ€ì…</label>
                    <select name="product_type" id="product_type" required>
                        <option value="">íƒ€ì… ì„ íƒ</option>
                        <option value="tea">ì°¨</option>
                        <option value="craft">ê³µì˜ˆí’ˆ</option>
                        <option value="gift_set">ì„ ë¬¼ì„¸íŠ¸</option>
                        <option value="local">ì§€ì—­íŠ¹ì‚°ë¬¼</option>
                    </select>
                </div>

                <!-- ê°€ê²© ì •ë³´ -->
                <div class="form-group">
                    <label class="required">ì†Œë¹„ìê°€ (ì›)</label>
                    <input type="number" name="consumer_price" id="consumer_price" placeholder="ì˜ˆ: 25000" required min="1000">
                    <div class="help-text">ì¼ë°˜ ì†Œë¹„ìê°€ê²© (ì‹œì¥ê°€ê²©)</div>
                </div>

                <div class="form-group">
                    <label class="required">ì§ê±°ë˜ê°€ (ì›)</label>
                    <input type="number" name="direct_price" id="direct_price" placeholder="ì˜ˆ: 20000" required min="1000">
                    <div class="help-text">ë‹¤ê³µ í”Œë«í¼ì—ì„œ íŒë§¤í•  ê°€ê²©</div>
                </div>

                <!-- í• ì¸ìœ¨ -->
                <div class="form-group">
                    <label class="required">í• ì¸ìœ¨ (%)</label>
                    <input type="number" name="discount_rate" id="discount_rate" value="30" required min="20" max="50">
                    <div class="help-text">20% ~ 50% ë²”ìœ„ì—ì„œ ì„¤ì • ê°€ëŠ¥</div>
                    <div class="error-text" id="discountError" style="display: none;"></div>
                </div>

                <!-- ë°°ì†¡ë¹„ -->
                <div class="form-group">
                    <label>ë°°ì†¡ë¹„ (ì›)</label>
                    <input type="number" name="shipping_fee" id="shipping_fee" value="3000" min="3000" max="5000">
                    <div class="help-text">ê¸°ë³¸ 3,000ì› (3,000~5,000ì› ë²”ìœ„)</div>
                </div>

                <!-- ì¬ê³  ìˆ˜ëŸ‰ -->
                <div class="form-group">
                    <label>ì¬ê³  ìˆ˜ëŸ‰</label>
                    <input type="number" name="stock_quantity" id="stock_quantity" value="100" min="0">
                    <div class="help-text">íŒë§¤ ê°€ëŠ¥í•œ ì¬ê³  ìˆ˜ëŸ‰</div>
                </div>

                <!-- ë¬´ê²Œ -->
                <div class="form-group">
                    <label>ë¬´ê²Œ (g)</label>
                    <input type="number" name="weight" id="weight" placeholder="ì˜ˆ: 50" min="1">
                </div>

                <!-- ì›ì‚°ì§€ -->
                <div class="form-group">
                    <label>ì›ì‚°ì§€</label>
                    <input type="text" name="origin" id="origin" placeholder="ì˜ˆ: ì œì£¼ë„">
                </div>

                <!-- ë“±ë¡ ë²„íŠ¼ -->
                <button type="submit" class="btn-primary" id="submitBtn">
                    <i class="fas fa-check"></i> ìƒí’ˆ ë“±ë¡í•˜ê¸°
                </button>
            </form>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
        <script>
          let selectedImages = [];

          // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
          document.getElementById('imageInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
              if (selectedImages.length >= 10) {
                showImageError('ìµœëŒ€ 10ì¥ê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                return;
              }

              const reader = new FileReader();
              reader.onload = function(e) {
                selectedImages.push({
                  file: file,
                  url: e.target.result
                });
                updateImagePreviews();
              };
              reader.readAsDataURL(file);
            });

            // ì…ë ¥ ì´ˆê¸°í™”
            e.target.value = '';
          });

          function updateImagePreviews() {
            const container = document.getElementById('imagePreviewContainer');
            container.innerHTML = '';

            selectedImages.forEach((image, index) => {
              const div = document.createElement('div');
              div.className = 'image-preview';
              div.innerHTML = \`
                <img src="\${image.url}" alt="ìƒí’ˆ ì´ë¯¸ì§€ \${index + 1}">
                <button type="button" class="remove-image" onclick="removeImage(\${index})">
                  <i class="fas fa-times"></i>
                </button>
              \`;
              container.appendChild(div);
            });

            // ì´ë¯¸ì§€ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            const countText = document.getElementById('imageCountText');
            countText.textContent = \`\${selectedImages.length}ì¥ ì„ íƒë¨ (ìµœì†Œ 5ì¥, ìµœëŒ€ 10ì¥)\`;

            // ì—ëŸ¬ ë©”ì‹œì§€ ì²´í¬
            if (selectedImages.length < 5) {
              showImageError('ìµœì†Œ 5ì¥ ì´ìƒì˜ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”');
            } else if (selectedImages.length > 10) {
              showImageError('ìµœëŒ€ 10ì¥ê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
            } else {
              hideImageError();
            }
          }

          function removeImage(index) {
            selectedImages.splice(index, 1);
            updateImagePreviews();
          }

          function showImageError(message) {
            const errorEl = document.getElementById('imageError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
          }

          function hideImageError() {
            document.getElementById('imageError').style.display = 'none';
          }

          // í• ì¸ìœ¨ ê²€ì¦
          document.getElementById('discount_rate').addEventListener('input', function() {
            const value = parseInt(this.value);
            const errorEl = document.getElementById('discountError');
            
            if (value < 20 || value > 50) {
              errorEl.textContent = 'í• ì¸ìœ¨ì€ 20% ~ 50% ë²”ìœ„ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”';
              errorEl.style.display = 'block';
            } else {
              errorEl.style.display = 'none';
            }
          });

          // ê°€ê²© ê³„ì‚°
          // í¼ ì œì¶œ
          document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // ì´ë¯¸ì§€ ê²€ì¦
            if (selectedImages.length < 5 || selectedImages.length > 10) {
              alert('ìƒí’ˆ ì‚¬ì§„ì€ 5~10ì¥ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤');
              return;
            }

            // í• ì¸ìœ¨ ê²€ì¦
            const discountRate = parseInt(document.getElementById('discount_rate').value);
            if (discountRate < 20 || discountRate > 50) {
              alert('í• ì¸ìœ¨ì€ 20% ~ 50% ë²”ìœ„ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”');
              return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ë“±ë¡ ì¤‘...';

            try {
              // ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜ (ì‹¤ì œë¡œëŠ” ì´ë¯¸ì§€ ì—…ë¡œë“œ API ì‚¬ìš©)
              const imageUrls = selectedImages.map((img, index) => 
                \`/images/products/\${Date.now()}-\${index}.jpg\`
              );

              const formData = {
                name: document.getElementById('name').value,
                description: document.getElementById('description').value,
                images: imageUrls,
                category_id: parseInt(document.getElementById('category_id').value),
                product_type: document.getElementById('product_type').value,
                consumer_price: parseFloat(document.getElementById('consumer_price').value),
                direct_price: parseFloat(document.getElementById('direct_price').value),
                discount_rate: discountRate,
                shipping_fee: parseInt(document.getElementById('shipping_fee').value) || 3000,
                stock_quantity: parseInt(document.getElementById('stock_quantity').value) || 0,
                weight: parseInt(document.getElementById('weight').value) || null,
                origin: document.getElementById('origin').value || null
              };

              const response = await axios.post('/api/products', formData);

              if (response.data.success) {
                alert(\`ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! (ìƒí’ˆ ID: \${response.data.product_id})\`);
                window.location.href = '/products';
              } else {
                throw new Error(response.data.message || 'ìƒí’ˆ ë“±ë¡ ì‹¤íŒ¨');
              }
            } catch (error) {
              console.error('Error:', error);
              alert('ìƒí’ˆ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.response?.data?.message || error.message));
            } finally {
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<i class="fas fa-check"></i> ìƒí’ˆ ë“±ë¡í•˜ê¸°';
            }
          });
        </script>
    </body>
    </html>
  `)
})

// ìƒí’ˆ ìƒì„¸ í˜ì´ì§€
app.get('/products/:id', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ì§€ì—­ ëª©ë¡ í˜ì´ì§€
app.get('/regions', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ì§€ì—­ ìƒì„¸ í˜ì´ì§€
app.get('/regions/:id', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ìƒì‚°ì ëª©ë¡ í˜ì´ì§€
app.get('/producers', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ìƒì‚°ì ìƒì„¸ í˜ì´ì§€
app.get('/producers/:id', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ì²´í—˜ ëª©ë¡ í˜ì´ì§€
app.get('/experiences', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ì²´í—˜ ìƒì„¸ í˜ì´ì§€
app.get('/experiences/:id', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ì´ë²¤íŠ¸ ëª©ë¡ í˜ì´ì§€
app.get('/events', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ê²€ìƒ‰ í˜ì´ì§€
app.get('/search', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// êµìœ¡ ì‹ ì²­ í˜ì´ì§€
app.get('/education/apply', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// êµìœ¡ í˜„í™© í˜ì´ì§€
app.get('/education/status', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// êµìœ¡ ì»¤ë¦¬í˜ëŸ¼ í˜ì´ì§€
app.get('/education/curriculum', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// êµìœ¡ ì»¤ë¦¬í˜ëŸ¼ ìƒì„¸ í˜ì´ì§€
app.get('/education/curriculum/:id', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ===== ë§ˆì´í˜ì´ì§€ =====

// ë§ˆì´í˜ì´ì§€ ë©”ì¸
app.get('/mypage', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ì£¼ë¬¸ ë‚´ì—­
app.get('/mypage/orders', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ì£¼ë¬¸ ìƒì„¸
app.get('/mypage/orders/:id', (c) => {
  return c.render(
    <div id="app">
      <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
  )
})

// ===== ì†Œì…œ ë¡œê·¸ì¸ API =====

// ë¡œê·¸ì¸ í˜ì´ì§€
app.get('/login', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ë‹¤ê³µ - ë¡œê·¸ì¸</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
          body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
          }
          .login-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 400px;
            width: 90%;
          }
          .social-btn {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            text-decoration: none;
          }
          .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
          }
          .google-btn {
            background: #fff;
            color: #333;
            border: 1px solid #ddd;
          }
          .naver-btn {
            background: #03C75A;
            color: white;
          }
          .kakao-btn {
            background: #FEE500;
            color: #000;
          }
        </style>
    </head>
    <body>
        <div class="login-card">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ë‹¤ê³µ</h1>
                <p class="text-gray-600">ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ê³  ì‹œì‘í•˜ì„¸ìš”</p>
            </div>
            
            <div class="space-y-4">
                <a href="/auth/google" class="social-btn google-btn">
                    <i class="fab fa-google text-xl"></i>
                    êµ¬ê¸€ë¡œ ê³„ì†í•˜ê¸°
                </a>
                
                <a href="/auth/naver" class="social-btn naver-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M13.6 0H6.4v20h7.2V0zM10 10L6.4 0v10H10z"/>
                        <path d="M13.6 10v10L10 10h3.6z"/>
                    </svg>
                    ë„¤ì´ë²„ë¡œ ê³„ì†í•˜ê¸°
                </a>
                
                <a href="/auth/kakao" class="social-btn kakao-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 0C4.477 0 0 3.58 0 8c0 2.827 1.875 5.31 4.688 6.72-.195.715-.7 2.61-.81 3.026-.128.495.182.489.385.355.164-.106 2.537-1.733 3.49-2.387.738.102 1.496.156 2.247.156 5.523 0 10-3.58 10-8S15.523 0 10 0z"/>
                    </svg>
                    ì¹´ì¹´ì˜¤ë¡œ ê³„ì†í•˜ê¸°
                </a>
            </div>
            
            <div class="mt-8 text-center text-sm text-gray-500">
                <p>ë¡œê·¸ì¸í•˜ë©´ ë‹¤ê³µì˜ <a href="/terms" class="text-purple-600">ì´ìš©ì•½ê´€</a> ë°</p>
                <p><a href="/privacy" class="text-purple-600">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤</p>
            </div>
        </div>
    </body>
    </html>
  `)
})

// íŒë§¤ì ë“±ë¡ í˜ì´ì§€
app.get('/seller/register', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>íŒë§¤ì ë“±ë¡ - ë‹¤ê³µ</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
          body {
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px 0;
          }
          .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 40px;
          }
          .form-group {
            margin-bottom: 24px;
          }
          .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
          }
          .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
          }
          .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
          }
          .tab-button {
            padding: 12px 24px;
            background: #e5e7eb;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
          }
          .tab-button.active {
            background: #667eea;
            color: white;
          }
          .tab-content {
            display: none;
          }
          .tab-content.active {
            display: block;
          }
          .btn-submit {
            width: 100%;
            padding: 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
          }
          .btn-submit:hover {
            background: #5568d3;
          }
          .required {
            color: #ef4444;
          }
        </style>
    </head>
    <body>
        <div class="form-container">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">íŒë§¤ì ì •ë³´ ë“±ë¡</h1>
                <p class="text-gray-600">ìƒí’ˆì„ íŒë§¤í•˜ê¸° ìœ„í•´ íŒë§¤ì ì •ë³´ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”</p>
            </div>

            <!-- íŒë§¤ì íƒ€ì… ì„ íƒ -->
            <div class="mb-8">
                <div class="flex gap-2">
                    <button type="button" class="tab-button active flex-1" data-tab="business" onclick="switchTab('business')">
                        <i class="fas fa-building mr-2"></i>ì‚¬ì—…ì
                    </button>
                    <button type="button" class="tab-button flex-1" data-tab="individual" onclick="switchTab('individual')">
                        <i class="fas fa-user mr-2"></i>ê°œì¸
                    </button>
                </div>
            </div>

            <form id="sellerForm">
                <input type="hidden" id="seller_type" name="seller_type" value="business">

                <!-- ê³µí†µ ì •ë³´ -->
                <div class="form-group">
                    <label class="form-label">
                        íŒë§¤ìëª… <span class="required">*</span>
                    </label>
                    <input type="text" class="form-input" name="name" required placeholder="ì˜ˆ: ì œì£¼ í•œë¼ì‚° ì°¨ë†ì›">
                </div>

                <!-- ì‚¬ì—…ì ì •ë³´ -->
                <div id="business-fields" class="tab-content active">
                    <h3 class="text-lg font-semibold mb-4 text-gray-700">ì‚¬ì—…ì ì •ë³´</h3>
                    
                    <div class="form-group">
                        <label class="form-label">
                            ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" name="business_registration_number" placeholder="123-45-67890">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            ìƒí˜¸ëª… <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" name="business_name" placeholder="í•œë¼ì‚°ì°¨ë†ì›">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            ëŒ€í‘œìëª… <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" name="representative_name" placeholder="ê¹€ì œì£¼">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì‚¬ì—…ì¥ ì£¼ì†Œ</label>
                        <input type="text" class="form-input" name="business_address" placeholder="ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì œì£¼ì‹œ í•œë¼ì‚°ë¡œ 123">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì‚¬ì—…ì¥ ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" class="form-input" name="business_phone" placeholder="064-123-4567">
                    </div>
                </div>

                <!-- ê°œì¸ ì •ë³´ -->
                <div id="individual-fields" class="tab-content">
                    <h3 class="text-lg font-semibold mb-4 text-gray-700">ê°œì¸ ì •ë³´</h3>
                    
                    <div class="form-group">
                        <label class="form-label">
                            ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" name="personal_id_number" placeholder="900101-1******">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            íœ´ëŒ€í° ë²ˆí˜¸ <span class="required">*</span>
                        </label>
                        <input type="tel" class="form-input" name="mobile_phone" placeholder="010-1234-5678">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            ì´ë©”ì¼ <span class="required">*</span>
                        </label>
                        <input type="email" class="form-input" name="personal_email" placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            ì£¼ì†Œ <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" name="personal_address" placeholder="ì „ë¼ë‚¨ë„ ë³´ì„±êµ° ë³´ì„±ì ì°¨ë°­ë¡œ 456">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ìš°í¸ë²ˆí˜¸</label>
                        <input type="text" class="form-input" name="personal_zipcode" placeholder="59450">
                    </div>
                </div>

                <!-- ì •ì‚° ê³„ì¢Œ ì •ë³´ (ê³µí†µ) -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 text-gray-700">ì •ì‚° ê³„ì¢Œ ì •ë³´</h3>
                    
                    <div class="form-group">
                        <label class="form-label">
                            ì€í–‰ëª… <span class="required">*</span>
                        </label>
                        <select class="form-input" name="bank_name" required>
                            <option value="">ì€í–‰ ì„ íƒ</option>
                            <option value="ë†í˜‘ì€í–‰">ë†í˜‘ì€í–‰</option>
                            <option value="ì‹ í•œì€í–‰">ì‹ í•œì€í–‰</option>
                            <option value="êµ­ë¯¼ì€í–‰">êµ­ë¯¼ì€í–‰</option>
                            <option value="ìš°ë¦¬ì€í–‰">ìš°ë¦¬ì€í–‰</option>
                            <option value="í•˜ë‚˜ì€í–‰">í•˜ë‚˜ì€í–‰</option>
                            <option value="ê¸°ì—…ì€í–‰">ê¸°ì—…ì€í–‰</option>
                            <option value="SCì œì¼ì€í–‰">SCì œì¼ì€í–‰</option>
                            <option value="ì¹´ì¹´ì˜¤ë±…í¬">ì¹´ì¹´ì˜¤ë±…í¬</option>
                            <option value="ì¼€ì´ë±…í¬">ì¼€ì´ë±…í¬</option>
                            <option value="í† ìŠ¤ë±…í¬">í† ìŠ¤ë±…í¬</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            ê³„ì¢Œë²ˆí˜¸ <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" name="account_number" required placeholder="123-456-789012">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            ì˜ˆê¸ˆì£¼ëª… <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" name="account_holder" required placeholder="ê¹€ì œì£¼">
                    </div>
                </div>

                <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-blue-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        íŒë§¤ì ì •ë³´ëŠ” ê´€ë¦¬ì ìŠ¹ì¸ í›„ ìƒí’ˆ ë“±ë¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìŠ¹ì¸ê¹Œì§€ 1-2ì¼ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                <!-- ì œì¶œ ë²„íŠ¼ -->
                <button type="submit" class="btn-submit">
                    <i class="fas fa-check mr-2"></i>íŒë§¤ì ì •ë³´ ë“±ë¡
                </button>
            </form>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
        <script>
            // íƒ­ ì „í™˜
            function switchTab(tabName) {
                // ë²„íŠ¼ í™œì„±í™”
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(\`[data-tab="\${tabName}"]\`).classList.add('active');

                // ì»¨í…ì¸  í‘œì‹œ
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(\`\${tabName}-fields\`).classList.add('active');

                // hidden input ì—…ë°ì´íŠ¸
                document.getElementById('seller_type').value = tabName;
            }

            // í¼ ì œì¶œ
            document.getElementById('sellerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());
                
                // íŒë§¤ì íƒ€ì…ë³„ í•„ìˆ˜ í•„ë“œ ê²€ì¦
                const sellerType = data.seller_type;
                
                if (sellerType === 'business') {
                    if (!data.business_registration_number || !data.business_name || !data.representative_name) {
                        alert('ì‚¬ì—…ì í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                } else if (sellerType === 'individual') {
                    if (!data.personal_id_number || !data.mobile_phone || !data.personal_email || !data.personal_address) {
                        alert('ê°œì¸ í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                }
                
                try {
                    const response = await axios.post('/api/producers', data);
                    
                    if (response.data.success) {
                        alert('íŒë§¤ì ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ìƒí’ˆì„ ë“±ë¡í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        window.location.href = '/';
                    }
                } catch (error) {
                    if (error.response) {
                        alert('ì˜¤ë¥˜: ' + error.response.data.error);
                    } else {
                        alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                }
            });
        </script>
    </body>
    </html>
  `)
})

// êµ¬ê¸€ ë¡œê·¸ì¸ ì‹œì‘
app.get('/auth/google', (c) => {
  const clientId = c.env.GOOGLE_CLIENT_ID || 'YOUR_GOOGLE_CLIENT_ID'
  const redirectUri = `${new URL(c.req.url).origin}/auth/google/callback`
  const scope = 'openid email profile'
  
  const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?` +
    `client_id=${clientId}&` +
    `redirect_uri=${encodeURIComponent(redirectUri)}&` +
    `response_type=code&` +
    `scope=${encodeURIComponent(scope)}`
  
  return c.redirect(authUrl)
})

// êµ¬ê¸€ ë¡œê·¸ì¸ ì½œë°±
app.get('/auth/google/callback', async (c) => {
  const code = c.req.query('code')
  if (!code) {
    return c.redirect('/login?error=no_code')
  }
  
  try {
    const clientId = c.env.GOOGLE_CLIENT_ID || 'YOUR_GOOGLE_CLIENT_ID'
    const clientSecret = c.env.GOOGLE_CLIENT_SECRET || 'YOUR_GOOGLE_CLIENT_SECRET'
    const redirectUri = `${new URL(c.req.url).origin}/auth/google/callback`
    
    // Access token êµí™˜
    const tokenResponse = await fetch('https://oauth2.googleapis.com/token', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        code,
        client_id: clientId,
        client_secret: clientSecret,
        redirect_uri: redirectUri,
        grant_type: 'authorization_code'
      })
    })
    
    const tokenData = await tokenResponse.json() as any
    
    // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const userResponse = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
      headers: { Authorization: `Bearer ${tokenData.access_token}` }
    })
    
    const userData = await userResponse.json() as any
    
    // ì‚¬ìš©ì DBì— ì €ì¥ ë˜ëŠ” ì—…ë°ì´íŠ¸
    const { results: existingUser } = await c.env.DB.prepare(
      'SELECT * FROM users WHERE provider = ? AND provider_id = ?'
    ).bind('google', userData.id).all()
    
    let userId
    if (existingUser.length > 0) {
      // ê¸°ì¡´ ì‚¬ìš©ì - ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
      userId = (existingUser[0] as any).id
      await c.env.DB.prepare(
        'UPDATE users SET last_login_at = CURRENT_TIMESTAMP WHERE id = ?'
      ).bind(userId).run()
    } else {
      // ì‹ ê·œ ì‚¬ìš©ì ìƒì„±
      const result = await c.env.DB.prepare(`
        INSERT INTO users (email, name, profile_image, provider, provider_id, last_login_at)
        VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
      `).bind(
        userData.email,
        userData.name,
        userData.picture,
        'google',
        userData.id
      ).run()
      userId = result.meta.last_row_id
    }
    
    // ì„¸ì…˜ ìƒì„±
    const sessionToken = crypto.randomUUID()
    const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30ì¼
    
    await c.env.DB.prepare(`
      INSERT INTO user_sessions (user_id, session_token, expires_at)
      VALUES (?, ?, ?)
    `).bind(userId, sessionToken, expiresAt.toISOString()).run()
    
    // ì¿ í‚¤ ì„¤ì • ë° ë¦¬ë‹¤ì´ë ‰íŠ¸
    c.header('Set-Cookie', `session=${sessionToken}; Path=/; HttpOnly; Max-Age=2592000; SameSite=Lax`)
    return c.redirect('/')
    
  } catch (error) {
    console.error('Google login error:', error)
    return c.redirect('/login?error=auth_failed')
  }
})

// ë„¤ì´ë²„ ë¡œê·¸ì¸ ì‹œì‘
app.get('/auth/naver', (c) => {
  const clientId = c.env.NAVER_CLIENT_ID || 'YOUR_NAVER_CLIENT_ID'
  const redirectUri = `${new URL(c.req.url).origin}/auth/naver/callback`
  const state = crypto.randomUUID()
  
  const authUrl = `https://nid.naver.com/oauth2.0/authorize?` +
    `response_type=code&` +
    `client_id=${clientId}&` +
    `redirect_uri=${encodeURIComponent(redirectUri)}&` +
    `state=${state}`
  
  return c.redirect(authUrl)
})

// ë„¤ì´ë²„ ë¡œê·¸ì¸ ì½œë°±
app.get('/auth/naver/callback', async (c) => {
  const code = c.req.query('code')
  const state = c.req.query('state')
  
  if (!code || !state) {
    return c.redirect('/login?error=no_code')
  }
  
  try {
    const clientId = c.env.NAVER_CLIENT_ID || 'YOUR_NAVER_CLIENT_ID'
    const clientSecret = c.env.NAVER_CLIENT_SECRET || 'YOUR_NAVER_CLIENT_SECRET'
    
    // Access token êµí™˜
    const tokenResponse = await fetch(
      `https://nid.naver.com/oauth2.0/token?` +
      `grant_type=authorization_code&` +
      `client_id=${clientId}&` +
      `client_secret=${clientSecret}&` +
      `code=${code}&` +
      `state=${state}`
    )
    
    const tokenData = await tokenResponse.json() as any
    
    // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const userResponse = await fetch('https://openapi.naver.com/v1/nid/me', {
      headers: { Authorization: `Bearer ${tokenData.access_token}` }
    })
    
    const userData = await userResponse.json() as any
    const naverUser = userData.response
    
    // ì‚¬ìš©ì DBì— ì €ì¥ ë˜ëŠ” ì—…ë°ì´íŠ¸
    const { results: existingUser } = await c.env.DB.prepare(
      'SELECT * FROM users WHERE provider = ? AND provider_id = ?'
    ).bind('naver', naverUser.id).all()
    
    let userId
    if (existingUser.length > 0) {
      userId = (existingUser[0] as any).id
      await c.env.DB.prepare(
        'UPDATE users SET last_login_at = CURRENT_TIMESTAMP WHERE id = ?'
      ).bind(userId).run()
    } else {
      const result = await c.env.DB.prepare(`
        INSERT INTO users (email, name, profile_image, provider, provider_id, last_login_at)
        VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
      `).bind(
        naverUser.email,
        naverUser.name,
        naverUser.profile_image,
        'naver',
        naverUser.id
      ).run()
      userId = result.meta.last_row_id
    }
    
    // ì„¸ì…˜ ìƒì„±
    const sessionToken = crypto.randomUUID()
    const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
    
    await c.env.DB.prepare(`
      INSERT INTO user_sessions (user_id, session_token, expires_at)
      VALUES (?, ?, ?)
    `).bind(userId, sessionToken, expiresAt.toISOString()).run()
    
    c.header('Set-Cookie', `session=${sessionToken}; Path=/; HttpOnly; Max-Age=2592000; SameSite=Lax`)
    return c.redirect('/')
    
  } catch (error) {
    console.error('Naver login error:', error)
    return c.redirect('/login?error=auth_failed')
  }
})

// ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œì‘
app.get('/auth/kakao', (c) => {
  const clientId = c.env.KAKAO_CLIENT_ID || 'YOUR_KAKAO_CLIENT_ID'
  const redirectUri = `${new URL(c.req.url).origin}/auth/kakao/callback`
  
  const authUrl = `https://kauth.kakao.com/oauth/authorize?` +
    `response_type=code&` +
    `client_id=${clientId}&` +
    `redirect_uri=${encodeURIComponent(redirectUri)}`
  
  return c.redirect(authUrl)
})

// ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì½œë°±
app.get('/auth/kakao/callback', async (c) => {
  const code = c.req.query('code')
  if (!code) {
    return c.redirect('/login?error=no_code')
  }
  
  try {
    const clientId = c.env.KAKAO_CLIENT_ID || 'YOUR_KAKAO_CLIENT_ID'
    const clientSecret = c.env.KAKAO_CLIENT_SECRET || ''
    const redirectUri = `${new URL(c.req.url).origin}/auth/kakao/callback`
    
    // Access token êµí™˜
    const tokenResponse = await fetch('https://kauth.kakao.com/oauth/token', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        grant_type: 'authorization_code',
        client_id: clientId,
        client_secret: clientSecret,
        redirect_uri: redirectUri,
        code
      })
    })
    
    const tokenData = await tokenResponse.json() as any
    
    // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const userResponse = await fetch('https://kapi.kakao.com/v2/user/me', {
      headers: { Authorization: `Bearer ${tokenData.access_token}` }
    })
    
    const userData = await userResponse.json() as any
    
    // ì‚¬ìš©ì DBì— ì €ì¥ ë˜ëŠ” ì—…ë°ì´íŠ¸
    const { results: existingUser } = await c.env.DB.prepare(
      'SELECT * FROM users WHERE provider = ? AND provider_id = ?'
    ).bind('kakao', userData.id.toString()).all()
    
    let userId
    if (existingUser.length > 0) {
      userId = (existingUser[0] as any).id
      await c.env.DB.prepare(
        'UPDATE users SET last_login_at = CURRENT_TIMESTAMP WHERE id = ?'
      ).bind(userId).run()
    } else {
      const result = await c.env.DB.prepare(`
        INSERT INTO users (email, name, profile_image, provider, provider_id, last_login_at)
        VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
      `).bind(
        userData.kakao_account?.email || `kakao_${userData.id}@example.com`,
        userData.kakao_account?.profile?.nickname || 'ì¹´ì¹´ì˜¤ì‚¬ìš©ì',
        userData.kakao_account?.profile?.profile_image_url || '',
        'kakao',
        userData.id.toString()
      ).run()
      userId = result.meta.last_row_id
    }
    
    // ì„¸ì…˜ ìƒì„±
    const sessionToken = crypto.randomUUID()
    const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
    
    await c.env.DB.prepare(`
      INSERT INTO user_sessions (user_id, session_token, expires_at)
      VALUES (?, ?, ?)
    `).bind(userId, sessionToken, expiresAt.toISOString()).run()
    
    c.header('Set-Cookie', `session=${sessionToken}; Path=/; HttpOnly; Max-Age=2592000; SameSite=Lax`)
    return c.redirect('/')
    
  } catch (error) {
    console.error('Kakao login error:', error)
    return c.redirect('/login?error=auth_failed')
  }
})

// í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
app.get('/api/auth/me', async (c) => {
  const cookies = c.req.header('Cookie') || ''
  const sessionMatch = cookies.match(/session=([^;]+)/)
  
  if (!sessionMatch) {
    return c.json({ user: null })
  }
  
  const sessionToken = sessionMatch[1]
  
  // ì„¸ì…˜ í™•ì¸
  const { results: sessions } = await c.env.DB.prepare(`
    SELECT us.*, u.id as user_id, u.email, u.name, u.profile_image, u.role, u.provider
    FROM user_sessions us
    JOIN users u ON us.user_id = u.id
    WHERE us.session_token = ? AND us.expires_at > datetime('now')
  `).bind(sessionToken).all()
  
  if (sessions.length === 0) {
    return c.json({ user: null })
  }
  
  const session = sessions[0] as any
  
  // íŒë§¤ì ì •ë³´ í™•ì¸
  const producer = await c.env.DB.prepare(
    'SELECT id, name, seller_type, is_verified FROM producers WHERE user_id = ?'
  ).bind(session.user_id).first()
  
  return c.json({
    user: {
      id: session.user_id,
      email: session.email,
      name: session.name,
      profile_image: session.profile_image,
      role: session.role,
      provider: session.provider,
      producer: producer ? {
        id: (producer as any).id,
        name: (producer as any).name,
        seller_type: (producer as any).seller_type,
        is_verified: (producer as any).is_verified
      } : null
    }
  })
})

// ë¡œê·¸ì•„ì›ƒ
app.post('/api/auth/logout', async (c) => {
  const cookies = c.req.header('Cookie') || ''
  const sessionMatch = cookies.match(/session=([^;]+)/)
  
  if (sessionMatch) {
    const sessionToken = sessionMatch[1]
    await c.env.DB.prepare(
      'DELETE FROM user_sessions WHERE session_token = ?'
    ).bind(sessionToken).run()
  }
  
  c.header('Set-Cookie', 'session=; Path=/; HttpOnly; Max-Age=0; SameSite=Lax')
  return c.json({ success: true })
})

// ===== ì¥ë°”êµ¬ë‹ˆ API =====

// ì¥ë°”êµ¬ë‹ˆ ê°œìˆ˜ ì¡°íšŒ (ë¡œê·¸ì¸ ì—†ì´ë„ ì‘ë™)
app.get('/api/cart/count', async (c) => {
  const userId = c.req.query('user_id')
  const sessionId = c.req.query('session_id')
  
  // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” count 0 ë°˜í™˜
  if (!userId && !sessionId) {
    return c.json({ count: 0 })
  }
  
  try {
    const query = userId 
      ? 'SELECT COUNT(*) as count FROM cart_items WHERE user_id = ?'
      : 'SELECT COUNT(*) as count FROM cart_items WHERE session_id = ?'
    
    const result = await c.env.DB.prepare(query)
      .bind(userId || sessionId)
      .first()
    
    return c.json({ count: result?.count || 0 })
  } catch (error) {
    console.error('Cart count error:', error)
    return c.json({ count: 0 })
  }
})

// ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ì¡°íšŒ
app.get('/api/cart', async (c) => {
  const userId = c.req.query('user_id')
  const sessionId = c.req.query('session_id')
  
  if (!userId && !sessionId) {
    return c.json({ error: 'ì‚¬ìš©ì ID ë˜ëŠ” ì„¸ì…˜ IDê°€ í•„ìš”í•©ë‹ˆë‹¤' }, 400)
  }
  
  const query = `
    SELECT 
      c.id, c.product_id, c.quantity, c.is_selected, 
      c.price_snapshot, c.created_at,
      p.name as product_name, p.price, p.main_image, 
      p.stock_quantity, p.is_available,
      pr.name as producer_name, pr.id as producer_id
    FROM cart_items c
    JOIN products p ON c.product_id = p.id
    LEFT JOIN producers pr ON p.producer_id = pr.id
    WHERE ${userId ? 'c.user_id = ?' : 'c.session_id = ?'}
    ORDER BY c.created_at DESC
  `
  
  const { results } = await c.env.DB.prepare(query)
    .bind(userId || sessionId)
    .all()
  
  return c.json({ cart_items: results })
})

// ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆ ì¶”ê°€
app.post('/api/cart', async (c) => {
  const data = await c.req.json()
  const { user_id, session_id, product_id, quantity = 1 } = data
  
  if (!user_id && !session_id) {
    return c.json({ error: 'ì‚¬ìš©ì ID ë˜ëŠ” ì„¸ì…˜ IDê°€ í•„ìš”í•©ë‹ˆë‹¤' }, 400)
  }
  
  if (!product_id) {
    return c.json({ error: 'ìƒí’ˆ IDê°€ í•„ìš”í•©ë‹ˆë‹¤' }, 400)
  }
  
  // ìƒí’ˆ ì¡´ì¬ ë° ì¬ê³  í™•ì¸
  const product = await c.env.DB.prepare(
    'SELECT id, price, stock_quantity, is_available FROM products WHERE id = ?'
  ).bind(product_id).first()
  
  if (!product) {
    return c.json({ error: 'ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  if (!product.is_available) {
    return c.json({ error: 'íŒë§¤ ì¤‘ë‹¨ëœ ìƒí’ˆì…ë‹ˆë‹¤' }, 400)
  }
  
  if (product.stock_quantity < quantity) {
    return c.json({ error: 'ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤', available_stock: product.stock_quantity }, 400)
  }
  
  // ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆì— ìˆëŠ”ì§€ í™•ì¸
  const existingItem = await c.env.DB.prepare(`
    SELECT id, quantity FROM cart_items 
    WHERE product_id = ? AND ${user_id ? 'user_id = ?' : 'session_id = ?'}
  `).bind(product_id, user_id || session_id).first()
  
  if (existingItem) {
    // ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸
    const newQuantity = (existingItem.quantity as number) + quantity
    
    if (product.stock_quantity < newQuantity) {
      return c.json({ 
        error: 'ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤', 
        available_stock: product.stock_quantity,
        current_cart_quantity: existingItem.quantity
      }, 400)
    }
    
    await c.env.DB.prepare(`
      UPDATE cart_items 
      SET quantity = ?, price_snapshot = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(newQuantity, product.price, existingItem.id).run()
    
    return c.json({ 
      success: true, 
      cart_item_id: existingItem.id,
      quantity: newQuantity,
      message: 'ì¥ë°”êµ¬ë‹ˆ ìˆ˜ëŸ‰ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤'
    })
  }
  
  // ìƒˆë¡œ ì¶”ê°€
  const result = await c.env.DB.prepare(`
    INSERT INTO cart_items (user_id, session_id, product_id, quantity, price_snapshot)
    VALUES (?, ?, ?, ?, ?)
  `).bind(user_id || null, session_id || null, product_id, quantity, product.price).run()
  
  return c.json({ 
    success: true, 
    cart_item_id: result.meta.last_row_id,
    message: 'ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤'
  })
})

// ì¥ë°”êµ¬ë‹ˆ ìˆ˜ëŸ‰ ë³€ê²½
app.put('/api/cart/:id', async (c) => {
  const cartItemId = c.req.param('id')
  const data = await c.req.json()
  const { quantity, is_selected } = data
  
  // í˜„ì¬ ì¥ë°”êµ¬ë‹ˆ í•­ëª© ì¡°íšŒ
  const cartItem = await c.env.DB.prepare(
    'SELECT product_id FROM cart_items WHERE id = ?'
  ).bind(cartItemId).first()
  
  if (!cartItem) {
    return c.json({ error: 'ì¥ë°”êµ¬ë‹ˆ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  // ìˆ˜ëŸ‰ ë³€ê²½ì¸ ê²½ìš° ì¬ê³  í™•ì¸
  if (quantity !== undefined) {
    const product = await c.env.DB.prepare(
      'SELECT stock_quantity, is_available FROM products WHERE id = ?'
    ).bind(cartItem.product_id).first()
    
    if (!product || !product.is_available) {
      return c.json({ error: 'ìƒí’ˆì„ êµ¬ë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 400)
    }
    
    if (product.stock_quantity < quantity) {
      return c.json({ 
        error: 'ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤', 
        available_stock: product.stock_quantity 
      }, 400)
    }
    
    await c.env.DB.prepare(`
      UPDATE cart_items 
      SET quantity = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(quantity, cartItemId).run()
  }
  
  // ì„ íƒ ìƒíƒœ ë³€ê²½
  if (is_selected !== undefined) {
    await c.env.DB.prepare(`
      UPDATE cart_items 
      SET is_selected = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(is_selected ? 1 : 0, cartItemId).run()
  }
  
  return c.json({ success: true, message: 'ì¥ë°”êµ¬ë‹ˆê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤' })
})

// ì¥ë°”êµ¬ë‹ˆ í•­ëª© ì‚­ì œ
app.delete('/api/cart/:id', async (c) => {
  const cartItemId = c.req.param('id')
  
  await c.env.DB.prepare('DELETE FROM cart_items WHERE id = ?')
    .bind(cartItemId).run()
  
  return c.json({ success: true, message: 'ì¥ë°”êµ¬ë‹ˆì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤' })
})

// ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ë¹„ìš°ê¸°
app.delete('/api/cart', async (c) => {
  const userId = c.req.query('user_id')
  const sessionId = c.req.query('session_id')
  
  if (!userId && !sessionId) {
    return c.json({ error: 'ì‚¬ìš©ì ID ë˜ëŠ” ì„¸ì…˜ IDê°€ í•„ìš”í•©ë‹ˆë‹¤' }, 400)
  }
  
  await c.env.DB.prepare(`
    DELETE FROM cart_items WHERE ${userId ? 'user_id = ?' : 'session_id = ?'}
  `).bind(userId || sessionId).run()
  
  return c.json({ success: true, message: 'ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤' })
})

// ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ëª©ë¡ ì¡°íšŒ
app.get('/api/wishlist', async (c) => {
  const userId = c.req.query('user_id')
  
  if (!userId) {
    return c.json({ error: 'ì‚¬ìš©ì IDê°€ í•„ìš”í•©ë‹ˆë‹¤' }, 400)
  }
  
  const { results } = await c.env.DB.prepare(`
    SELECT 
      w.id, w.product_id, w.created_at,
      p.name, p.price, p.main_image, p.is_available, p.stock_quantity,
      pr.name as producer_name
    FROM wishlist w
    JOIN products p ON w.product_id = p.id
    LEFT JOIN producers pr ON p.producer_id = pr.id
    WHERE w.user_id = ?
    ORDER BY w.created_at DESC
  `).bind(userId).all()
  
  return c.json({ wishlist: results })
})

// ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
app.post('/api/wishlist', async (c) => {
  const data = await c.req.json()
  const { user_id, product_id } = data
  
  if (!user_id || !product_id) {
    return c.json({ error: 'ì‚¬ìš©ì IDì™€ ìƒí’ˆ IDê°€ í•„ìš”í•©ë‹ˆë‹¤' }, 400)
  }
  
  try {
    const result = await c.env.DB.prepare(`
      INSERT INTO wishlist (user_id, product_id) VALUES (?, ?)
    `).bind(user_id, product_id).run()
    
    return c.json({ 
      success: true, 
      wishlist_id: result.meta.last_row_id,
      message: 'ì°œ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤'
    })
  } catch (error) {
    // UNIQUE ì œì•½ ìœ„ë°˜ (ì´ë¯¸ ì¶”ê°€ë¨)
    return c.json({ error: 'ì´ë¯¸ ì°œ ëª©ë¡ì— ìˆìŠµë‹ˆë‹¤' }, 409)
  }
})

// ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì—ì„œ ì‚­ì œ
app.delete('/api/wishlist/:id', async (c) => {
  const wishlistId = c.req.param('id')
  
  await c.env.DB.prepare('DELETE FROM wishlist WHERE id = ?')
    .bind(wishlistId).run()
  
  return c.json({ success: true, message: 'ì°œ ëª©ë¡ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤' })
})

// ===== ì£¼ë¬¸ ê´€ë¦¬ API =====

// ì£¼ë¬¸ ìƒì„±
app.post('/api/orders', async (c) => {
  const data = await c.req.json()
  
  // ì£¼ë¬¸ë²ˆí˜¸ ìƒì„± (ORD + YYYYMMDD + ì‹œí€€ìŠ¤)
  const today = new Date().toISOString().slice(0, 10).replace(/-/g, '')
  const { results } = await c.env.DB.prepare(
    `SELECT COUNT(*) as count FROM orders WHERE order_number LIKE 'ORD${today}%'`
  ).all()
  const sequence = String((results[0].count as number) + 1).padStart(3, '0')
  const orderNumber = `ORD${today}${sequence}`
  
  // ì£¼ë¬¸ ìƒì„±
  const orderResult = await c.env.DB.prepare(`
    INSERT INTO orders (
      order_number, user_id, buyer_name, buyer_email, buyer_phone,
      recipient_name, recipient_phone, delivery_address, delivery_zipcode, delivery_memo,
      total_amount, discount_amount, shipping_fee, final_amount,
      order_status, payment_status
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'pending', 'pending')
  `).bind(
    orderNumber,
    data.user_id || null,
    data.buyer_name,
    data.buyer_email,
    data.buyer_phone,
    data.recipient_name,
    data.recipient_phone,
    data.delivery_address,
    data.delivery_zipcode,
    data.delivery_memo || null,
    data.total_amount,
    data.discount_amount || 0,
    data.shipping_fee || 3000,
    data.final_amount
  ).run()
  
  const orderId = orderResult.meta.last_row_id
  
  // ì£¼ë¬¸ ìƒí’ˆ ì¶”ê°€
  for (const item of data.items) {
    await c.env.DB.prepare(`
      INSERT INTO order_items (
        order_id, product_id, product_name, product_price, quantity,
        discount_rate, item_total, producer_id, commission_rate,
        commission_amount, producer_revenue
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(
      orderId,
      item.product_id,
      item.product_name,
      item.product_price,
      item.quantity,
      item.discount_rate || 0,
      item.item_total,
      item.producer_id,
      item.commission_rate || 9.9,
      item.commission_amount,
      item.producer_revenue
    ).run()
  }
  
  // ìƒíƒœ ì´ë ¥ ì¶”ê°€
  await c.env.DB.prepare(`
    INSERT INTO order_status_history (order_id, previous_status, new_status, changed_by, change_reason)
    VALUES (?, 'new', 'pending', 'system', 'ì£¼ë¬¸ ìƒì„±')
  `).bind(orderId).run()
  
  return c.json({ 
    success: true, 
    order_id: orderId,
    order_number: orderNumber
  })
})

// ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ
app.get('/api/orders', async (c) => {
  const userId = c.req.query('user_id')
  const status = c.req.query('status')
  const limit = parseInt(c.req.query('limit') || '20')
  const offset = parseInt(c.req.query('offset') || '0')
  
  let query = `
    SELECT o.*, 
           COUNT(oi.id) as item_count
    FROM orders o
    LEFT JOIN order_items oi ON o.id = oi.order_id
    WHERE 1=1
  `
  
  const bindings: any[] = []
  
  if (userId) {
    query += ' AND o.user_id = ?'
    bindings.push(userId)
  }
  
  if (status) {
    query += ' AND o.order_status = ?'
    bindings.push(status)
  }
  
  query += ' GROUP BY o.id ORDER BY o.created_at DESC LIMIT ? OFFSET ?'
  bindings.push(limit, offset)
  
  const { results } = await c.env.DB.prepare(query).bind(...bindings).all()
  
  return c.json({ orders: results })
})

// ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ
app.get('/api/orders/:id', async (c) => {
  const orderId = c.req.param('id')
  
  // ì£¼ë¬¸ ì •ë³´
  const orderResult = await c.env.DB.prepare(
    'SELECT * FROM orders WHERE id = ?'
  ).bind(orderId).first()
  
  if (!orderResult) {
    return c.json({ error: 'Order not found' }, 404)
  }
  
  // ì£¼ë¬¸ ìƒí’ˆ
  const itemsResult = await c.env.DB.prepare(
    'SELECT * FROM order_items WHERE order_id = ?'
  ).bind(orderId).all()
  
  // ë°°ì†¡ ì •ë³´
  const shipmentResult = await c.env.DB.prepare(
    'SELECT * FROM order_shipments WHERE order_id = ? ORDER BY created_at DESC LIMIT 1'
  ).bind(orderId).first()
  
  // ìˆ˜ë ¹ í™•ì¸ ì •ë³´
  const confirmationResult = await c.env.DB.prepare(
    'SELECT * FROM order_confirmations WHERE order_id = ?'
  ).bind(orderId).first()
  
  // ìƒíƒœ ì´ë ¥
  const historyResult = await c.env.DB.prepare(
    'SELECT * FROM order_status_history WHERE order_id = ? ORDER BY created_at DESC'
  ).bind(orderId).all()
  
  return c.json({
    order: orderResult,
    items: itemsResult.results,
    shipment: shipmentResult,
    confirmation: confirmationResult,
    history: historyResult.results
  })
})

// ìƒì‚°ìë³„ ì£¼ë¬¸ ì¡°íšŒ
app.get('/api/orders/producer/:producerId', async (c) => {
  const producerId = c.req.param('producerId')
  
  // ìƒì‚°ìì˜ ìƒí’ˆì„ í¬í•¨í•œ ì£¼ë¬¸ë“¤ ì¡°íšŒ
  const { results } = await c.env.DB.prepare(`
    SELECT DISTINCT
      o.id as order_id,
      o.order_number,
      o.buyer_name,
      o.buyer_phone,
      o.recipient_name,
      o.recipient_phone,
      o.delivery_address,
      o.order_status,
      o.payment_status,
      o.payment_method,
      o.total_amount,
      o.final_amount,
      o.created_at,
      COUNT(oi.id) as item_count
    FROM orders o
    JOIN order_items oi ON o.id = oi.order_id
    WHERE oi.producer_id = ?
    GROUP BY o.id
    ORDER BY o.created_at DESC
  `).bind(producerId).all()
  
  return c.json({ orders: results })
})

// ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
app.put('/api/orders/:id/status', async (c) => {
  const orderId = c.req.param('id')
  const data = await c.req.json()
  
  // í˜„ì¬ ì£¼ë¬¸ ì¡°íšŒ
  const currentOrder = await c.env.DB.prepare(
    'SELECT order_status FROM orders WHERE id = ?'
  ).bind(orderId).first()
  
  if (!currentOrder) {
    return c.json({ error: 'Order not found' }, 404)
  }
  
  // ìƒíƒœ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(
    'UPDATE orders SET order_status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?'
  ).bind(data.new_status, orderId).run()
  
  // ì´ë ¥ ì¶”ê°€
  await c.env.DB.prepare(`
    INSERT INTO order_status_history (order_id, previous_status, new_status, changed_by, change_reason)
    VALUES (?, ?, ?, ?, ?)
  `).bind(
    orderId,
    currentOrder.order_status,
    data.new_status,
    data.changed_by || 'system',
    data.change_reason || ''
  ).run()
  
  return c.json({ success: true })
})

// ê²°ì œ ì™„ë£Œ ì²˜ë¦¬
app.post('/api/orders/:id/payment', async (c) => {
  const orderId = c.req.param('id')
  const data = await c.req.json()
  
  // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(`
    UPDATE orders 
    SET order_status = 'paid', 
        payment_status = 'completed',
        payment_method = ?,
        payment_date = CURRENT_TIMESTAMP,
        payment_transaction_id = ?,
        updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `).bind(data.payment_method, data.transaction_id, orderId).run()
  
  // ì´ë ¥ ì¶”ê°€
  await c.env.DB.prepare(`
    INSERT INTO order_status_history (order_id, previous_status, new_status, changed_by, change_reason)
    VALUES (?, 'pending', 'paid', 'system', 'ê²°ì œ ì™„ë£Œ')
  `).bind(orderId).run()
  
  return c.json({ success: true })
})

// ë°°ì†¡ ì •ë³´ ë“±ë¡
app.post('/api/orders/:id/shipment', async (c) => {
  const orderId = c.req.param('id')
  const data = await c.req.json()
  
  // ë°°ì†¡ ì •ë³´ ë“±ë¡
  await c.env.DB.prepare(`
    INSERT INTO order_shipments (
      order_id, courier_company, tracking_number, shipped_date,
      estimated_delivery_date, delivery_status
    ) VALUES (?, ?, ?, CURRENT_TIMESTAMP, ?, 'shipped')
  `).bind(
    orderId,
    data.courier_company,
    data.tracking_number,
    data.estimated_delivery_date
  ).run()
  
  // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(
    'UPDATE orders SET order_status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?'
  ).bind('shipping', orderId).run()
  
  // ì´ë ¥ ì¶”ê°€
  await c.env.DB.prepare(`
    INSERT INTO order_status_history (order_id, previous_status, new_status, changed_by, change_reason)
    VALUES (?, 'preparing', 'shipping', ?, 'ë°°ì†¡ ì‹œì‘')
  `).bind(orderId, data.changed_by || 'system').run()
  
  return c.json({ success: true })
})

// ë°°ì†¡ ì™„ë£Œ ì²˜ë¦¬
app.put('/api/orders/:id/delivered', async (c) => {
  const orderId = c.req.param('id')
  
  // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(
    'UPDATE orders SET order_status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?'
  ).bind('delivered', orderId).run()
  
  // ë°°ì†¡ ìƒíƒœ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(`
    UPDATE order_shipments 
    SET delivery_status = 'delivered', 
        delivery_completed_date = CURRENT_TIMESTAMP,
        updated_at = CURRENT_TIMESTAMP
    WHERE order_id = ?
  `).bind(orderId).run()
  
  // ì´ë ¥ ì¶”ê°€
  await c.env.DB.prepare(`
    INSERT INTO order_status_history (order_id, previous_status, new_status, changed_by, change_reason)
    VALUES (?, 'shipping', 'delivered', 'system', 'ë°°ì†¡ ì™„ë£Œ')
  `).bind(orderId).run()
  
  return c.json({ success: true })
})

// ìˆ˜ë ¹ í™•ì¸
app.post('/api/orders/:id/confirm', async (c) => {
  const orderId = c.req.param('id')
  const data = await c.req.json()
  
  // ì£¼ë¬¸ ìƒíƒœ í™•ì¸
  const order = await c.env.DB.prepare(
    'SELECT order_status FROM orders WHERE id = ?'
  ).bind(orderId).first()
  
  if (!order || order.order_status !== 'delivered') {
    return c.json({ error: 'ë°°ì†¡ ì™„ë£Œëœ ì£¼ë¬¸ë§Œ ìˆ˜ë ¹ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤' }, 400)
  }
  
  // ìˆ˜ë ¹ í™•ì¸ ë“±ë¡
  await c.env.DB.prepare(`
    INSERT INTO order_confirmations (
      order_id, confirmed_by, confirmed_date, rating, review_comment, is_reviewed
    ) VALUES (?, ?, CURRENT_TIMESTAMP, ?, ?, ?)
  `).bind(
    orderId,
    data.user_id || null,
    data.rating || null,
    data.review_comment || null,
    data.rating ? 1 : 0
  ).run()
  
  return c.json({ success: true })
})

// ì£¼ë¬¸ ì·¨ì†Œ
app.post('/api/orders/:id/cancel', async (c) => {
  const orderId = c.req.param('id')
  const data = await c.req.json()
  
  // ì£¼ë¬¸ ìƒíƒœ í™•ì¸
  const order = await c.env.DB.prepare(
    'SELECT order_status FROM orders WHERE id = ?'
  ).bind(orderId).first()
  
  if (!order) {
    return c.json({ error: 'Order not found' }, 404)
  }
  
  if (order.order_status === 'shipped' || order.order_status === 'delivered') {
    return c.json({ error: 'ë°°ì†¡ ì‹œì‘ëœ ì£¼ë¬¸ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 400)
  }
  
  // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(
    'UPDATE orders SET order_status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?'
  ).bind('cancelled', orderId).run()
  
  // ì´ë ¥ ì¶”ê°€
  await c.env.DB.prepare(`
    INSERT INTO order_status_history (order_id, previous_status, new_status, changed_by, change_reason)
    VALUES (?, ?, 'cancelled', ?, ?)
  `).bind(
    orderId,
    order.order_status,
    data.changed_by || 'customer',
    data.cancel_reason || 'êµ¬ë§¤ì ìš”ì²­'
  ).run()
  
  return c.json({ success: true })
})

// ===== ê²°ì œ ë° ì •ì‚° ì‹œìŠ¤í…œ API =====

// ì‚¬ì—…ì ê³„ì¢Œ ë“±ë¡
app.post('/api/producers/:id/business-account', async (c) => {
  const producerId = c.req.param('id')
  const data = await c.req.json()
  
  try {
    const result = await c.env.DB.prepare(`
      INSERT INTO business_accounts (
        producer_id, business_registration_number, business_name, representative_name,
        business_type, business_category, bank_name, account_number, account_holder,
        commission_rate, settlement_cycle, minimum_settlement_amount
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(
      producerId,
      data.business_registration_number,
      data.business_name,
      data.representative_name,
      data.business_type || null,
      data.business_category || null,
      data.bank_name,
      data.account_number,
      data.account_holder,
      data.commission_rate || 9.9,
      data.settlement_cycle || 'weekly',
      data.minimum_settlement_amount || 10000
    ).run()
    
    return c.json({ 
      success: true, 
      accountId: result.meta.last_row_id,
      message: 'ì‚¬ì—…ì ê³„ì¢Œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.'
    })
  } catch (error: any) {
    return c.json({ error: 'ê³„ì¢Œ ë“±ë¡ ì‹¤íŒ¨: ' + error.message }, 500)
  }
})

// ì‚¬ì—…ì ê³„ì¢Œ ì¡°íšŒ
app.get('/api/producers/:id/business-account', async (c) => {
  const producerId = c.req.param('id')
  
  const account = await c.env.DB.prepare(`
    SELECT 
      id, producer_id, business_registration_number, business_name, representative_name,
      business_type, business_category, bank_name, 
      SUBSTR(account_number, 1, 3) || '-****-' || SUBSTR(account_number, -4) as account_number_masked,
      account_holder, commission_rate, settlement_cycle, minimum_settlement_amount,
      verification_status, verified_at, is_active, created_at
    FROM business_accounts
    WHERE producer_id = ?
  `).bind(producerId).first()
  
  if (!account) {
    return c.json({ error: 'ë“±ë¡ëœ ê³„ì¢Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  return c.json({ account })
})

// ì‚¬ì—…ì ê³„ì¢Œ ìˆ˜ì •
app.put('/api/producers/:id/business-account', async (c) => {
  const producerId = c.req.param('id')
  const data = await c.req.json()
  
  try {
    await c.env.DB.prepare(`
      UPDATE business_accounts SET
        bank_name = ?, account_number = ?, account_holder = ?,
        settlement_cycle = ?, updated_at = CURRENT_TIMESTAMP
      WHERE producer_id = ?
    `).bind(
      data.bank_name,
      data.account_number,
      data.account_holder,
      data.settlement_cycle || 'weekly',
      producerId
    ).run()
    
    return c.json({ success: true, message: 'ê³„ì¢Œ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' })
  } catch (error: any) {
    return c.json({ error: 'ê³„ì¢Œ ìˆ˜ì • ì‹¤íŒ¨: ' + error.message }, 500)
  }
})

// ê²°ì œ ìŠ¹ì¸ ê²€ì¦ (í† ìŠ¤í˜ì´ë¨¼ì¸ )
app.post('/api/payment/confirm', async (c) => {
  const { orderId, amount, paymentKey } = await c.req.json()
  
  // í† ìŠ¤í˜ì´ë¨¼ì¸  API í‚¤ í™•ì¸
  const SECRET_KEY = c.env.TOSS_PAYMENTS_SECRET_KEY
  if (!SECRET_KEY) {
    return c.json({ error: 'ê²°ì œ ì‹œìŠ¤í…œ ì„¤ì • ì˜¤ë¥˜' }, 500)
  }
  
  try {
    // í† ìŠ¤í˜ì´ë¨¼ì¸  ìŠ¹ì¸ API í˜¸ì¶œ
    const authString = btoa(SECRET_KEY + ':')
    const response = await fetch('https://api.tosspayments.com/v1/payments/confirm', {
      method: 'POST',
      headers: {
        'Authorization': `Basic ${authString}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ orderId, amount, paymentKey })
    })
    
    const payment = await response.json()
    
    if (!response.ok) {
      throw new Error(payment.message || 'ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨')
    }
    
    // ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
    const order = await c.env.DB.prepare(
      'SELECT id FROM orders WHERE order_number = ?'
    ).bind(orderId).first()
    
    if (!order) {
      return c.json({ error: 'ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
    }
    
    // ê²°ì œ íŠ¸ëœì­ì…˜ ì €ì¥
    await c.env.DB.prepare(`
      INSERT INTO payment_transactions (
        order_id, pg_provider, pg_transaction_id, payment_method, payment_amount,
        card_company, card_number_masked, installment_months,
        transaction_status, approved_at, approval_number, pg_response_data
      ) VALUES (?, 'tosspayments', ?, ?, ?, ?, ?, ?, 'completed', CURRENT_TIMESTAMP, ?, ?)
    `).bind(
      order.id,
      paymentKey,
      payment.method,
      payment.totalAmount,
      payment.card?.company || null,
      payment.card?.number || null,
      payment.card?.installmentPlanMonths || 0,
      payment.approvedAt,
      JSON.stringify(payment)
    ).run()
    
    // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
    await c.env.DB.prepare(`
      UPDATE orders SET 
        payment_status = 'completed',
        payment_method = ?,
        payment_date = CURRENT_TIMESTAMP,
        payment_transaction_id = ?,
        order_status = 'paid',
        updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(payment.method, paymentKey, order.id).run()
    
    return c.json({ 
      success: true, 
      payment,
      message: 'ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'
    })
  } catch (error: any) {
    return c.json({ error: error.message }, 400)
  }
})

// ê²°ì œ ì·¨ì†Œ
app.post('/api/payment/cancel', async (c) => {
  const { paymentKey, cancelReason } = await c.req.json()
  
  const SECRET_KEY = c.env.TOSS_PAYMENTS_SECRET_KEY
  if (!SECRET_KEY) {
    return c.json({ error: 'ê²°ì œ ì‹œìŠ¤í…œ ì„¤ì • ì˜¤ë¥˜' }, 500)
  }
  
  try {
    const authString = btoa(SECRET_KEY + ':')
    const response = await fetch(`https://api.tosspayments.com/v1/payments/${paymentKey}/cancel`, {
      method: 'POST',
      headers: {
        'Authorization': `Basic ${authString}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ cancelReason })
    })
    
    const result = await response.json()
    
    if (!response.ok) {
      throw new Error(result.message || 'ê²°ì œ ì·¨ì†Œ ì‹¤íŒ¨')
    }
    
    // íŠ¸ëœì­ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸
    await c.env.DB.prepare(`
      UPDATE payment_transactions SET
        transaction_status = 'cancelled',
        cancelled_at = CURRENT_TIMESTAMP,
        cancel_reason = ?,
        updated_at = CURRENT_TIMESTAMP
      WHERE pg_transaction_id = ?
    `).bind(cancelReason, paymentKey).run()
    
    // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
    await c.env.DB.prepare(`
      UPDATE orders SET
        payment_status = 'refunded',
        order_status = 'cancelled',
        updated_at = CURRENT_TIMESTAMP
      WHERE payment_transaction_id = ?
    `).bind(paymentKey).run()
    
    return c.json({ success: true, message: 'ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.' })
  } catch (error: any) {
    return c.json({ error: error.message }, 400)
  }
})

// ì •ì‚° ë‚´ì—­ ì¡°íšŒ (ìƒì‚°ììš©)
app.get('/api/producers/:id/settlements', async (c) => {
  const producerId = c.req.param('id')
  
  const settlements = await c.env.DB.prepare(`
    SELECT 
      ps.*,
      sb.settlement_period_start,
      sb.settlement_period_end,
      sb.settlement_status as batch_status
    FROM producer_settlements ps
    JOIN settlement_batches sb ON ps.settlement_batch_id = sb.id
    WHERE ps.producer_id = ?
    ORDER BY sb.settlement_period_end DESC
    LIMIT 50
  `).bind(producerId).all()
  
  return c.json({ settlements: settlements.results })
})

// ì •ì‚° ìƒì„¸ ë‚´ì—­ (ì£¼ë¬¸ ëª©ë¡)
app.get('/api/settlements/:id/items', async (c) => {
  const settlementId = c.req.param('id')
  
  const items = await c.env.DB.prepare(`
    SELECT * FROM settlement_items
    WHERE settlement_id = ?
    ORDER BY order_date DESC
  `).bind(settlementId).all()
  
  return c.json({ items: items.results })
})

// ì •ì‚° ë°°ì¹˜ ìƒì„± (ê´€ë¦¬ììš©)
app.post('/api/admin/settlements/create-batch', async (c) => {
  const { periodStart, periodEnd } = await c.req.json()
  
  try {
    // 1. ì •ì‚° ë°°ì¹˜ ìƒì„±
    const batchResult = await c.env.DB.prepare(`
      INSERT INTO settlement_batches (
        settlement_period_start, settlement_period_end, settlement_status
      ) VALUES (?, ?, 'calculating')
    `).bind(periodStart, periodEnd).run()
    
    const batchId = batchResult.meta.last_row_id
    
    // 2. ìƒì‚°ìë³„ ì •ì‚° ê³„ì‚°
    const producers = await c.env.DB.prepare(`
      SELECT 
        p.id as producer_id,
        ba.id as account_id,
        ba.bank_name,
        ba.account_number,
        ba.account_holder,
        ba.commission_rate,
        COUNT(DISTINCT oi.order_id) as order_count,
        SUM(oi.item_total) as total_sales,
        SUM(oi.commission_amount) as total_commission
      FROM producers p
      JOIN business_accounts ba ON p.id = ba.producer_id
      JOIN order_items oi ON p.id = oi.producer_id
      JOIN orders o ON oi.order_id = o.id
      WHERE o.payment_status = 'completed'
        AND o.order_status NOT IN ('cancelled', 'refunded')
        AND o.payment_date BETWEEN ? AND ?
        AND ba.verification_status = 'verified'
        AND ba.is_active = 1
      GROUP BY p.id
    `).bind(periodStart, periodEnd).all()
    
    let totalOrderAmount = 0
    let totalCommission = 0
    let totalSettlement = 0
    
    // 3. ìƒì‚°ìë³„ ì •ì‚° ë ˆì½”ë“œ ìƒì„±
    for (const producer of producers.results as any[]) {
      const settlementAmount = producer.total_sales - producer.total_commission
      
      await c.env.DB.prepare(`
        INSERT INTO producer_settlements (
          settlement_batch_id, producer_id, account_id,
          settlement_period_start, settlement_period_end,
          order_count, total_sales_amount, total_commission_amount, settlement_amount,
          bank_name, account_number, account_holder, settlement_status
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'pending')
      `).bind(
        batchId, producer.producer_id, producer.account_id,
        periodStart, periodEnd,
        producer.order_count, producer.total_sales,
        producer.total_commission, settlementAmount,
        producer.bank_name, producer.account_number, producer.account_holder
      ).run()
      
      totalOrderAmount += producer.total_sales
      totalCommission += producer.total_commission
      totalSettlement += settlementAmount
    }
    
    // 4. ë°°ì¹˜ í†µê³„ ì—…ë°ì´íŠ¸
    await c.env.DB.prepare(`
      UPDATE settlement_batches SET
        settlement_status = 'ready',
        total_order_amount = ?,
        total_commission_amount = ?,
        total_settlement_amount = ?,
        producer_count = ?,
        calculated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(totalOrderAmount, totalCommission, totalSettlement, producers.results.length, batchId).run()
    
    // 5. í”Œë«í¼ ìˆ˜ìµ ê¸°ë¡
    await c.env.DB.prepare(`
      INSERT INTO platform_revenues (
        settlement_batch_id, revenue_period_start, revenue_period_end,
        total_commission_amount, total_order_count, total_order_amount
      ) VALUES (?, ?, ?, ?, ?, ?)
    `).bind(batchId, periodStart, periodEnd, totalCommission, producers.results.length, totalOrderAmount).run()
    
    return c.json({ 
      success: true,
      batchId,
      producerCount: producers.results.length,
      totalOrderAmount,
      totalCommission,
      totalSettlement
    })
  } catch (error: any) {
    return c.json({ error: 'ì •ì‚° ë°°ì¹˜ ìƒì„± ì‹¤íŒ¨: ' + error.message }, 500)
  }
})

// ì •ì‚° ë°°ì¹˜ ëª©ë¡ (ê´€ë¦¬ììš©)
app.get('/api/admin/settlements/batches', async (c) => {
  const batches = await c.env.DB.prepare(`
    SELECT * FROM settlement_batches
    ORDER BY settlement_period_end DESC
    LIMIT 50
  `).all()
  
  return c.json({ batches: batches.results })
})

// ===== JSX Renderer =====
import { jsxRenderer } from 'hono/jsx-renderer'

app.use('*', jsxRenderer(({ children }) => {
  return (
    <html lang="ko">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
        <title>ë‹¤ê³µ - ì°¨ì™€ ê³µì˜ˆì˜ ì§ê±°ë˜ í”Œë«í¼</title>
        <meta name="description" content="ë‹¤ê³µ - ì „í†µ ì°¨ì™€ ê³µì˜ˆí’ˆì„ ìƒì‚°ìì™€ ì§ê±°ë˜í•˜ëŠ” í”Œë«í¼. ì¤‘ê°„ë§ˆì§„ì„ ì¤„ì—¬ í•©ë¦¬ì  ê°€ê²©ìœ¼ë¡œ ì¢‹ì€ í’ˆì§ˆì„ ë§Œë‚˜ë³´ì„¸ìš”." />
        
        {/* PWA Meta Tags */}
        <meta name="theme-color" content="#7c9473" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="ë‹¤ê³µ" />
        
        {/* SEO Keywords */}
        <meta name="keywords" content="ë‹¤ê³µ, í•œêµ­ì°¨, ì „í†µì°¨, ê³µì˜ˆí’ˆ, ì°¨ ì§ê±°ë˜, ê³µì˜ˆí’ˆ ì§ê±°ë˜, ì°¨ì‚°ì§€, ê³µì˜ˆì‚°ì§€, ë‹¤ë„, ì§€ì—­íŠ¹ì‚°í’ˆ, ë³´ì„±ë…¹ì°¨, í•˜ë™ë…¹ì°¨, ì œì£¼ë…¹ì°¨, ì „í†µê³µì˜ˆ, ë„ìê¸°, ëª©ê³µì˜ˆ, ê¸ˆì†ê³µì˜ˆ, Korean tea, Korean craft, traditional tea, handmade craft, direct trade" />
        <meta name="author" content="ë‹¤ê³µ" />
        <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
        <meta name="googlebot" content="index, follow" />
        <meta name="NaverBot" content="index, follow" />
        <meta name="Yeti" content="index, follow" />
        
        {/* Canonical URL */}
        <link rel="canonical" href="https://dagong.co.kr/" />
        
        {/* Open Graph */}
        <meta property="og:type" content="website" />
        <meta property="og:site_name" content="ë‹¤ê³µ" />
        <meta property="og:title" content="ë‹¤ê³µ - ì°¨ì™€ ê³µì˜ˆì˜ ì§ê±°ë˜ í”Œë«í¼ | ìƒì‚°ì ì§ê±°ë˜ë¡œ í•©ë¦¬ì  ê°€ê²©ì—" />
        <meta property="og:description" content="ì „í†µ ì°¨ì™€ ê³µì˜ˆí’ˆì„ ìƒì‚°ìì™€ ì§ê±°ë˜í•˜ëŠ” í”Œë«í¼. ì¤‘ê°„ë§ˆì§„ ì—†ì´ ìƒì‚°ìì—ê²Œ ì§ì ‘ êµ¬ë§¤í•˜ì„¸ìš”. ë³´ì„±ë…¹ì°¨, í•˜ë™ë…¹ì°¨, ì œì£¼ë…¹ì°¨ë¶€í„° ì „í†µ ë„ìê¸°, ëª©ê³µì˜ˆê¹Œì§€ - ì†Œë¹„ìê°€ ëŒ€ë¹„ ìµœëŒ€ 50% ì ˆì•½!" />
        <meta property="og:url" content="https://dagong.co.kr/" />
        <meta property="og:image" content="https://dagong.co.kr/static/icons/icon-512x512.png" />
        <meta property="og:image:width" content="512" />
        <meta property="og:image:height" content="512" />
        <meta property="og:locale" content="ko_KR" />
        
        {/* Twitter Card */}
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@dagong_kr" />
        <meta name="twitter:title" content="ë‹¤ê³µ - ì°¨ì™€ ê³µì˜ˆì˜ ì§ê±°ë˜ í”Œë«í¼" />
        <meta name="twitter:description" content="ì „í†µ ì°¨ì™€ ê³µì˜ˆí’ˆì„ ìƒì‚°ìì™€ ì§ê±°ë˜í•˜ëŠ” í”Œë«í¼. ì¤‘ê°„ë§ˆì§„ ì—†ì´ í•©ë¦¬ì  ê°€ê²©ìœ¼ë¡œ ì¢‹ì€ í’ˆì§ˆì„ ë§Œë‚˜ë³´ì„¸ìš”." />
        <meta name="twitter:image" content="https://dagong.co.kr/static/icons/icon-512x512.png" />
        
        {/* Naver Site Verification */}
        <meta name="naver-site-verification" content="51a0658e89bc8816eeb448bf53b1862b86609662" />
        
        {/* Structured Data */}
        <meta property="article:publisher" content="https://dagong.co.kr" />
        
        {/* External Resources */}
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&display=swap" rel="stylesheet" />
        <link href="/static/style.css" rel="stylesheet" />
        
        {/* PWA Manifest */}
        <meta name="theme-color" content="#7c9473" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="ë‹¤ê³µ" />
        <link rel="icon" type="image/png" sizes="512x512" href="/static/icons/icon-512x512.png" />
        
        {/* i18n Script */}
        <script src="/static/i18n.js"></script>
        
        {/* Tailwind Config */}
        <script dangerouslySetInnerHTML={{__html: `
            tailwind.config = {
              theme: {
                extend: {
                  colors: {
                    'tea-green': '#7c9473',
                    'tea-brown': '#8b6f47',
                    'tea-cream': '#f5f1e8',
                    'craft-blue': '#5b7c99',
                  }
                }
              }
            }
          `}} />
      </head>
      <body class="bg-tea-cream min-h-screen">
        {children}
        
        {/* Scripts */}
        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
        <script src="/static/app.js"></script>
        <script src="/static/producer-forms.js"></script>
        <script src="/static/mobile.js"></script>
      </body>
    </html>
  )
}))

// ===== Homepage =====
app.get('/', (c) => {
  return c.render(
    <>
      {/* Navigation */}
      <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4">
          <div class="flex items-center justify-between h-20">
            {/* Logo */}
            <a href="/" class="flex items-center space-x-3 group">
              <i class="fas fa-leaf text-tea-green text-2xl group-hover:rotate-12 transition-transform duration-300"></i>
              <div class="flex items-center" id="logoText">
                <span class="text-2xl font-bold text-gray-800">ë‹¤ê³µ</span>
              </div>
            </a>
            
            {/* Desktop Menu */}
            <div class="hidden md:flex items-center space-x-8">
              <a href="/products?type=tea" class="flex flex-col items-center text-gray-700 hover:text-tea-green transition group">
                <i class="fas fa-mug-hot text-xl mb-1"></i>
                <span class="text-sm" data-i18n="nav.teaDirect">ì°¨ ì§ê±°ë˜</span>
              </a>
              <a href="/products?type=craft" class="flex flex-col items-center text-gray-700 hover:text-craft-blue transition group">
                <i class="fas fa-palette text-xl mb-1"></i>
                <span class="text-sm" data-i18n="nav.craft">ê³µì˜ˆí’ˆ</span>
              </a>
              <a href="/products?type=gift_set" class="flex flex-col items-center text-gray-700 hover:text-tea-brown transition group">
                <i class="fas fa-gift text-xl mb-1"></i>
                <span class="text-sm" data-i18n="nav.giftSet">ì„ ë¬¼ì„¸íŠ¸</span>
              </a>
              <a href="/products?type=local" class="flex flex-col items-center text-gray-700 hover:text-green-600 transition group">
                <i class="fas fa-seedling text-xl mb-1"></i>
                <span class="text-sm" data-i18n="nav.localProducts">ì§€ì—­íŠ¹ì‚°ë¬¼</span>
              </a>
              <a href="/regions" class="flex flex-col items-center text-gray-700 hover:text-tea-green transition group">
                <i class="fas fa-map-marked-alt text-xl mb-1"></i>
                <span class="text-sm" data-i18n="nav.regions">ì§€ì—­ë³„ ë³´ê¸°</span>
              </a>
              <a href="/experiences" class="flex flex-col items-center text-gray-700 hover:text-tea-green transition group">
                <i class="fas fa-users text-xl mb-1"></i>
                <span class="text-sm" data-i18n="nav.experiences">ì²´í—˜Â·êµìœ¡</span>
              </a>
              <div class="relative group">
                <a href="/education/curriculum" class="flex flex-col items-center text-gray-700 hover:text-tea-green transition">
                  <i class="fas fa-graduation-cap text-xl mb-1"></i>
                  <span class="text-sm" data-i18n="nav.education">ë‹¤ë„êµìœ¡</span>
                </a>
                <div class="absolute left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 hidden group-hover:block">
                  <a href="/education/curriculum" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    <i class="fas fa-book mr-2"></i>
                    <span data-i18n="nav.educationCurriculum">êµìœ¡ ì»¤ë¦¬í˜ëŸ¼</span>
                  </a>
                  <a href="/education/apply" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    <i class="fas fa-pencil-alt mr-2"></i>
                    <span data-i18n="nav.educationApply">êµìœ¡ ì‹ ì²­</span>
                  </a>
                  <a href="/education/status" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    <i class="fas fa-list-check mr-2"></i>
                    <span data-i18n="nav.educationStatus">êµìœ¡ í˜„í™©</span>
                  </a>
                </div>
              </div>
              <a href="/events" class="flex flex-col items-center text-gray-700 hover:text-tea-brown transition group">
                <i class="fas fa-star text-xl mb-1"></i>
                <span class="text-sm" data-i18n="nav.events">ì´ë²¤íŠ¸</span>
              </a>
            </div>
            
            {/* Right Actions */}
            <div class="flex items-center space-x-4">
              <button id="searchBtn" class="text-gray-700 hover:text-tea-green">
                <i class="fas fa-search text-xl"></i>
              </button>
              <a href="/cart" class="relative text-gray-700 hover:text-tea-green transition">
                <i class="fas fa-shopping-cart text-xl"></i>
                <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold" style="display: none;">0</span>
              </a>
              <div class="relative hidden md:block">
                <button id="langBtn" class="flex items-center space-x-1 text-gray-700 hover:text-tea-green transition">
                  <i class="fas fa-globe text-xl"></i>
                  <span id="currentLang" class="text-sm font-medium">KO</span>
                  <i class="fas fa-chevron-down text-xs"></i>
                </button>
                <div id="langDropdown" class="hidden absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-xl border border-gray-200 py-2 z-50">
                  <button data-lang="ko" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-tea-cream transition flex items-center justify-between">
                    <span class="flex items-center"><span class="mr-2">ğŸ‡°ğŸ‡·</span> í•œêµ­ì–´</span>
                    <span class="text-xs text-gray-500">KO</span>
                  </button>
                  <button data-lang="en" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-tea-cream transition flex items-center justify-between">
                    <span class="flex items-center"><span class="mr-2">ğŸ‡ºğŸ‡¸</span> English</span>
                    <span class="text-xs text-gray-500">EN</span>
                  </button>
                  <button data-lang="zh" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-tea-cream transition flex items-center justify-between">
                    <span class="flex items-center"><span class="mr-2">ğŸ‡¨ğŸ‡³</span> ä¸­æ–‡</span>
                    <span class="text-xs text-gray-500">ZH</span>
                  </button>
                  <button data-lang="ja" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-tea-cream transition flex items-center justify-between">
                    <span class="flex items-center"><span class="mr-2">ğŸ‡¯ğŸ‡µ</span> æ—¥æœ¬èª</span>
                    <span class="text-xs text-gray-500">JA</span>
                  </button>
                </div>
              </div>
              <div id="userMenu" class="hidden md:block">
                <a href="/login" id="loginBtn" class="text-gray-700 hover:text-tea-green">
                  <i class="fas fa-user text-xl"></i>
                </a>
                <div id="userDropdown" class="hidden relative">
                  <button id="userMenuBtn" class="flex items-center space-x-2 text-gray-700 hover:text-tea-green">
                    <img id="userAvatar" src="" alt="í”„ë¡œí•„" class="w-8 h-8 rounded-full" />
                    <span id="userName"></span>
                  </button>
                  <div id="dropdownMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2">
                    <a href="/mypage" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                      <i class="fas fa-user mr-2"></i>ë§ˆì´í˜ì´ì§€
                    </a>
                    <button id="logoutBtn" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100">
                      <i class="fas fa-sign-out-alt mr-2"></i>ë¡œê·¸ì•„ì›ƒ
                    </button>
                  </div>
                </div>
              </div>
              <button id="mobileMenuBtn" class="md:hidden text-gray-700">
                <i class="fas fa-bars text-xl"></i>
              </button>
            </div>
          </div>
          
          {/* Mobile Menu */}
          <div id="mobileMenu" class="hidden md:hidden pb-4">
            <a href="/products?type=tea" class="block py-2 text-gray-700 hover:text-tea-green">ì°¨ ì§ê±°ë˜</a>
            <a href="/products?type=craft" class="block py-2 text-gray-700 hover:text-craft-blue">ê³µì˜ˆí’ˆ</a>
            <a href="/products?type=gift_set" class="block py-2 text-gray-700 hover:text-tea-brown">ì„ ë¬¼ì„¸íŠ¸</a>
            <a href="/products?type=local" class="block py-2 text-gray-700 hover:text-green-600">ì§€ì—­íŠ¹ì‚°ë¬¼</a>
            <a href="/regions" class="block py-2 text-gray-700 hover:text-tea-green">ì§€ì—­ë³„ ë³´ê¸°</a>
            <a href="/experiences" class="block py-2 text-gray-700 hover:text-tea-green">ì²´í—˜Â·êµìœ¡</a>
            <div class="py-2">
              <div class="font-medium text-gray-900 mb-1">ë‹¤ë„êµìœ¡</div>
              <a href="/education/curriculum" class="block py-1 pl-4 text-gray-700 hover:text-tea-green">êµìœ¡ ì»¤ë¦¬í˜ëŸ¼</a>
              <a href="/education/apply" class="block py-1 pl-4 text-gray-700 hover:text-tea-green">êµìœ¡ ì‹ ì²­</a>
              <a href="/education/status" class="block py-1 pl-4 text-gray-700 hover:text-tea-green">êµìœ¡ í˜„í™©</a>
            </div>
            <a href="/events" class="block py-2 text-gray-700 hover:text-tea-brown">ì´ë²¤íŠ¸</a>
            <div class="py-2 border-t border-gray-200 mt-2">
              <div class="font-medium text-gray-900 mb-2 flex items-center">
                <i class="fas fa-globe mr-2"></i>ì–¸ì–´ ì„ íƒ
              </div>
              <button data-lang-mobile="ko" class="block w-full text-left py-2 pl-4 text-gray-700 hover:text-tea-green hover:bg-tea-cream rounded">
                <span class="mr-2">ğŸ‡°ğŸ‡·</span> í•œêµ­ì–´ (Korean)
              </button>
              <button data-lang-mobile="en" class="block w-full text-left py-2 pl-4 text-gray-700 hover:text-tea-green hover:bg-tea-cream rounded">
                <span class="mr-2">ğŸ‡ºğŸ‡¸</span> English
              </button>
              <button data-lang-mobile="zh" class="block w-full text-left py-2 pl-4 text-gray-700 hover:text-tea-green hover:bg-tea-cream rounded">
                <span class="mr-2">ğŸ‡¨ğŸ‡³</span> ä¸­æ–‡ (Chinese)
              </button>
              <button data-lang-mobile="ja" class="block w-full text-left py-2 pl-4 text-gray-700 hover:text-tea-green hover:bg-tea-cream rounded">
                <span class="mr-2">ğŸ‡¯ğŸ‡µ</span> æ—¥æœ¬èª (Japanese)
              </button>
            </div>
          </div>
        </div>
      </nav>
      
      {/* Search Modal */}
      <div id="searchModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-xl font-bold text-gray-800">ê²€ìƒ‰</h3>
              <button id="closeSearchBtn" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            <input type="text" id="searchInput" placeholder="ìƒí’ˆ, ìƒì‚°ì, ì§€ì—­ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-tea-green" />
            <div id="searchResults" class="mt-4"></div>
          </div>
        </div>
      </div>
      
      {/* Main Content */}
      <main class="min-h-screen">
        <div id="app">
          <div class="loading">ë¡œë”© ì¤‘...</div>
        </div>
      </main>
      
      {/* Footer */}
      <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-4 py-12">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
              <h4 class="text-lg font-bold mb-4">ë‹¤ê³µ</h4>
              <p class="text-gray-400 text-sm">ì „í†µ ì°¨ì™€ ê³µì˜ˆí’ˆì„ ìƒì‚°ìì™€<br />ì§ê±°ë˜í•˜ëŠ” í”Œë«í¼ì…ë‹ˆë‹¤.</p>
            </div>
            <div>
              <h4 class="text-lg font-bold mb-4">ìƒí’ˆ</h4>
              <ul class="space-y-2 text-sm">
                <li><a href="/products?type=tea" class="text-gray-400 hover:text-white">ì°¨ ì§ê±°ë˜</a></li>
                <li><a href="/products?type=craft" class="text-gray-400 hover:text-white">ê³µì˜ˆí’ˆ</a></li>
                <li><a href="/products?type=gift_set" class="text-gray-400 hover:text-white">ì„ ë¬¼ì„¸íŠ¸</a></li>
              </ul>
            </div>
            <div>
              <h4 class="text-lg font-bold mb-4">ì§€ì—­</h4>
              <ul class="space-y-2 text-sm">
                <li><a href="/regions?type=tea" class="text-gray-400 hover:text-white">ì°¨ ì‚°ì§€</a></li>
                <li><a href="/regions?type=craft" class="text-gray-400 hover:text-white">ê³µì˜ˆ ì‚°ì§€</a></li>
                <li><a href="/producers" class="text-gray-400 hover:text-white">ìƒì‚°ì</a></li>
              </ul>
            </div>
            <div>
              <h4 class="text-lg font-bold mb-4">ì²´í—˜Â·ì´ë²¤íŠ¸</h4>
              <ul class="space-y-2 text-sm">
                <li><a href="/experiences" class="text-gray-400 hover:text-white">ì²´í—˜ í”„ë¡œê·¸ë¨</a></li>
                <li><a href="/events" class="text-gray-400 hover:text-white">ì´ë‹¬ì˜ ì´ë²¤íŠ¸</a></li>
              </ul>
            </div>
          </div>
          <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400 text-sm">
            <p>Â© 2024 ë‹¤ê³µ. All rights reserved.</p>
          </div>
        </div>
      </footer>
    </>
  )
})

export default app

// ===== ì£¼ë¬¸ í™•ì¸ ë° ì •ì‚° API =====

// êµ¬ë§¤í™•ì • (ìˆ˜ë ¹ í™•ì¸)
app.post('/api/orders/:id/confirm', async (c) => {
  const orderId = c.req.param('id')
  const data = await c.req.json()
  
  // ì£¼ë¬¸ ì¡´ì¬ í™•ì¸
  const order = await c.env.DB.prepare(
    'SELECT * FROM orders WHERE id = ?'
  ).bind(orderId).first()
  
  if (!order) {
    return c.json({ error: 'ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  // ì´ë¯¸ í™•ì¸ëœ ì£¼ë¬¸ì¸ì§€ ì²´í¬
  const existing = await c.env.DB.prepare(
    'SELECT * FROM order_confirmations WHERE order_id = ?'
  ).bind(orderId).first()
  
  if (existing) {
    return c.json({ error: 'ì´ë¯¸ êµ¬ë§¤í™•ì •ëœ ì£¼ë¬¸ì…ë‹ˆë‹¤' }, 400)
  }
  
  // êµ¬ë§¤í™•ì • ë“±ë¡ (confirmed_at + 3ì¼ = settlement_due_date)
  const confirmedAt = new Date()
  const settlementDueDate = new Date(confirmedAt.getTime() + 3 * 24 * 60 * 60 * 1000)
  
  await c.env.DB.prepare(`
    INSERT INTO order_confirmations (
      order_id, confirmed_by, confirmed_at, confirmation_type,
      settlement_due_date, settlement_status
    ) VALUES (?, ?, ?, ?, ?, 'pending')
  `).bind(
    orderId,
    data.user_id || null,
    confirmedAt.toISOString(),
    data.confirmation_type || 'manual',
    settlementDueDate.toISOString()
  ).run()
  
  // ì£¼ë¬¸ ìƒíƒœë¥¼ 'delivered'ë¡œ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(`
    UPDATE orders SET order_status = 'delivered' WHERE id = ?
  `).bind(orderId).run()
  
  // ìƒíƒœ ì´ë ¥ ì¶”ê°€
  await c.env.DB.prepare(`
    INSERT INTO order_status_history (order_id, previous_status, new_status, changed_by, change_reason)
    VALUES (?, ?, 'delivered', ?, 'êµ¬ë§¤í™•ì •')
  `).bind(orderId, order.order_status, data.user_id || 'system').run()
  
  return c.json({ 
    success: true, 
    message: 'êµ¬ë§¤í™•ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
    settlement_due_date: settlementDueDate.toISOString(),
    settlement_info: '3ì¼ ì´ë‚´ì— íŒë§¤ìì—ê²Œ ì •ì‚°ë©ë‹ˆë‹¤'
  })
})

// ì •ì‚° ëŒ€ê¸° ëª©ë¡ ì¡°íšŒ (ê´€ë¦¬ììš©)
app.get('/api/settlements/pending', async (c) => {
  const { results } = await c.env.DB.prepare(`
    SELECT 
      oc.id as confirmation_id,
      oc.order_id,
      oc.confirmed_at,
      oc.settlement_due_date,
      oc.settlement_status,
      o.order_number,
      o.final_amount,
      o.buyer_name,
      SUM(oi.producer_revenue) as total_producer_revenue,
      SUM(oi.commission_amount) as total_commission
    FROM order_confirmations oc
    JOIN orders o ON oc.order_id = o.id
    JOIN order_items oi ON o.id = oi.order_id
    WHERE oc.settlement_status = 'pending'
    AND date(oc.settlement_due_date) <= date('now')
    GROUP BY oc.id
    ORDER BY oc.settlement_due_date ASC
  `).all()
  
  return c.json({ settlements: results })
})

// ì •ì‚° ì²˜ë¦¬ (ê´€ë¦¬ììš©)
app.post('/api/settlements/:confirmationId/process', async (c) => {
  const confirmationId = c.req.param('confirmationId')
  const data = await c.req.json()
  
  // êµ¬ë§¤í™•ì • ì •ë³´ ì¡°íšŒ
  const confirmation = await c.env.DB.prepare(`
    SELECT * FROM order_confirmations WHERE id = ?
  `).bind(confirmationId).first()
  
  if (!confirmation) {
    return c.json({ error: 'êµ¬ë§¤í™•ì • ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)
  }
  
  if (confirmation.settlement_status !== 'pending') {
    return c.json({ error: 'ì´ë¯¸ ì²˜ë¦¬ëœ ì •ì‚°ì…ë‹ˆë‹¤' }, 400)
  }
  
  // ì •ì‚° ìƒíƒœ ì—…ë°ì´íŠ¸
  await c.env.DB.prepare(`
    UPDATE order_confirmations 
    SET settlement_status = 'completed',
        settlement_date = CURRENT_TIMESTAMP,
        notes = ?
    WHERE id = ?
  `).bind(data.notes || 'ì •ì‚° ì™„ë£Œ', confirmationId).run()
  
  return c.json({ 
    success: true, 
    message: 'ì •ì‚°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
    confirmation_id: confirmationId
  })
})

// ìƒì‚°ìë³„ ì •ì‚° ë‚´ì—­ ì¡°íšŒ
app.get('/api/settlements/producer/:producerId', async (c) => {
  const producerId = c.req.param('producerId')
  const status = c.req.query('status') || 'all'
  const limit = parseInt(c.req.query('limit') || '50')
  const offset = parseInt(c.req.query('offset') || '0')
  
  let query = `
    SELECT 
      oc.id as confirmation_id,
      oc.order_id,
      oc.confirmed_at,
      oc.settlement_due_date,
      oc.settlement_date,
      oc.settlement_status,
      o.order_number,
      o.buyer_name,
      oi.product_name,
      oi.quantity,
      oi.item_total,
      oi.commission_amount,
      oi.producer_revenue
    FROM order_confirmations oc
    JOIN orders o ON oc.order_id = o.id
    JOIN order_items oi ON o.id = oi.order_id
    WHERE oi.producer_id = ?
  `
  
  const params: any[] = [producerId]
  
  if (status !== 'all') {
    query += ' AND oc.settlement_status = ?'
    params.push(status)
  }
  
  query += ' ORDER BY oc.confirmed_at DESC LIMIT ? OFFSET ?'
  params.push(limit, offset)
  
  const { results } = await c.env.DB.prepare(query).bind(...params).all()
  
  return c.json({ settlements: results })
})

// ì •ì‚° í†µê³„ (ìƒì‚°ììš©)
app.get('/api/settlements/producer/:producerId/stats', async (c) => {
  const producerId = c.req.param('producerId')
  
  // ì •ì‚° ì˜ˆì • ê¸ˆì•¡
  const pendingResult = await c.env.DB.prepare(`
    SELECT 
      COUNT(DISTINCT oc.id) as pending_count,
      SUM(oi.producer_revenue) as pending_amount
    FROM order_confirmations oc
    JOIN orders o ON oc.order_id = o.id
    JOIN order_items oi ON o.id = oi.order_id
    WHERE oi.producer_id = ?
    AND oc.settlement_status = 'pending'
  `).bind(producerId).first()
  
  // ì •ì‚° ì™„ë£Œ ê¸ˆì•¡ (ì´ë²ˆ ë‹¬)
  const completedResult = await c.env.DB.prepare(`
    SELECT 
      COUNT(DISTINCT oc.id) as completed_count,
      SUM(oi.producer_revenue) as completed_amount
    FROM order_confirmations oc
    JOIN orders o ON oc.order_id = o.id
    JOIN order_items oi ON o.id = oi.order_id
    WHERE oi.producer_id = ?
    AND oc.settlement_status = 'completed'
    AND strftime('%Y-%m', oc.settlement_date) = strftime('%Y-%m', 'now')
  `).bind(producerId).first()
  
  // ì „ì²´ ì •ì‚° ê¸ˆì•¡
  const totalResult = await c.env.DB.prepare(`
    SELECT 
      COUNT(DISTINCT oc.id) as total_count,
      SUM(oi.producer_revenue) as total_amount
    FROM order_confirmations oc
    JOIN orders o ON oc.order_id = o.id
    JOIN order_items oi ON o.id = oi.order_id
    WHERE oi.producer_id = ?
    AND oc.settlement_status = 'completed'
  `).bind(producerId).first()
  
  return c.json({
    pending: pendingResult,
    completed_this_month: completedResult,
    total: totalResult
  })
})

// ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ í˜ì´ì§€ (Google Play Console í•„ìˆ˜)
app.get('/privacy', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ - ë‹¤ê³µ(èŒ¶å·¥)</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 py-12">
            <div class="bg-white rounded-lg shadow-md p-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</h1>
                
                <div class="prose max-w-none">
                    <p class="text-gray-600 mb-4">
                        <strong>ì‹œí–‰ì¼ì:</strong> 2026ë…„ 2ì›” 19ì¼
                    </p>

                    <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">1. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©</h2>
                    <p class="text-gray-700 mb-4">
                        ë‹¤ê³µ(èŒ¶å·¥)ì€ ì‚¬ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ë³„ë„ë¡œ ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 
                        ë³¸ ì•±ì€ Progressive Web App(PWA) í˜•íƒœë¡œ, ì›¹ì‚¬ì´íŠ¸ë¥¼ ë˜í•‘í•œ êµ¬ì¡°ì…ë‹ˆë‹¤.
                    </p>

                    <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">2. ìˆ˜ì§‘í•˜ëŠ” ì •ë³´</h2>
                    <p class="text-gray-700 mb-4">
                        ë‹¤ê³µ(èŒ¶å·¥)ì€ ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ìµœì†Œí•œì˜ ì •ë³´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤:
                    </p>
                    <ul class="list-disc list-inside text-gray-700 mb-4 space-y-2">
                        <li>ì¿ í‚¤ ë° ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•œ ì•± ì„¤ì • ì €ì¥</li>
                        <li>ìƒí’ˆ ê²€ìƒ‰ ë° í•„í„°ë§ì„ ìœ„í•œ ì„ì‹œ ë°ì´í„° ì €ì¥</li>
                        <li>ì„œë¹„ìŠ¤ ê°œì„ ì„ ìœ„í•œ ìµëª…í™”ëœ ì‚¬ìš© í†µê³„</li>
                    </ul>

                    <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">3. ê°œì¸ì •ë³´ì˜ ë³´ê´€ ë° íŒŒê¸°</h2>
                    <p class="text-gray-700 mb-4">
                        ë³¸ ì•±ì€ ì‚¬ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì„œë²„ì— ì €ì¥í•˜ì§€ ì•Šìœ¼ë©°, 
                        ë¸Œë¼ìš°ì €ì˜ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë§Œ ì„ì‹œ ì €ì¥ë©ë‹ˆë‹¤. 
                        ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤.
                    </p>

                    <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">4. ì œ3ì ì œê³µ</h2>
                    <p class="text-gray-700 mb-4">
                        ë‹¤ê³µ(èŒ¶å·¥)ì€ ì‚¬ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                    </p>

                    <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">5. ì‚¬ìš©ìì˜ ê¶Œë¦¬</h2>
                    <p class="text-gray-700 mb-4">
                        ì‚¬ìš©ìëŠ” ì–¸ì œë“ ì§€:
                    </p>
                    <ul class="list-disc list-inside text-gray-700 mb-4 space-y-2">
                        <li>ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¿ í‚¤ ë° ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ê°€ëŠ¥</li>
                        <li>ì•± ì‚­ì œë¥¼ í†µí•´ ëª¨ë“  ì €ì¥ëœ ë°ì´í„° ì œê±° ê°€ëŠ¥</li>
                    </ul>

                    <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">6. ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë³€ê²½</h2>
                    <p class="text-gray-700 mb-4">
                        ë³¸ ë°©ì¹¨ì€ ë²•ë ¹ ë° ì •ì±… ë³€ê²½ì— ë”°ë¼ ìˆ˜ì •ë  ìˆ˜ ìˆìœ¼ë©°, 
                        ë³€ê²½ ì‹œ ì›¹ì‚¬ì´íŠ¸ë¥¼ í†µí•´ ê³µì§€í•©ë‹ˆë‹¤.
                    </p>

                    <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">7. ë¬¸ì˜</h2>
                    <p class="text-gray-700 mb-4">
                        ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì— ëŒ€í•œ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì•„ë˜ë¡œ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤:
                    </p>
                    <ul class="list-none text-gray-700 mb-4 space-y-2">
                        <li><strong>ì„œë¹„ìŠ¤ëª…:</strong> ë‹¤ê³µ(èŒ¶å·¥)</li>
                        <li><strong>ì›¹ì‚¬ì´íŠ¸:</strong> <a href="https://dagong-bi1.pages.dev/" class="text-green-600 hover:underline">https://dagong-bi1.pages.dev/</a></li>
                    </ul>
                </div>

                <div class="mt-8 pt-8 border-t border-gray-200">
                    <a href="/" class="text-green-600 hover:text-green-700 font-medium">
                        â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </a>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

